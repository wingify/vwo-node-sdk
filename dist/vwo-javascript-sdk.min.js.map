{"version":3,"sources":["webpack://vwoSdk/webpack/universalModuleDefinition","webpack://vwoSdk/webpack/bootstrap","webpack://vwoSdk/./lib/services/logging/index.js","webpack://vwoSdk/./lib/utils/DataTypeUtil.js","webpack://vwoSdk/./lib/enums/FileNameEnum.js","webpack://vwoSdk/./lib/constants/index.js","webpack://vwoSdk/./lib/utils/FunctionUtil.js","webpack://vwoSdk/./lib/enums/ApiEnum.js","webpack://vwoSdk/./lib/utils/ValidateUtil.js","webpack://vwoSdk/./lib/utils/CampaignUtil.js","webpack://vwoSdk/./lib/utils/DecisionUtil.js","webpack://vwoSdk/./lib/enums/GoalTypeEnum.js","webpack://vwoSdk/./lib/utils/ObjectUtil.js","webpack://vwoSdk/./lib/utils/ImpressionUtil.js","webpack://vwoSdk/./lib/enums/EventEnum.js","webpack://vwoSdk/./lib/utils/VWOFeatureFlags.js","webpack://vwoSdk/./lib/enums/UrlEnum.js","webpack://vwoSdk/./lib/core/BucketingService.js","webpack://vwoSdk/./lib/enums/LogLevelEnum.js","webpack://vwoSdk/./lib/enums/CampaignTypeEnum.js","webpack://vwoSdk/./lib/enums/segment/index.js","webpack://vwoSdk/./lib/services/HooksManager.js","webpack://vwoSdk/./lib/utils/UuidUtil.js","webpack://vwoSdk/./lib/services/UrlService.js","webpack://vwoSdk/./lib/utils/FetchUtil.js","webpack://vwoSdk/./lib/utils/XhrUtil.js","webpack://vwoSdk/./lib/utils/SettingsFileUtil.js","webpack://vwoSdk/./lib/index.js","webpack://vwoSdk/./lib/VWO.js","webpack://vwoSdk/./lib/api/index.js","webpack://vwoSdk/./lib/api/activate.js","webpack://vwoSdk/./lib/core/VariationDecider.js","webpack://vwoSdk/./lib/enums/DataTypeEnum.js","webpack://vwoSdk/./node_modules/murmurhash/murmurhash.js","webpack://vwoSdk/./lib/services/logging/LoggingManager.js","webpack://vwoSdk/./lib/enums/AnsiColorEnum.js","webpack://vwoSdk/./lib/utils/LogMessageUtil.js","webpack://vwoSdk/./lib/services/logging/ConsoleLogManager.js","webpack://vwoSdk/./lib/enums/StatusEnum.js","webpack://vwoSdk/./lib/core/SegmentEvaluator.js","webpack://vwoSdk/./lib/enums/segment/SegmentOperandTypesEnum.js","webpack://vwoSdk/./lib/enums/segment/SegmentOperatorTypesEnum.js","webpack://vwoSdk/./lib/enums/segment/SegmentOperandValueTypeRegexesEnum.js","webpack://vwoSdk/./lib/enums/segment/SegmentOperandValuesEnum.js","webpack://vwoSdk/./lib/utils/SegmentUtil.js","webpack://vwoSdk/./lib/enums/HooksEnum.js","webpack://vwoSdk/./node_modules/uuid/v5.js","webpack://vwoSdk/./node_modules/uuid/lib/v35.js","webpack://vwoSdk/./node_modules/uuid/lib/bytesToUuid.js","webpack://vwoSdk/./node_modules/uuid/lib/sha1-browser.js","webpack://vwoSdk/./lib/api/getVariation.js","webpack://vwoSdk/./lib/api/track.js","webpack://vwoSdk/./lib/api/isFeatureEnabled.js","webpack://vwoSdk/./lib/api/getFeatureVariableValue.js","webpack://vwoSdk/./lib/utils/FeatureUtil.js","webpack://vwoSdk/./lib/enums/FeatureVariableTypeEnum.js","webpack://vwoSdk/./lib/api/push.js","webpack://vwoSdk/./lib/services/EventQueue.js","webpack://vwoSdk/./lib/utils/EventDispatcherUtil.js","webpack://vwoSdk/./lib/utils/HttpXMLUtil.js","webpack://vwoSdk/./lib/enums/HeadersEnum.js","webpack://vwoSdk/./lib/services/SettingsFileManager.js","webpack://vwoSdk/./lib/schemas/SettingsFileSchema.js","webpack://vwoSdk/./node_modules/superstruct/lib/index.es.js","webpack://vwoSdk/./lib/services/UsageStats.js"],"names":["root","factory","exports","module","define","amd","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","logging","require","DataTypeUtil","_toStringValue","val","toString","isNumber","isString","isObject","isFunction","isBoolean","isPromise","isUndefined","isNull","isArray","INDEX","VWO","API","Activate","GetVariation","Track","IsFeatureEnabled","GetFeatureVariableValue","Push","SegmentEvaluator","BucketingService","VariationDecider","ConsoleLogManager","EventQueue","LoggingManager","SettingsFileManager","BatchEventsQueue","CampaignUtil","EventDispatcher","EventDispatcherUtil","FeatureUtil","Functionutil","ImpressionUtil","UuidUtil","ValidateUtil","DecisionUtil","HttpHandlerUtil","HttpImageUtil","HttpXMLUtil","UsageStatsUtil","packageFile","SDK_NAME","version","SDK_VERSION","PLATFORM","SEED_VALUE","MAX_TRAFFIC_PERCENT","MAX_TRAFFIC_VALUE","MAX_EVENTS_PER_REQUEST","DEFAULT_EVENTS_PER_REQUEST","DEFAULT_REQUEST_TIME_INTERVAL","STATUS_RUNNING","SEED_URL","HTTP_PROTOCOL","HTTPS_PROTOCOL","SDK_QUERY_PARAM","SDK_VERSION_QUERY_PARAM","FunctionUtil","cloneObject","obj","JSON","parse","stringify","getRandomNumber","Math","random","getCurrentUnixTimestamp","ceil","Date","getCurrentUnixTimestampInMillis","matchWithRegex","string","regex","match","RegExp","err","FileNameEnum","logger","getLogger","LogLevelEnum","LogMessageEnum","LogMessageUtil","file","log","ERROR","build","ERROR_MESSAGES","SEGMENTATION_REGEX_CREATION_FAILED","getCurrentTime","toISOString","convertObjectKeysToString","properties","excludedProperties","queryParams","prop","indexOf","objectValues","values","push","LAUNCH","ACTIVATE","GET_VARIATION_NAME","TRACK","IS_FEATURE_ENABLED","GET_FEATURE_VARIABLE_VALUE","PUSH","DataTypeEnum","ApiEnum","GoalTypeEnum","APIMethodArgumentsValidationEnum","campaignKey","userId","customVariables","variationTargetingVariables","userStorageData","shouldTrackReturningUser","metaData","type","STRING","OBJECT","BOOLEAN","goalIdentifier","goalTypeToTrack","ALL","STRING_NULL_UNDEFINED_ARRAY","variableKey","tagKey","tagValue","customDimensionMap","isValidValue","undefined","isValidString","isValidNumber","isValidFunction","isValidBoolean","isValidObject","areValidParamsForAPIMethod","argsObj","args","method","validators","length","argConfig","argValue","NUMBER","every","VWOFeatureFlags","Constants","CampaignTypeEnum","_getVariationBucketRange","variationWeight","startRange","min","getCampaignBasedOnId","settingsFile","campaignId","campaign","campaigns","parseInt","id","scaleVariationWeights","variations","totalWeight","reduce","acc","variation","weight","forEach","getCampaign","getCampaignsForKeys","campaignKeys","getCampaignsForGoal","goal","getCampaignGoal","CAMPAIGN_NOT_FOUND_FOR_GOAL","getCampaignStatus","status","toLowerCase","isCampaignRunning","validateCampaign","keys","setVariationAllocation","numberOfVariations","currentAllocation","assignRangeValues","DEBUG","DEBUG_MESSAGES","VARIATION_RANGE_ALLOCATION","variationName","start","startVariationAllocation","end","endVariationAllocation","setCampaignAllocation","stepFactor","desiredCampaignGoal","goals","identifier","getCampaignVariation","desiredVariation","getControlForCampaign","control","isFeatureTestCampaign","FEATURE_TEST","isFeatureRolloutCampaign","FEATURE_ROLLOUT","isAbCampaign","AB","isPartOfGroup","campaignGroups","groupId","groupName","groups","getGroupCampaigns","getBucketingSeed","isNB","getAll","isNBv2","isBucketingSeedEnabled","StatusEnum","HooksManager","HooksEnum","SegmentationTypeEnum","getVariation","config","isTrackUserAPI","isTrackGoalAPI","newGoalIdentifier","api","vwoUserId","generateFor","accountId","USER_UUID","uuid","decision","campaignType","campaignName","event","DECISION_TYPES","CAMPAIGN_DECISION","isForcedVariationEnabled","sdkVersion","source","assign","_vwoUserId","isUserListEnabled","whitelistedVariation","_checkForWhitelisting","then","data","asyncStorageConfig","Promise","resolve","_checkForUserStorage","response","isStoredVariation","variationWithoutStorageLookup","evaluateAndGetVariationWithoutStorage","_checkForPreSegmentation","isUserPartOfCampaign","campaignList","isWhitelistedOrStoredVariation","_checkForStorageAndWhitelisting","INFO","INFO_MESSAGES","MEG_CALLED_CAMPAIGN_NOT_WINNER","inEligibleCampaignKeys","eligibleCampaignKeys","getEligbleCampaigns","eligibleCampaigns","inEligibleCampaigns","MEG_ELIGIBLE_CAMPAIGNS","slice","inEligibleText","noOfEligibleCampaigns","noOfGroupCampaigns","megAlgoNumber","et","evaluateTrafficAndGetVariation","_normalizeAndFindWinningCampaign","_advancedAlgoFindWinningCampaign","_evaluateWhitelisting","disableLogs","targetedVariations","segments","PASSED","FAILED","SEGMENTATION_STATUS","segmentationType","SEGMENTATION_SKIPPED","_getVariation","calculateBucketValue","variationId","_getStoredUserData","userStorageMap","userStorageService","USER_STORAGE_SERVICE_NOT_CONFIGURED","GETTING_DATA_USER_STORAGE_SERVICE","_error","console","USER_STORAGE_SERVICE_GET_FAILED","error","_saveUserData","isSaved","set","SETTING_DATA_USER_STORAGE_SERVICE","USER_STORAGE_SERVICE_SET_FAILED","calledCampaign","otherCampaignWinner","some","groupCampaign","OTHER_CAMPAIGN_SATISFIES_WHITELISTING_STORAGE","storedVariation","getVariationAllotted","USER_VARIATION_ALLOCATION_STATUS","execute","fromUserStorageService","isUserWhitelisted","isFeatureEnabled","variationString","whitelistingResult","WHITELISTING_SKIPPED","userData","_processAfterGettingFromStorage","USER_STORAGE_SERVICE_NO_STORED_DATA","GOT_STORED_VARIATION","storedGoalIdentifier","WARN","WARNING_MESSAGES","CAMPAIGN_NOT_ACTIVATED","apiName","reason","shortlistedCampaigns","floor","winnerCampaign","MEG_GOT_WINNER_CAMPAIGN","found","priorityOrder","wt","j","participatingCampaignList","clonedCampaign","REVENUE","CUSTOM","ObjectUtil","areObjectKeys","getKeyValue","map","UrlEnum","UrlService","getBaseProperties","configObj","sId","u","getPrimaryProperties","getReportingProperties","account_id","ap","buildEventForPushing","url","getBaseUrl","tags","encodeURIComponent","IMPRESSION_FOR_PUSH","_getStringifiedLogProperties","buildBatchEventForPushing","buildEventForTrackingUser","usageStats","visitorUserAgent","userIpAddress","experiment_id","combination","visitor_ua","visitor_ip","ed","TRACK_USER","IMPRESSION_FOR_TRACK_USER","buildBatchEventForTrackingUser","buildEventForTrackingGoal","revenue","goalId","TRACK_GOAL","IMPRESSION_FOR_TRACK_GOAL","buildBatchEventForTrackingGoal","sdkKey","getEventsBaseProperties","eventName","en","a","env","eTime","EVENTS","getEventBasePayload","props","vwo_sdkName","vwo_sdkVersion","vwo_envKey","msgId","visId","sessionId","time","visitor","vwo_fs_environment","getTrackUserPayloadData","isFirst","IMPRESSION_FOR_EVENT_ARCH_TRACK_USER","getTrackGoalPayloadData","metricMap","revenueValue","revenuePropList","eventProperties","metric","IMPRESSION_FOR_EVENT_ARCH_TRACK_GOAL","goalName","vwoMeta","size","revenueProp","isCustomEvent","getPushPayloadData","IMPRESSION_FOR_EVENT_ARCH_PUSH","logProperties","VWO_VARIATION_SHOWN","VWO_SYNC_VISITOR_PROP","init","isEventArchEnabled","BASE_URL","SETTINGS_URL","WEBHOOK_SETTINGS_URL","BATCH_EVENTS","Hasher","_generateBucketValue","hashValue","maxValue","multiplier","ratio","pow","multipliedValue","bucketValue","_getBucketValueForUser","seed","disableLog","v3","USER_HASH_BUCKET_VALUE","trafficAllocation","percentTraffic","valueAssignedToUser","isUserPart","USER_CAMPAIGN_ELIGIBILITY","bucketUserToVariation","isOB","isOBv2","_generateHashValue","USER_CAMPAIGN_BUCKET_VALUES","AnsiColorEnum","NOTSET","LogLevelColorInfoEnum","BOLD","WHITE","RESET","LIGHTBLUE","CYAN","YELLOW","RED","LogLevelInfoEnum","LogNumberLevel","_0","_1","_2","_3","_4","SegmentEnum","SegmentOperandTypes","SegmentOperatorTypes","SegmentOperandValueTypeRegexes","SegmentOperandValues","callback","integrations","uuidv5","VWO_NAMESPACE","URL","hash","userIdNamespace","generate","replace","toUpperCase","namespace","collectionPrefix","baseUrl","FetchUtil","_getStoredSettings","parsedSettings","isStoredData","getSettings","settings","info","warning","warn","send","payload","customHeaders","retries","delay","attemptRequest","attempt","reject","options","headers","body","fetch","res","text","jsonData","setSettings","setTimeout","XhrUtil","maxRetries","sendGetRequestWithRetry","sendRequest","xhr","XMLHttpRequest","header","timeout","onload","parsedXhrResponse","responseText","retryGetRequest","onerror","ontimeout","open","setRequestHeader","errorMsg","newHeaderName","statusText","xhrOnLoad","xhrOnError","SettingsFileUtil","protocol","hostname","path","isViaWebhook","port","handleHttpRequest","statusCode","contentType","rawData","test","message","resume","setEncoding","on","chunk","handleHttpResponse","parsedData","setLogHandler","setLogLevel","logError","parameter","CONFIG_PARAMETER_INVALID","Error","logInfo","CONFIG_PARAMETER_USED","setLogger","getSettingsFile","launch","sdkConfig","isDevelopmentMode","includes","level","pollingInterval","batchEvents","returnPromiseFor","CONFIG_CORRUPTED","setLogColorMode","haveColoredLogs","CONFIG_CUSTOM_LOGGER_USED","CONFIG_LOG_LEVEL_SET","CONFIG_DEVELOPMENT_MODE_STATUS","SettingsFileService","UsageStats","getVariationName","optOut","redisStorage","settingsFileManager","isSettingsFileValid","CONFIG_VALID","eventQueue","checkAndPoll","collectUsageStats","getConfig","processSettingsFile","SDK_INITIALIZED","SETTINGS_FILE_INVALID","self","CONFIG_ASYNC_RETURN_PROMISE","activate","API_NOT_ENABLED","all","CONFIG_RETURN_PROMISE","responseCallback","_response","apiResponse","campaignSpecifier","track","trackResponse","counter","filter","Boolean","isFeatureEnabledApiResponse","getFeatureVariableValue","typeCastedValue","arguments","API_BAD_PARAMETERS","OPT_OUT_API_CALLED","_destroyInstanceVariables","batchEventsQueue","flushEvents","getAndUpdateSettingsFile","EventEnum","_validateAndReturnVariation","vwoInstance","result","DECISION_NO_VARIATION_ALLOTED","CAMPAIGN_USER_ALREADY_TRACKED","enqueue","getUsageStats","process","areParamsValid","userAgent","isMAB","CAMPAIGN_NOT_RUNNING","API_NOT_APPLICABLE","Bucketer","USER_ID_INVALID","getVariationOfCampaignForUser","USER_NOT_PART_OF_CAMPAIGN","USER_VARIATION_STATUS","MurmurHashV3","remainder","bytes","h1","h1b","c1","c2","k1","charCodeAt","murmur","v2","str","k","h","globalLogLevel","isColoredLogEnabled","globalLogHandler","LogManager","_customLog","getLogLevel","getLogColorMode","GREEN","nargs","template","index","logLevel","prefix","logMessage","shouldLog","consoleLog","targetLogLevel","logArguments","apply","operandCustomVariablesParser","operandUserParser","AND","OR","NOT","CUSTOM_VARIABLE","USER","evaluator","dsl","operator","subDsl","list","SEGMENTATION_ERROR","LOWER","LOWER_MATCH","WILDCARD","WILDCARD_MATCH","REGEX","REGEX_MATCH","STARTING_STAR","ENDING_STAR","GREATER_THAN_MATCH","GREATER_THAN_EQUAL_TO_MATCH","LESS_THAN_MATCH","LESS_THAN_EQUAL_TO_MATCH","LOWER_VALUE","STARTING_ENDING_STAR_VALUE","STARTING_STAR_VALUE","ENDING_STAR_VALUE","REGEX_VALUE","EQUAL_VALUE","GREATER_THAN_VALUE","GREATER_THAN_EQUAL_TO_VALUE","LESS_THAN_VALUE","LESS_THAN_EQUAL_TO_VALUE","extractOperandValue","operand","processValues","operandValue","processedOperandValue","parseFloat","processedTagValue","preProcessTagValue","preProcessOperandValue","operandType","startingStar","endingStar","operandKey","processedValues","endsWith","startsWith","pattern","extractResult","users","split","trim","v35","sha1","bytesToUuid","hashfunc","generateUUID","buf","offset","off","unescape","Array","stringToBytes","hex","uuidToBytes","TypeError","concat","idx","DNS","byteToHex","substr","bth","join","f","x","y","z","ROTL","K","H","msg","N","M","W","b","e","T","GOAL_TYPE_TO_TRACK_DEFAULT","_validateAndReturnTrackValue","events","areGlobalGoals","trackCampaignGoal","TRACK_API_GOAL_NOT_FOUND","logIncorrectParamsForRevenueGoal","mca","add","_validateAndReturnTrackEvent","CAMPAIGN_GOAL_ALREADY_TRACKED","TRACK_API_REVENUE_NOT_PASSED_FOR_REVENUE_GOAL","Set","areAllPromises","item","dataArray","ans","_validateAndReturnFeatureEnabled","FEATURE_STATUS","_validateAndReturnFeaureVariable","variable","getVariableForFeature","getVariableValueForVariation","FEATURE_VARIABLE_VALUE","variableValue","FEATURE_VARIABLE_DEFAULT_VALUE","VARIABLE_NOT_FOUND","getTypeCastVariableValue","FeatureVariableTypeEnum","variableData","variables","variationVariable","variableType","INTEGER","isNaN","UNABLE_TO_CAST_VALUE","DOUBLE","PUSH_INVALID_PARAMS","TAG_KEY_LENGTH_EXCEEDED","TAG_VALUE_LENGTH_EXCEEDED","success","customDimensionKeys","HeadersEnum","running","queue","USER_AGENT","IP","dispatchPostCall","dispatchGetCall","EVENT_QUEUE","queueType","executeNext","shift","sendCall","successCallback","endPoint","IMPRESSION_FAILED","handleGetResponse","baseParams","params","mainKeys","IMPRESSION_SUCCESS","handlePostResponse","IMPRESSION_SUCCESS_FOR_EVENT_ARCH","noop","printLog","errorCallback","isCallbackCalled","handleGetCall","initialDelay","makeRequest","_err","makeXHRRequest","headerName","validateSettingsFile","_configObj","_clonedSettingsFile","SETTINGS_FILE_CORRUPTED","lastSettingsFile","setInterval","latestSettingsFile","POLLING_SUCCESS","stringifiedLatestSettingsFile","updateSettingsFile","POLLING_SETTINGS_FILE_UPDATED","POLLING_SETTINGS_FILE_NOT_UPDATED","_e","POLLING_FAILED","POLLING_SETTINGS_FILE_REGISTERED","_setVariationBucketing","SETTINGS_FILE_PROCESSED","_reject","API_HAS_CORRUPTED_SETTINGS_FILE","validate","number","boolean","array","optional","union","record","campaignGoalSchema","variableObjectSchema","campaignVariationSchema","changes","campaignObjectSchema","groupSchema","settingsFileSchema","_defineProperty","configurable","writable","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","_objectSpread2","target","getOwnPropertyDescriptors","defineProperties","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","sourceSymbolKeys","propertyIsEnumerable","toFailures","context","fail","iteratorShift","input","done","next","func","Struct","schema","coercer","validator","refiner","StructError","failure","moreFailures","branch","rest","failuresResult","super","failures","stack","__proto__","assert","struct","coerce","ret","is","coercing","check","ctx","v","parent","coercion","fn","defaulted","S","fallback","strict","isPlainObject","changed","masked","getPrototypeOf","empty","refinement","max","regexp","any","Element","entries","date","getTime","dynamic","enums","toLiteralString","instance","Class","intersection","Structs","lazy","literal","constant","Key","Value","Map","never","nullable","knowns","Never","createObjectCoercer","unknowns","delete","partial","tuple","Elements","Number"],"mappings":"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","file":"vwo-javascript-sdk.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\t// CommonJS2\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\t// AMD\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\t// CommonJS\n\telse if(typeof exports === 'object')\n\t\texports[\"vwoSdk\"] = factory();\n\t// Root\n\telse\n\t\troot[\"vwoSdk\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 25);\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst logging = require('./LoggingManager');\n\nmodule.exports = logging;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = {\n  _toStringValue: function(val) {\n    return Object.prototype.toString.call(val);\n  },\n  isNumber: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Number]';\n  },\n  isString: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object String]';\n  },\n  isObject: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Object]';\n  },\n  isFunction: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Function]';\n  },\n  isBoolean: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Boolean]';\n  },\n  isPromise: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Promise]';\n  },\n  isUndefined: function(val) {\n    return (\n      DataTypeUtil._toStringValue(val) === '[object Undefined]' ||\n      // A third-party library sometimes overrides and returns [object Window]\n      // therefore, adding a fallback as well\n      typeof val === 'undefined'\n    );\n  },\n  isNull: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Null]';\n  },\n  isArray: function(val) {\n    return DataTypeUtil._toStringValue(val) === '[object Array]';\n  }\n};\n\nmodule.exports = DataTypeUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst LIB_PATH = 'lib';\nconst CORE_PATH = 'lib/core';\nconst UTIL_PATH = 'lib/util';\nconst SERVICES_PATH = 'lib/services';\n\nmodule.exports = {\n  INDEX: `${LIB_PATH}/index`,\n\n  VWO: `${LIB_PATH}/VWO`,\n\n  API: `${LIB_PATH}/api/index`,\n\n  Activate: `${LIB_PATH}/api/activate`,\n  GetVariation: `${LIB_PATH}/api/getVariation`,\n  Track: `${LIB_PATH}/api/track`,\n  IsFeatureEnabled: `${LIB_PATH}/api/isFeatureEnabled`,\n  GetFeatureVariableValue: `${LIB_PATH}/api/getFeatureVariableValue`,\n  Push: `${LIB_PATH}/api/push`,\n\n  SegmentEvaluator: `${CORE_PATH}/SegmentEvaluator`,\n  BucketingService: `${CORE_PATH}/BucketingService`,\n  VariationDecider: `${CORE_PATH}/VariationDecider`,\n\n  ConsoleLogManager: `${SERVICES_PATH}/ConsoleLogManager`,\n  EventQueue: `${SERVICES_PATH}/EventQueue`,\n  LoggingManager: `${SERVICES_PATH}/LoggingManager`,\n  SettingsFileManager: `${SERVICES_PATH}/SettingsFileManager`,\n  BatchEventsQueue: `${SERVICES_PATH}/BatchEventsQueue`,\n\n  CampaignUtil: `${UTIL_PATH}/CampaignUtil`,\n  DataTypeUtil: `${UTIL_PATH}/DataTypeUtil`,\n  EventDispatcher: `${UTIL_PATH}/EventDispatcher`,\n  EventDispatcherUtil: `${UTIL_PATH}/EventDispatcherUtil`,\n  FeatureUtil: `${UTIL_PATH}/FeatureUtil`,\n  Functionutil: `${UTIL_PATH}/Functionutil`,\n  ImpressionUtil: `${UTIL_PATH}/ImpressionUtil`,\n  UuidUtil: `${UTIL_PATH}/UuidUtil`,\n  ValidateUtil: `${UTIL_PATH}/ValidateUtil`,\n  DecisionUtil: `${UTIL_PATH}/DecisionUtils`,\n  HttpHandlerUtil: `${UTIL_PATH}/HttpHandlerUtil`,\n  HttpImageUtil: `${UTIL_PATH}/HttpImageUtil`,\n  HttpXMLUtil: `${UTIL_PATH}/HttpXMLUtil`,\n\n  UsageStatsUtil: `${SERVICES_PATH}/UsageStats`\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* global SDK_NAME, SDK_VERSION */\n\nlet packageFile = {};\n\n// For javascript-sdk, to keep the build size low\n// avoid adding the whole package file in the file\nif (typeof process.env === 'undefined') {\n  packageFile = {\n    name: SDK_NAME,\n    version: SDK_VERSION\n  };\n} else {\n  packageFile = require('../../package.json');\n}\n\nmodule.exports = {\n  SDK_NAME: packageFile.name,\n  SDK_VERSION: packageFile.version,\n\n  PLATFORM: 'server',\n\n  SEED_VALUE: 1,\n\n  MAX_TRAFFIC_PERCENT: 100,\n  MAX_TRAFFIC_VALUE: 10000,\n  MAX_EVENTS_PER_REQUEST: 5000,\n\n  DEFAULT_EVENTS_PER_REQUEST: 100,\n  DEFAULT_REQUEST_TIME_INTERVAL: 600, // 10 * 60(secs) = 600 secs i.e. 10 minutes\n\n  STATUS_RUNNING: 'RUNNING',\n\n  SEED_URL: 'https://vwo.com',\n\n  HTTP_PROTOCOL: 'http://',\n  HTTPS_PROTOCOL: 'https://',\n\n  SDK_QUERY_PARAM: 'sdk',\n  SDK_VERSION_QUERY_PARAM: 'sdk-v'\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst FunctionUtil = {\n  cloneObject: obj => {\n    if (!obj) {\n      return obj;\n    }\n\n    let clonedObj = JSON.parse(JSON.stringify(obj));\n\n    return clonedObj;\n  },\n  getRandomNumber: () => {\n    return Math.random();\n  },\n  getCurrentUnixTimestamp: () => {\n    return Math.ceil(+new Date() / 1000);\n  },\n  getCurrentUnixTimestampInMillis: () => {\n    return +new Date();\n  },\n  matchWithRegex: (string, regex) => {\n    try {\n      return string.match(new RegExp(regex));\n    } catch (err) {\n      const logging = require('../services/logging');\n      const FileNameEnum = require('../enums/FileNameEnum');\n\n      const logger = logging.getLogger();\n      const { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n      const file = FileNameEnum.FunctionUtil;\n\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.SEGMENTATION_REGEX_CREATION_FAILED, {\n          file,\n          regex\n        })\n      );\n      return null;\n    }\n  },\n  getCurrentTime() {\n    return new Date().toISOString();\n  },\n  convertObjectKeysToString(properties, excludedProperties) {\n    let queryParams = '';\n    excludedProperties = excludedProperties || [];\n\n    for (let prop in properties) {\n      if (properties.hasOwnProperty(prop)) {\n        if (excludedProperties.indexOf(prop) === -1) {\n          queryParams += prop + '=' + properties[prop] + '&';\n        }\n      }\n    }\n\n    return queryParams;\n  },\n  objectValues(obj) {\n    let values = [];\n\n    for (const prop in obj) {\n      values.push(obj[prop]);\n    }\n    return values;\n  }\n};\n\nmodule.exports = FunctionUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ApiEnum = {\n  LAUNCH: 'launch',\n  ACTIVATE: 'activate',\n  GET_VARIATION_NAME: 'getVariation',\n  TRACK: 'track',\n  IS_FEATURE_ENABLED: 'isFeatureEnabled',\n  GET_FEATURE_VARIABLE_VALUE: 'getFeatureVariableValue',\n  PUSH: 'push'\n};\n\nmodule.exports = ApiEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = require('./DataTypeUtil');\nconst DataTypeEnum = require('../enums/DataTypeEnum');\nconst ApiEnum = require('../enums/ApiEnum');\nconst GoalTypeEnum = require('../enums/GoalTypeEnum');\n\nconst APIMethodArgumentsValidationEnum = {\n  [ApiEnum.ACTIVATE]: function({\n    campaignKey,\n    userId,\n    customVariables = {},\n    variationTargetingVariables = {},\n    userStorageData = {},\n    shouldTrackReturningUser = false,\n    metaData = {}\n  }) {\n    return [\n      {\n        key: 'campaignKey',\n        value: campaignKey,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'userId',\n        value: userId,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'customVariables',\n        value: customVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'variationTargetingVariables',\n        value: variationTargetingVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'userStorageData',\n        value: userStorageData,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'shouldTrackReturningUser',\n        value: shouldTrackReturningUser,\n        type: DataTypeEnum.BOOLEAN\n      },\n      {\n        key: 'metaData',\n        value: metaData,\n        type: DataTypeEnum.OBJECT\n      }\n    ];\n  },\n  [ApiEnum.TRACK]: function({\n    campaignKey,\n    userId,\n    goalIdentifier,\n    customVariables = {},\n    variationTargetingVariables = {},\n    userStorageData = {},\n    goalTypeToTrack = GoalTypeEnum.ALL,\n    shouldTrackReturningUser = false,\n    metaData = {}\n  }) {\n    return [\n      {\n        key: 'campaignKey',\n        value: campaignKey,\n        type: DataTypeEnum.STRING_NULL_UNDEFINED_ARRAY\n      },\n      {\n        key: 'userId',\n        value: userId,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'goalIdentifier',\n        value: goalIdentifier,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'customVariables',\n        value: customVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'variationTargetingVariables',\n        value: variationTargetingVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'userStorageData',\n        value: userStorageData,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'goalTypeToTrack',\n        value: goalTypeToTrack,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'shouldTrackReturningUser',\n        value: shouldTrackReturningUser,\n        type: DataTypeEnum.BOOLEAN\n      },\n      {\n        key: 'metaData',\n        value: metaData,\n        type: DataTypeEnum.OBJECT\n      }\n    ];\n  },\n  [ApiEnum.IS_FEATURE_ENABLED]: function({\n    campaignKey,\n    userId,\n    customVariables = {},\n    variationTargetingVariables = {},\n    userStorageData = {},\n    shouldTrackReturningUser = false,\n    metaData = {}\n  }) {\n    return [\n      {\n        key: 'campaignKey',\n        value: campaignKey,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'userId',\n        value: userId,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'customVariables',\n        value: customVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'variationTargetingVariables',\n        value: variationTargetingVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'userStorageData',\n        value: userStorageData,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'shouldTrackReturningUser',\n        value: shouldTrackReturningUser,\n        type: DataTypeEnum.BOOLEAN\n      },\n      {\n        key: 'metaData',\n        value: metaData,\n        type: DataTypeEnum.OBJECT\n      }\n    ];\n  },\n  [ApiEnum.GET_FEATURE_VARIABLE_VALUE]: function({\n    campaignKey,\n    variableKey,\n    userId,\n    customVariables = {},\n    variationTargetingVariables = {},\n    userStorageData = {},\n    metaData = {}\n  }) {\n    return [\n      {\n        key: 'campaignKey',\n        value: campaignKey,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'variableKey',\n        value: variableKey,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'userId',\n        value: userId,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'customVariables',\n        value: customVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'variationTargetingVariables',\n        value: variationTargetingVariables,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'userStorageData',\n        value: userStorageData,\n        type: DataTypeEnum.OBJECT\n      },\n      {\n        key: 'metaData',\n        value: metaData,\n        type: DataTypeEnum.OBJECT\n      }\n    ];\n  },\n  [ApiEnum.PUSH]: function({ tagKey, tagValue, userId, customDimensionMap }) {\n    return [\n      {\n        key: 'tagKey',\n        value: tagKey,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'tagValue',\n        value: tagValue,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'userId',\n        value: userId,\n        type: DataTypeEnum.STRING\n      },\n      {\n        key: 'customDimensionMap',\n        value: customDimensionMap,\n        type: DataTypeEnum.OBJECT\n      }\n    ];\n  }\n};\n// both have same\nAPIMethodArgumentsValidationEnum[ApiEnum.GET_VARIATION_NAME] = APIMethodArgumentsValidationEnum[ApiEnum.ACTIVATE];\n\nconst ValidateUtil = {\n  isValidValue: function(value) {\n    return !!(value !== undefined && value);\n  },\n  isValidString: function(value) {\n    return ValidateUtil.isValidValue(value) && DataTypeUtil.isString(value);\n  },\n  isValidNumber: function(value) {\n    return ValidateUtil.isValidValue(value) && DataTypeUtil.isNumber(value);\n  },\n  isValidFunction: function(value) {\n    return ValidateUtil.isValidValue(value) && DataTypeUtil.isFunction(value);\n  },\n  isValidBoolean: function(value) {\n    return value !== undefined && DataTypeUtil.isBoolean(value);\n  },\n  isValidObject: function(value) {\n    return value !== undefined && DataTypeUtil.isObject(value);\n  },\n  areValidParamsForAPIMethod: argsObj => {\n    let isValid = false;\n    let args = APIMethodArgumentsValidationEnum[argsObj.method](argsObj);\n\n    let validators = [];\n\n    for (let i = 0; i < args.length; i++) {\n      let argConfig = args[i];\n      let argValue = argConfig.value;\n      let dataType = argConfig.type;\n      // let value;\n\n      switch (dataType) {\n        case DataTypeEnum.NUMBER:\n          validators.push(ValidateUtil.isValidNumber(argValue));\n          break;\n        case DataTypeEnum.STRING:\n          validators.push(ValidateUtil.isValidString(argValue));\n          break;\n        case DataTypeEnum.BOOLEAN:\n          validators.push(ValidateUtil.isValidBoolean(argValue));\n          break;\n        // case DataTypeEnum.FUNCTION:\n        //   validators.push(ValidateUtil.isValidFunction(argValue));\n        //   break;\n        case DataTypeEnum.OBJECT:\n          validators.push(ValidateUtil.isValidObject(argValue));\n          break;\n        case DataTypeEnum.STRING_NULL_UNDEFINED_ARRAY:\n          let value =\n            ValidateUtil.isValidString(argValue) ||\n            DataTypeUtil.isUndefined(argValue) ||\n            DataTypeUtil.isNull(argValue) ||\n            DataTypeUtil.isArray(argValue);\n          validators.push(value);\n          break;\n        // case DataTypeEnum.NUMBER_STRING:\n        //   value = ValidateUtil.isValidNumber(argValue) || ValidateUtil.isValidString(argValue);\n        //   validators.push(value);\n        //   break;\n      }\n    }\n\n    isValid = validators.every(val => val);\n\n    return isValid;\n  }\n};\n\nmodule.exports = ValidateUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ValidateUtil = require('./ValidateUtil');\nconst VWOFeatureFlags = require('./VWOFeatureFlags');\nconst Constants = require('../constants');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst GoalTypeEnum = require('../enums/GoalTypeEnum');\nconst CampaignTypeEnum = require('../enums/CampaignTypeEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\n\nlet CampaignUtil = {\n  /**\n   * Returns the bucket size of variation.\n   *\n   * @param {Number/Float} - weight of variation\n   *\n   * @return {Number} bucket start range of Variation\n   */\n  _getVariationBucketRange: variationWeight => {\n    if (!variationWeight || variationWeight === 0) {\n      return 0;\n    }\n\n    const startRange = Math.ceil(variationWeight * 100);\n\n    return Math.min(startRange, Constants.MAX_TRAFFIC_VALUE);\n  },\n\n  /**\n   * Get the campaign on the basis of campaign id\n   *\n   * @param {Object} settingsFile\n   * @param {Number} campaignId\n   *\n   * @returns {Object} campaign object\n   */\n  getCampaignBasedOnId: (settingsFile, campaignId) => {\n    let campaign;\n\n    for (let i = 0; i < settingsFile.campaigns.length; i++) {\n      if (parseInt(settingsFile.campaigns[i].id, 10) === parseInt(campaignId, 10)) {\n        campaign = settingsFile.campaigns[i];\n\n        break;\n      }\n    }\n\n    return campaign;\n  },\n  /**\n   * It extracts the weights from all the variations inside the campaign\n      and scales them so that the total sum of eligible variations' weights become 100%\n\n      1. variations\n   */\n  scaleVariationWeights: variations => {\n    const totalWeight = variations.reduce((acc, variation) => {\n      return acc + variation.weight;\n    }, 0);\n    if (!totalWeight) {\n      const weight = 100 / variations.length;\n      variations.forEach(variation => (variation.weight = weight));\n    } else {\n      variations.forEach(variation => (variation.weight = (variation.weight / totalWeight) * 100));\n    }\n  },\n\n  getCampaign: (settingsFile, campaignKey) => {\n    let campaign;\n\n    for (let i = 0; i < settingsFile.campaigns.length; i++) {\n      if (settingsFile.campaigns[i].key === campaignKey) {\n        campaign = settingsFile.campaigns[i];\n\n        break;\n      }\n    }\n\n    return campaign;\n  },\n  /**\n   * Gets campaigns for corresponding campaignKeys\n   *\n   * @param {Object} settingsFile\n   * @param {Array} campaignKeys\n   *\n   * @return {Array} Campaigns\n   */\n  getCampaignsForKeys: (settingsFile, campaignKeys) => {\n    const campaigns = [];\n    campaignKeys.forEach(key => {\n      let campaign = CampaignUtil.getCampaign(settingsFile, key);\n      if (campaign) {\n        campaigns.push(campaign);\n      } else {\n        campaigns.push({\n          key\n        });\n      }\n    });\n    return campaigns;\n  },\n  /**\n   * Gets campaigns which have the goalIdentifier present\n   *\n   * @param {settingsFile}\n   * @param {String} goalIdentifier\n   * @param {String} goalTypeToTrack type of goal to track\n   *\n   * @return {Array} Campaigns\n   */\n  getCampaignsForGoal: (settingsFile, goalIdentifier, goalTypeToTrack) => {\n    let campaigns = [];\n    settingsFile.campaigns.forEach(campaign => {\n      const goal = CampaignUtil.getCampaignGoal(settingsFile, campaign.key, goalIdentifier);\n      if (goal && (goalTypeToTrack === GoalTypeEnum.ALL || goal.type === goalTypeToTrack)) {\n        campaigns.push(campaign);\n      }\n    });\n    if (!campaigns.length) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.CAMPAIGN_NOT_FOUND_FOR_GOAL, {\n          file: FileNameEnum.CampaignUtil,\n          goalIdentifier\n        })\n      );\n    }\n    return campaigns;\n  },\n  getCampaignStatus: (settingsFile, campaignKey) => {\n    let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n    if (!campaign || !campaign.status) {\n      // log error\n      return '';\n    }\n\n    return campaign.status.toLowerCase();\n  },\n\n  isCampaignRunning: (settingsFile, campaignKey) => {\n    return CampaignUtil.getCampaignStatus(settingsFile, campaignKey) === 'running';\n  },\n  /**\n   * Validates the campaign\n   *\n   * @param {Campaign} campaign the campaign to be validated\n   *\n   * @return {Boolean} true is campaign is valid\n   */\n  validateCampaign: campaign => {\n    return ValidateUtil.isValidValue(campaign) && campaign.variations && Object.keys(campaign.variations).length > 0;\n  },\n\n  /**\n   * Assigns the buckets to the Variations of the campaign\n   * depending on the traffic allocation\n   *\n   * @param {Campaign} campaign whose Variations are to be allocated\n   */\n  setVariationAllocation: campaign => {\n    const numberOfVariations = campaign.variations.length;\n    let stepFactor = 0;\n\n    for (let i = 0, currentAllocation = 0; i < numberOfVariations; i++) {\n      let variation = campaign.variations[i];\n\n      stepFactor = CampaignUtil.assignRangeValues(variation, currentAllocation);\n      currentAllocation += stepFactor;\n\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.VARIATION_RANGE_ALLOCATION, {\n          file: FileNameEnum.CampaignUtil,\n          campaignKey: campaign.key,\n          variationName: variation.name,\n          variationWeight: variation.weight,\n          start: variation.startVariationAllocation,\n          end: variation.endVariationAllocation\n        })\n      );\n    }\n  },\n\n  /**\n   * Assign range allocation to the campaigns in the list to decide which campaign to choose out of the Mutually Exclusive group\n   *\n   * @param {Array} campaigns\n   */\n  setCampaignAllocation: campaigns => {\n    let stepFactor = 0;\n\n    for (let i = 0, currentAllocation = 0; i < campaigns.length; i++) {\n      let campaign = campaigns[i];\n\n      stepFactor = CampaignUtil.assignRangeValues(campaign, currentAllocation);\n      currentAllocation += stepFactor;\n    }\n  },\n\n  assignRangeValues: (variation, currentAllocation) => {\n    let stepFactor;\n    stepFactor = CampaignUtil._getVariationBucketRange(variation.weight);\n\n    if (stepFactor) {\n      variation.startVariationAllocation = currentAllocation + 1;\n      variation.endVariationAllocation = currentAllocation + stepFactor;\n    } else {\n      variation.startVariationAllocation = -1;\n      variation.endVariationAllocation = -1;\n    }\n    return stepFactor;\n  },\n  getCampaignGoal: (settingsFile, campaignKey, goalIdentifier) => {\n    let desiredCampaignGoal = null;\n\n    if (!settingsFile || !campaignKey || !goalIdentifier) {\n      return desiredCampaignGoal;\n    }\n\n    let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n    if (!campaign) {\n      return desiredCampaignGoal;\n    }\n\n    for (let i = 0; i < campaign.goals.length; i++) {\n      let goal = campaign.goals[i];\n\n      if (goal.identifier === goalIdentifier) {\n        desiredCampaignGoal = goal;\n        break;\n      }\n    }\n\n    return desiredCampaignGoal;\n  },\n  getCampaignVariation: (settingsFile, campaignKey, variationName) => {\n    let desiredVariation = null;\n\n    if (!settingsFile || !campaignKey || !variationName) {\n      return desiredVariation;\n    }\n\n    let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n    if (!campaign) {\n      return desiredVariation;\n    }\n\n    for (let i = 0; i < campaign.variations.length; i++) {\n      let variation = campaign.variations[i];\n\n      if (variation.name === variationName) {\n        desiredVariation = variation;\n\n        break;\n      }\n    }\n\n    return desiredVariation;\n  },\n  getControlForCampaign: campaign => {\n    let control = {};\n\n    if (!campaign || !campaign.variations) {\n      return control;\n    }\n\n    for (let i = 0; i < campaign.variations.length; i++) {\n      if (campaign.variations[i].id === 1) {\n        control = campaign.variations[i];\n        break;\n      }\n    }\n\n    return control;\n  },\n  isFeatureTestCampaign: campaign => {\n    if (campaign && campaign.type === CampaignTypeEnum.FEATURE_TEST) {\n      return true;\n    }\n\n    return false;\n  },\n  isFeatureRolloutCampaign: campaign => {\n    if (campaign && campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT) {\n      return true;\n    }\n\n    return false;\n  },\n  isAbCampaign: campaign => {\n    if (campaign && campaign.type === CampaignTypeEnum.AB) {\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Check if the campaign is a part of mutually exclusive group\n   *\n   * @param {Object} settingsFile\n   * @param {Number} campaignId\n   *\n   * @returns {Number} group id of the campaign.\n   */\n  isPartOfGroup: (settingsFile, campaignId) => {\n    if (settingsFile.campaignGroups && Object.prototype.hasOwnProperty.call(settingsFile.campaignGroups, campaignId)) {\n      return {\n        groupId: settingsFile.campaignGroups[campaignId],\n        groupName: settingsFile.groups[settingsFile.campaignGroups[campaignId]].name\n      };\n    }\n    return {};\n  },\n\n  /**\n   * Get the list of campaigns on the basis of their id\n   *\n   * @param {Object} settingsFile\n   * @param {Number} groupId\n   *\n   * @returns {Array} list of campaigns\n   */\n  getGroupCampaigns: (settingsFile, groupId) => {\n    const campaigns = [];\n    if (Object.prototype.hasOwnProperty.call(settingsFile.groups, groupId)) {\n      settingsFile.groups[groupId].campaigns.forEach(campaignId => {\n        let campaign = CampaignUtil.getCampaignBasedOnId(settingsFile, campaignId);\n        if (campaign) {\n          campaigns.push(campaign);\n        }\n      });\n    }\n    return campaigns;\n  },\n\n  /**\n   * Decide the Seed for murmurhash to bucket user.\n   * @param {string} userId\n   * @param {object} campaign\n   * @param {number} groupId\n   *\n   * @returns {string} Seed value\n   */\n  getBucketingSeed: (userId, campaign, groupId) => {\n    if (groupId) {\n      return `${groupId}_${userId}`;\n    }\n\n    const isNB = VWOFeatureFlags.getAll().isNB;\n    const isNBv2 = VWOFeatureFlags.getAll().isNBv2;\n\n    if (isNB || isNBv2 || (campaign && campaign.isBucketingSeedEnabled)) {\n      return `${campaign.id}_${userId}`;\n    } else {\n      return userId;\n    }\n  }\n};\n\nmodule.exports = CampaignUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst VariationDecider = require('../core/VariationDecider');\nconst BucketingService = require('../core/BucketingService');\n\nconst CampaignUtil = require('./CampaignUtil');\nconst DataTypeUtil = require('./DataTypeUtil');\nconst FunctionUtil = require('./FunctionUtil');\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst StatusEnum = require('../enums/StatusEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\nconst SegmentEvaluator = require('../core/SegmentEvaluator');\nconst HooksManager = require('../services/HooksManager');\nconst HooksEnum = require('../enums/HooksEnum');\nconst UuidUtil = require('./UuidUtil');\nconst Constants = require('../constants');\nconst CampaignTypeEnum = require('../enums/CampaignTypeEnum');\nconst ApiEnum = require('../enums/ApiEnum');\nconst RandomAlgo = 1;\n\nconst file = FileNameEnum.DecisionUtil;\n\nconst SegmentationTypeEnum = {\n  WHITELISTING: 'whitelisting',\n  PRE_SEGMENTATION: 'pre-segmentation'\n};\n\nlet DecisionUtil = {\n  // PUBLIC METHODS\n  /**\n   *  1. Checks if there is a variation stored in userStorage, returns it\n   *  2. If Whitelisting is applicable, evaluate it, if any eligible variation is found, store it in User Storage service and return, otherwise skip it.\n   *  3. Check if the campaign is part of mutually exclusive group, if yes, get the winner campaign using campaign traffic normalization.\n   *  4. If Pre-segmentation is applied and passes then go further otherwise return early and no further processing\n   *  5. If no user storage value, no whitelisted variation and pre-segmentation evaluates to true, get variation using hashing logic if campaign traffic passes for that userId\n   *\n   *\n   *  @param {Object} config\n   *  @param {Object} settingsFile\n   *  @param {Object} campaign\n   *  @param {Object} campaignKey\n   *  @param {String} userId\n   *  @param {Object} customVariables\n   *  @param {Object} variationTargetingVariables\n   *\n   *  @return {Object|null} - Object if a variation is assigned, otherwise null\n   */\n  getVariation: (\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables = {},\n    userStorageData = {},\n    metaData,\n    isTrackUserAPI,\n    isTrackGoalAPI,\n    newGoalIdentifier,\n    api = ''\n  ) => {\n    let vwoUserId = UuidUtil.generateFor(userId, settingsFile.accountId);\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_UUID, {\n        file: FileNameEnum.UuidUtil,\n        userId,\n        accountId: settingsFile.accountId,\n        uuid: vwoUserId\n      })\n    );\n\n    let decision = {\n      // campaign info\n      campaignId: campaign.id,\n      campaignKey,\n      campaignType: campaign.type,\n      campaignName: campaign.name,\n      // campaign segmentation conditions\n      customVariables,\n      // event name\n      event: HooksEnum.DECISION_TYPES.CAMPAIGN_DECISION,\n      // goal tracked in case of track API\n      goalIdentifier: newGoalIdentifier,\n      // campaign whitelisting flag\n      isForcedVariationEnabled: campaign.isForcedVariationEnabled,\n      sdkVersion: Constants.SDK_VERSION,\n      // API name which triggered the event\n      source: api,\n      // Passed in API\n      userId,\n      // Campaign Whitelisting conditions\n      variationTargetingVariables,\n      // VWO generated UUID based on passed UserId and Account ID\n      vwoUserId\n    };\n\n    // check if the campaign is a part of group\n    const { groupId, groupName } = CampaignUtil.isPartOfGroup(settingsFile, campaign.id);\n\n    if (groupId) {\n      // append groupId and groupName, if campaign is a part of group\n      decision['groupId'] = groupId;\n      decision['groupName'] = groupName;\n    }\n\n    variationTargetingVariables = Object.assign({}, variationTargetingVariables, {\n      _vwoUserId: campaign.isUserListEnabled ? vwoUserId : userId\n    });\n\n    // check if tbe campaign satisfies the whitelisting before checking for the group\n    const whitelistedVariation = DecisionUtil._checkForWhitelisting(\n      config,\n      campaign,\n      campaignKey,\n      userId,\n      variationTargetingVariables,\n      decision\n    );\n    if (whitelistedVariation) {\n      if (DataTypeUtil.isPromise(whitelistedVariation)) {\n        return whitelistedVariation.then(data => {\n          if (Object.keys(data).length > 0) {\n            return data;\n          }\n        });\n      } else {\n        return whitelistedVariation;\n      }\n    }\n\n    // check if the campaign is present in the storage before checking for the group\n\n    let storedVariation;\n    // check if asyncStorage, if yes then synchronously get the data and return promise\n    if (config.asyncStorageConfig) {\n      return new Promise(resolve => {\n        return DecisionUtil._checkForUserStorage(\n          config,\n          settingsFile,\n          campaign,\n          campaignKey,\n          userId,\n          userStorageData,\n          isTrackUserAPI,\n          decision\n        ).then(function(response) {\n          if (response && DataTypeUtil.isObject(response) && Object.keys(response).length > 0) {\n            resolve(Object.assign({}, { isStoredVariation: true }, response));\n          } else if (isTrackGoalAPI) {\n            resolve(Object.assign({}));\n          } else {\n            const variationWithoutStorageLookup = DecisionUtil.evaluateAndGetVariationWithoutStorage(\n              config,\n              settingsFile,\n              campaign,\n              campaignKey,\n              userId,\n              customVariables,\n              variationTargetingVariables,\n              userStorageData,\n              metaData,\n              isTrackUserAPI,\n              newGoalIdentifier,\n              decision,\n              groupId,\n              groupName\n            );\n            resolve(variationWithoutStorageLookup);\n          }\n        });\n      });\n    } else {\n      storedVariation = DecisionUtil._checkForUserStorage(\n        config,\n        settingsFile,\n        campaign,\n        campaignKey,\n        userId,\n        userStorageData,\n        isTrackUserAPI,\n        decision\n      );\n    }\n\n    if (storedVariation) {\n      return storedVariation;\n    }\n\n    return DecisionUtil.evaluateAndGetVariationWithoutStorage(\n      config,\n      settingsFile,\n      campaign,\n      campaignKey,\n      userId,\n      customVariables,\n      variationTargetingVariables,\n      userStorageData,\n      metaData,\n      isTrackUserAPI,\n      newGoalIdentifier,\n      decision,\n      groupId,\n      groupName\n    );\n  },\n\n  evaluateAndGetVariationWithoutStorage(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables,\n    userStorageData,\n    metaData,\n    isTrackUserAPI,\n    newGoalIdentifier,\n    decision,\n    groupId,\n    groupName\n  ) {\n    // check if the called campaign satisfies the pre-segmentation before further processing.\n    if (\n      !(\n        DecisionUtil._checkForPreSegmentation(campaign, campaignKey, userId, customVariables, decision) &&\n        BucketingService.isUserPartOfCampaign(userId, campaign, true)\n      )\n    ) {\n      return {};\n    }\n\n    if (groupId) {\n      // mutually exclusive group exists\n\n      // get the list of the all the campaigns in a group\n      const campaignList = CampaignUtil.getGroupCampaigns(settingsFile, groupId);\n\n      if (campaignList.length === 0) {\n        // return if no campaigns are active in a group\n        return {};\n      }\n\n      // checking other campaigns for whitelisting and user storage.\n      let isWhitelistedOrStoredVariation = DecisionUtil._checkForStorageAndWhitelisting(\n        config,\n        settingsFile,\n        groupName,\n        campaignList,\n        campaign,\n        userId,\n        userStorageData,\n        variationTargetingVariables,\n        isTrackUserAPI\n      );\n\n      if (isWhitelistedOrStoredVariation) {\n        // other campaigns satisfy the whitelisting or storage, therfore returning\n        logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_CALLED_CAMPAIGN_NOT_WINNER, {\n            userId,\n            groupName,\n            file,\n            campaignKey: campaignKey\n          })\n        );\n        if (DataTypeUtil.isPromise(isWhitelistedOrStoredVariation)) {\n          return new Promise(resolve => {\n            resolve(Object.assign({}));\n          });\n        }\n        return {};\n      }\n\n      // none of the group campaigns satisfy whitelisting or user storage\n      // check each campaign for pre-segmentation and traffic allocation.\n      let inEligibleCampaignKeys = '';\n      let eligibleCampaignKeys = '';\n      const { eligibleCampaigns, inEligibleCampaigns } = DecisionUtil.getEligbleCampaigns(\n        campaignList,\n        userId,\n        customVariables\n      );\n\n      inEligibleCampaigns.forEach(campaign => {\n        inEligibleCampaignKeys = inEligibleCampaignKeys + campaign.key + ',';\n      });\n      eligibleCampaigns.forEach(campaign => {\n        eligibleCampaignKeys = eligibleCampaignKeys + campaign.key + ',';\n      });\n\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.MEG_ELIGIBLE_CAMPAIGNS, {\n          userId,\n          groupName,\n          file,\n          eligibleCampaignKeys: eligibleCampaignKeys.slice(0, -1),\n          inEligibleText:\n            inEligibleCampaignKeys === '' ? 'no campaigns' : `campaigns: ${inEligibleCampaignKeys.slice(0, -1)}`\n        })\n      );\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_ELIGIBLE_CAMPAIGNS, {\n          userId,\n          groupName,\n          file,\n          noOfEligibleCampaigns: eligibleCampaigns.length,\n          noOfGroupCampaigns: inEligibleCampaigns.length + eligibleCampaigns.length\n        })\n      );\n\n      // Whether normalised/random implementation has to be done or advanced\n      let megAlgoNumber =\n        typeof settingsFile.groups[groupId].et !== 'undefined' ? settingsFile.groups[groupId].et : RandomAlgo;\n\n      if (eligibleCampaigns.length === 1) {\n        // if the called campaign is the only winner.\n        return DecisionUtil.evaluateTrafficAndGetVariation(\n          config,\n          eligibleCampaigns[0],\n          eligibleCampaigns[0].key,\n          userId,\n          metaData,\n          newGoalIdentifier,\n          decision\n        );\n      } else {\n        if (megAlgoNumber === RandomAlgo) {\n          // normalize the eligible campaigns and decide winner\n          return DecisionUtil._normalizeAndFindWinningCampaign(\n            config,\n            campaign,\n            eligibleCampaigns,\n            userId,\n            groupName,\n            groupId,\n            metaData,\n            newGoalIdentifier,\n            decision\n          );\n        } else {\n          return DecisionUtil._advancedAlgoFindWinningCampaign(\n            config,\n            settingsFile,\n            campaign,\n            eligibleCampaigns,\n            userId,\n            groupName,\n            groupId,\n            metaData,\n            newGoalIdentifier,\n            decision\n          );\n        }\n      }\n    } else {\n      // campaign is not a part of mutually exclusive group\n      // check if the user is eligible to become part of the campaign and assign variation.\n      return DecisionUtil.evaluateTrafficAndGetVariation(\n        config,\n        campaign,\n        campaignKey,\n        userId,\n        metaData,\n        newGoalIdentifier,\n        decision\n      );\n    }\n  },\n  // PRIVATE METHODS\n\n  _evaluateWhitelisting: (campaign, campaignKey, userId, variationTargetingVariables, disableLogs = false) => {\n    let whitelistedVariation;\n    let status;\n    const targetedVariations = [];\n    campaign.variations.forEach(variation => {\n      if (DataTypeUtil.isObject(variation.segments) && !Object.keys(variation.segments).length) {\n        logger.log(\n          LogLevelEnum.DEBUG,\n          LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.SEGMENTATION_SKIPPED, {\n            campaignKey,\n            userId,\n            file,\n            variation: campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT ? '' : `, for ${variation.name}`\n          }),\n          disableLogs\n        );\n        return;\n      }\n      if (\n        DataTypeUtil.isObject(variation.segments) &&\n        SegmentEvaluator(variation.segments, variationTargetingVariables, campaignKey, userId, variation.name)\n      ) {\n        status = StatusEnum.PASSED;\n        targetedVariations.push(FunctionUtil.cloneObject(variation));\n      } else {\n        status = StatusEnum.FAILED;\n      }\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.SEGMENTATION_STATUS, {\n          campaignKey,\n          userId,\n          customVariables: JSON.stringify(variationTargetingVariables),\n          file,\n          status,\n          segmentationType: SegmentationTypeEnum.WHITELISTING,\n          variation:\n            campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT && status === StatusEnum.PASSED\n              ? 'and becomes part of the rollout'\n              : `for ${variation.name}`\n        }),\n        disableLogs\n      );\n    });\n\n    if (targetedVariations.length > 1) {\n      CampaignUtil.scaleVariationWeights(targetedVariations);\n      for (let i = 0, currentAllocation = 0, stepFactor = 0; i < targetedVariations.length; i++) {\n        stepFactor = CampaignUtil.assignRangeValues(targetedVariations[i], currentAllocation);\n        currentAllocation += stepFactor;\n      }\n      whitelistedVariation = BucketingService._getVariation(\n        targetedVariations,\n        BucketingService.calculateBucketValue(CampaignUtil.getBucketingSeed(userId, campaign))\n      );\n    } else {\n      whitelistedVariation = targetedVariations[0];\n    }\n\n    if (whitelistedVariation) {\n      return {\n        variation: whitelistedVariation,\n        variationName: whitelistedVariation.name,\n        variationId: whitelistedVariation.id\n      };\n    }\n  },\n  /**\n   * Get the User Variation mapping by calling get method of UserStorageService being provided\n   *\n   * @param {Object} config\n   * @param {String} UserID\n   * @param {String} campaignKey\n   *\n   * @return {Object} - User Campaign Mapping\n   */\n  _getStoredUserData: function(config, userId, campaignKey, userStorageData, disableLogs) {\n    let userStorageMap = {\n      userId: userId,\n      variationName: null,\n      campaignKey: campaignKey,\n      goalIdentifier: null\n    };\n\n    if (!config.userStorageService) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_STORAGE_SERVICE_NOT_CONFIGURED, {\n          file\n        }),\n        disableLogs\n      );\n      return userStorageMap;\n    }\n\n    if (config.asyncStorageConfig) {\n      try {\n        return config.userStorageService\n          .get(userId, campaignKey)\n          .then(data => {\n            // if data found\n            logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.GETTING_DATA_USER_STORAGE_SERVICE, {\n                file,\n                userId,\n                campaignKey\n              }),\n              disableLogs\n            );\n\n            let finalData = Object.assign({}, data, userStorageData);\n\n            return finalData;\n          })\n          .catch(_error => {\n            // TODO: add log for failed fetch\n            console.log('Failed to fetch data from Storage Service', _error);\n          });\n      } catch (err) {\n        // if no data found\n        logger.log(\n          LogLevelEnum.ERROR,\n          LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.USER_STORAGE_SERVICE_GET_FAILED, {\n            file,\n            userId,\n            error: err\n          }),\n          disableLogs\n        );\n      }\n    } else {\n      try {\n        let data = config.userStorageService.get(userId, campaignKey) || {};\n\n        // if data found\n        logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.GETTING_DATA_USER_STORAGE_SERVICE, {\n            file,\n            userId,\n            campaignKey\n          }),\n          disableLogs\n        );\n\n        return Object.assign({}, data, userStorageData);\n      } catch (err) {\n        // if no data found\n        logger.log(\n          LogLevelEnum.ERROR,\n          LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.USER_STORAGE_SERVICE_GET_FAILED, {\n            file,\n            userId,\n            error: err\n          }),\n          disableLogs\n        );\n      }\n    }\n  },\n\n  /**\n   * If UserStorageService is provided and variation was stored, save the assigned variation\n   *\n   * @param {Object} campaign\n   * @param {String} variationName\n   * @param {String} userId\n   *\n   * @return {Boolean} - true if found otherwise false\n   */\n  _saveUserData: function(config, campaign, variationName, userId, metaData, goalIdentifier) {\n    let isSaved = false;\n\n    if (!config.userStorageService) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_STORAGE_SERVICE_NOT_CONFIGURED, {\n          file\n        })\n      );\n      return isSaved;\n    }\n\n    try {\n      const properties = {\n        userId: userId,\n        variationName,\n        campaignKey: campaign.key\n      };\n\n      if (!DataTypeUtil.isUndefined(goalIdentifier)) {\n        properties.goalIdentifier = goalIdentifier;\n      }\n\n      if (!DataTypeUtil.isUndefined(metaData)) {\n        properties.metaData = metaData;\n      }\n\n      config.userStorageService.set(properties);\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.SETTING_DATA_USER_STORAGE_SERVICE, {\n          file,\n          userId,\n          campaignKey: campaign.key\n        })\n      );\n\n      isSaved = true;\n    } catch (err) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.USER_STORAGE_SERVICE_SET_FAILED, {\n          file,\n          userId,\n          error: err\n        })\n      );\n\n      isSaved = false;\n    }\n\n    return isSaved;\n  },\n\n  /**\n   * Evaluate the campaign for whitelisting and store\n   * This method would be run only for MEG campaigns\n   *\n   * @param {Object} config\n   * @param {Object} settingsFile\n   * @param {Array} campaignList\n   * @param {Object} calledCampaign\n   * @param {String} userId\n   * @param {Object} userStorageData\n   * @param {Object} variationTargetingVariables\n   * @param {Boolean} isTrackUserAPI\n   *\n   * @returns {Boolean} - true, if whitelisting/storage is satisfied for any campaign\n   */\n  _checkForStorageAndWhitelisting(\n    config,\n    settingsFile,\n    groupName,\n    campaignList,\n    calledCampaign,\n    userId,\n    userStorageData,\n    variationTargetingVariables,\n    isTrackUserAPI\n  ) {\n    let otherCampaignWinner = false;\n    campaignList.some(groupCampaign => {\n      if (groupCampaign.id === calledCampaign.id) {\n        return;\n      }\n      // create a local copy of the campaigns\n      // groupCampaign = FunctionUtil.cloneObject(groupCampaign);\n      // checking other campaigns for whitelisting or user storage.\n      const whitelistedVariation = DecisionUtil._checkForWhitelisting(\n        config,\n        groupCampaign,\n        groupCampaign.key,\n        userId,\n        variationTargetingVariables\n      );\n      if (whitelistedVariation) {\n        if (DataTypeUtil.isPromise(whitelistedVariation)) {\n          return whitelistedVariation.then(data => {\n            otherCampaignWinner = true;\n            logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.OTHER_CAMPAIGN_SATISFIES_WHITELISTING_STORAGE, {\n                file,\n                campaignKey: groupCampaign.key,\n                groupName,\n                userId,\n                type: 'whitelisting'\n              })\n            );\n            return new Promise(resolve => {\n              resolve(true);\n            });\n          });\n        } else {\n          // other campaign satisfy the whitelisting\n          otherCampaignWinner = true;\n          logger.log(\n            LogLevelEnum.INFO,\n            LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.OTHER_CAMPAIGN_SATISFIES_WHITELISTING_STORAGE, {\n              file,\n              campaignKey: groupCampaign.key,\n              groupName,\n              userId,\n              type: 'whitelisting'\n            })\n          );\n          return true;\n        }\n      }\n\n      const storedVariation = DecisionUtil._checkForUserStorage(\n        config,\n        settingsFile,\n        groupCampaign,\n        groupCampaign.key,\n        userId,\n        userStorageData,\n        isTrackUserAPI\n      );\n\n      if (storedVariation && DataTypeUtil.isPromise(storedVariation)) {\n        otherCampaignWinner = true;\n        logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.OTHER_CAMPAIGN_SATISFIES_WHITELISTING_STORAGE, {\n            file,\n            campaignKey: groupCampaign.key,\n            groupName,\n            userId,\n            type: 'user storage'\n          })\n        );\n        // return true;\n        return new Promise(resolve => {\n          resolve(true);\n        });\n      }\n      if (storedVariation && DataTypeUtil.isObject(storedVariation) && Object.keys(storedVariation).length > 0) {\n        // other campaign satisfy the user storage\n        otherCampaignWinner = true;\n        logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.OTHER_CAMPAIGN_SATISFIES_WHITELISTING_STORAGE, {\n            file,\n            campaignKey: groupCampaign.key,\n            groupName,\n            userId,\n            type: 'user storage'\n          })\n        );\n        return true;\n      }\n    });\n    if (config.asyncStorageConfig) {\n      return new Promise(resolve => {\n        resolve(otherCampaignWinner);\n      });\n    }\n    return otherCampaignWinner;\n  },\n\n  /**\n   * Evaluate a campaign for pre-segmentation.\n   *\n   * @param {Object} campaign\n   * @param {String} campaignKey\n   * @param {String} userId\n   * @param {Object} customVariables\n   * @param {Object} decision\n   *\n   * @returns {Boolean} true, if the pre-segmentation is satisfied.\n   */\n  _checkForPreSegmentation: (campaign, campaignKey, userId, customVariables, decision) => {\n    let status;\n    if (DataTypeUtil.isObject(campaign.segments) && !Object.keys(campaign.segments).length) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.SEGMENTATION_SKIPPED, {\n          campaignKey,\n          userId,\n          file\n        }),\n        !decision\n      );\n      return true;\n    } else {\n      const preSegmentationResult = SegmentEvaluator(\n        campaign.segments,\n        customVariables,\n        campaignKey,\n        userId,\n        !decision\n      );\n      if (!preSegmentationResult) {\n        status = StatusEnum.FAILED;\n      } else {\n        status = StatusEnum.PASSED;\n      }\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.SEGMENTATION_STATUS, {\n          campaignKey,\n          userId,\n          customVariables: JSON.stringify(customVariables || {}),\n          file,\n          status,\n          segmentationType: SegmentationTypeEnum.PRE_SEGMENTATION,\n          variation: ''\n        }),\n        !decision\n      );\n\n      if (status === StatusEnum.FAILED) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n\n  /**\n   * Check if user is eligible for the camapign based on traffic percentage and assign variation.\n   * @param {Object} config\n   * @param {Object} campaign\n   * @param {String} campaignKey\n   * @param {String} userId\n   * @param {Object} metaData\n   * @param {String} newGoalIdentifier\n   * @param {Object} decision\n   * @returns {Object} variation assigned to the user\n   */\n  evaluateTrafficAndGetVariation(config, campaign, campaignKey, userId, metaData, newGoalIdentifier, decision) {\n    let variation, variationName, variationId;\n    // Use our core's VariationDecider utility to get the deterministic variation assigned to the userId for that campaign\n    ({ variation, variationName, variationId } = VariationDecider.getVariationAllotted(\n      userId,\n      campaign,\n      config.settingsFile.accountId\n    ));\n    logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.USER_VARIATION_ALLOCATION_STATUS, {\n        file,\n        campaignKey,\n        userId,\n        status: variationName ? `got variation:${variationName}` : 'did not get any variation'\n      })\n    );\n\n    // Check if variation-name has been assigned to the userId. If not, return no variation\n    if (variationName) {\n      // If userStorageService is provided, look into it for the saved variation for the campaign and userId\n      DecisionUtil._saveUserData(config, campaign, variationName, userId, metaData, newGoalIdentifier);\n    }\n\n    // Executing the callback when SDK makes the decision\n    HooksManager.execute(\n      Object.assign(\n        {\n          fromUserStorageService: false,\n          isUserWhitelisted: false\n        },\n        campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT\n          ? {\n              isFeatureEnabled: !!variationName\n            }\n          : {\n              variationName,\n              variationId\n            },\n        decision\n      )\n    );\n\n    return {\n      variation: variation && variation.variation,\n      variationName,\n      variationId\n    };\n  },\n\n  /**\n   * Evaluate a campaign for whitelisting\n   *\n   * @param {Object} campaign\n   * @param {String} campaignKey\n   * @param {String} userId\n   * @param {Object} variationTargetingVariables\n   * @param {Object} decision\n   *\n   * @returns {Object} whitelisted variation\n   */\n  _checkForWhitelisting: (config, campaign, campaignKey, userId, variationTargetingVariables, decision) => {\n    let status;\n    let variationName, variationId;\n    if (campaign.isForcedVariationEnabled) {\n      let whitelistingResult = DecisionUtil._evaluateWhitelisting(\n        campaign,\n        campaignKey,\n        userId,\n        variationTargetingVariables,\n        !decision\n      );\n      let variationString;\n      if (whitelistingResult) {\n        status = StatusEnum.PASSED;\n        variationString = whitelistingResult.variationName;\n      } else {\n        status = StatusEnum.FAILED;\n        variationString = '';\n      }\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.SEGMENTATION_STATUS, {\n          campaignKey,\n          userId,\n          customVariables: JSON.stringify(variationTargetingVariables),\n          file,\n          status,\n          segmentationType: SegmentationTypeEnum.WHITELISTING,\n          variation: campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT ? '' : `for variation: ${variationString}`\n        }),\n        !decision\n      );\n\n      if (whitelistingResult) {\n        variationName = whitelistingResult.variationName;\n        variationId = whitelistingResult.variationId;\n        // Executing the callback when SDK has made a decision in case of whitelisting\n        if (decision) {\n          HooksManager.execute(\n            Object.assign(\n              {\n                fromUserStorageService: false,\n                isUserWhitelisted: !!variationName\n              },\n              campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT\n                ? {\n                    isFeatureEnabled: !!variationName\n                  }\n                : {\n                    variationName,\n                    variationId\n                  },\n              decision\n            )\n          );\n        }\n        if (config.asyncStorageConfig) {\n          return new Promise(resolve => resolve(whitelistingResult));\n        }\n        return whitelistingResult;\n      }\n    } else {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.WHITELISTING_SKIPPED, {\n          campaignKey,\n          userId,\n          file\n        }),\n        !decision\n      );\n    }\n  },\n\n  /**\n   * Check if the variation is present in the user storage\n   *\n   * @param {Object} config\n   * @param {Object} settingsFile\n   * @param {Object} campaign\n   * @param {String} campaignKey\n   * @param {String} userId\n   * @param {Object} userStorageData\n   * @param {Boolean} isTrackUserAPI\n   * @param {Object} decision\n   *\n   * @returns {Object} stored variaition\n   */\n  _checkForUserStorage: (\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    userStorageData,\n    isTrackUserAPI,\n    decision\n  ) => {\n    let userData;\n\n    if (config.asyncStorageConfig) {\n      return DecisionUtil._getStoredUserData(config, userId, campaignKey, userStorageData, !decision).then(function(\n        userData\n      ) {\n        userData = userData || { variationName: null, goalIdentifier: null };\n\n        return DecisionUtil._processAfterGettingFromStorage(\n          config,\n          settingsFile,\n          campaign,\n          campaignKey,\n          userId,\n          isTrackUserAPI,\n          decision,\n          userData\n        );\n      });\n    } else {\n      userData = DecisionUtil._getStoredUserData(config, userId, campaignKey, userStorageData, !decision);\n\n      return DecisionUtil._processAfterGettingFromStorage(\n        config,\n        settingsFile,\n        campaign,\n        campaignKey,\n        userId,\n        isTrackUserAPI,\n        decision,\n        userData\n      );\n    }\n  },\n\n  _processAfterGettingFromStorage(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    isTrackUserAPI,\n    decision,\n    userData\n  ) {\n    let { variationName, goalIdentifier } = userData;\n    let storedVariation;\n\n    if (userData && userData.campaignKey && variationName) {\n      storedVariation = CampaignUtil.getCampaignVariation(settingsFile, campaignKey, variationName);\n    } else {\n      // Log if stored variation is not found even after implementing UserStorageService\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_STORAGE_SERVICE_NO_STORED_DATA, {\n          file,\n          campaignKey,\n          userId\n        }),\n        !decision\n      );\n    }\n\n    let variationId;\n\n    // If stored variation is found, simply return the same\n    if (storedVariation) {\n      variationName = storedVariation.name;\n      variationId = storedVariation.id;\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.GOT_STORED_VARIATION, {\n          file,\n          campaignKey,\n          userId,\n          variationName\n        }),\n        !decision\n      );\n\n      // Executing the callback when SDK gets the decision from user storage service\n      if (decision) {\n        HooksManager.execute(\n          Object.assign(\n            {\n              fromUserStorageService: !!variationName,\n              isUserWhitelisted: false\n            },\n            campaign.type === CampaignTypeEnum.FEATURE_ROLLOUT\n              ? {\n                  isFeatureEnabled: !!variationName\n                }\n              : {\n                  variationName,\n                  variationId\n                },\n            decision\n          )\n        );\n      }\n\n      return {\n        variation: storedVariation,\n        variationName,\n        variationId,\n        storedGoalIdentifier: goalIdentifier,\n        isStoredVariation: true\n      };\n    } else if (\n      !DataTypeUtil.isUndefined(config.userStorageService) &&\n      !isTrackUserAPI &&\n      DataTypeUtil.isUndefined(storedVariation)\n    ) {\n      logger.log(\n        LogLevelEnum.WARN,\n        LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_ACTIVATED, {\n          file,\n          campaignKey,\n          userId,\n          api: config.apiName\n        }),\n        !decision\n      );\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CAMPAIGN_NOT_ACTIVATED, {\n          file,\n          campaignKey,\n          userId,\n          reason: config.apiName === ApiEnum.TRACK ? 'track it' : 'get the decision/value'\n        }),\n        !decision\n      );\n      return {};\n    }\n  },\n\n  /**\n   * Evaluate the list of campaigns for pre-segmentation and campaign traffic allocation and assign variation to the user.\n   * This method will be used for MEG campaigns\n   *\n   * @param {Object} config\n   * @param {Array} campaignList\n   * @param {String} userId\n   * @param {Object} customVariables\n   * @param {Object} metaData\n   * @param {String} newGoalIdentifier\n   *\n   * @returns {Array} list of campaigns which satisfies the conditions.\n   */\n  getEligbleCampaigns(campaignList, userId, customVariables) {\n    let eligibleCampaigns = [];\n    let inEligibleCampaigns = [];\n\n    campaignList.forEach(groupCampaign => {\n      const isPartOfCampaign =\n        DecisionUtil._checkForPreSegmentation(groupCampaign, groupCampaign.key, userId, customVariables) &&\n        BucketingService.isUserPartOfCampaign(userId, groupCampaign, true);\n      if (isPartOfCampaign) {\n        groupCampaign = FunctionUtil.cloneObject(groupCampaign);\n        // campaign satisfies the pre-segmentation\n        eligibleCampaigns.push(groupCampaign);\n      } else {\n        inEligibleCampaigns.push(groupCampaign);\n      }\n    });\n\n    return {\n      eligibleCampaigns,\n      inEligibleCampaigns\n    };\n  },\n\n  /**\n   * Equally distribute the traffic of campaigns and assign a winner campaign by murmur hash.\n   *\n   * @param {Object} config\n   * @param {Object} calledCampaign\n   * @param {Array} shortlistedCampaigns\n   * @param {String} userId\n   * @param {Object} metaData\n   * @param {String} newGoalIdentifier\n   * @param {Object} decision\n   *\n   * @returns {Object} variation of the winner campaign\n   */\n  _normalizeAndFindWinningCampaign(\n    config,\n    calledCampaign,\n    shortlistedCampaigns,\n    userId,\n    groupName,\n    groupId,\n    metaData,\n    newGoalIdentifier,\n    decision\n  ) {\n    // normalise the weights of all the shortlisted campaigns\n    shortlistedCampaigns.forEach(campaign => {\n      campaign.weight = Math.floor(100 / shortlistedCampaigns.length);\n    });\n\n    // re-distribute the traffic for each camapign\n    CampaignUtil.setCampaignAllocation(shortlistedCampaigns);\n\n    let winnerCampaign = BucketingService._getVariation(\n      shortlistedCampaigns,\n      BucketingService.calculateBucketValue(CampaignUtil.getBucketingSeed(userId, undefined, groupId))\n    );\n\n    logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_GOT_WINNER_CAMPAIGN, {\n        userId,\n        groupName,\n        file,\n        campaignKey: winnerCampaign.key\n      })\n    );\n\n    if (winnerCampaign.id === calledCampaign.id) {\n      // if called campaign is the winner campaign, get the variation for the campaign\n      return DecisionUtil.evaluateTrafficAndGetVariation(\n        config,\n        winnerCampaign,\n        winnerCampaign.key,\n        userId,\n        metaData,\n        newGoalIdentifier,\n        decision\n      );\n    } else {\n      // if winning campaign not the called camapaign, return\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_CALLED_CAMPAIGN_NOT_WINNER, {\n          userId,\n          groupName,\n          file,\n          campaignKey: calledCampaign.key\n        })\n      );\n      return {};\n    }\n  },\n  /** Assign the winner campaign by checking priority order and/or weightage distribution\n   * @param {Object} config\n   * @param {Object} settingsFile\n   * @param {Object} calledCampaign\n   * @param {Array} shortlistedCampaigns\n   * @param {String} userId\n   * @param {Object} metaData\n   * @param {String} newGoalIdentifier\n   * @param {Object} decision\n   *\n   * @returns {Object} variation of the winner campaign\n   */\n  _advancedAlgoFindWinningCampaign: (\n    config,\n    settingsFile,\n    calledCampaign,\n    shortlistedCampaigns,\n    userId,\n    groupName,\n    groupId,\n    metaData,\n    newGoalIdentifier,\n    decision\n  ) => {\n    let winnerCampaign = null;\n    let found = false; // flag to check whether winnerCampaign has been found or not and helps to break from the outer loop\n    let priorityOrder = typeof settingsFile.groups[groupId].p !== 'undefined' ? settingsFile.groups[groupId].p : {};\n    let wt = typeof settingsFile.groups[groupId].wt !== 'undefined' ? settingsFile.groups[groupId].wt : {};\n\n    for (let i = 0; i < priorityOrder.length; i++) {\n      for (let j = 0; j < shortlistedCampaigns.length; j++) {\n        if (shortlistedCampaigns[j].id === priorityOrder[i]) {\n          winnerCampaign = FunctionUtil.cloneObject(shortlistedCampaigns[j]);\n          found = true;\n          break;\n        }\n      }\n      if (found === true) break;\n    }\n\n    // If winnerCampaign not found through Priority, then go for weighted Random distribution and for that,\n    // Store the list of campaigns (participatingCampaigns) out of shortlistedCampaigns and their corresponding weights present in weightage distribution array (wt)\n    if (winnerCampaign === null) {\n      let participatingCampaignList = [];\n      // iterate over shortlisted campaigns and add weights from the weight array\n      for (let i = 0; i < shortlistedCampaigns.length; i++) {\n        let campaignId = shortlistedCampaigns[i].id;\n        if (typeof wt[campaignId] !== 'undefined') {\n          let clonedCampaign = FunctionUtil.cloneObject(shortlistedCampaigns[i]);\n          clonedCampaign.weight = wt[campaignId];\n          participatingCampaignList.push(clonedCampaign);\n        }\n      }\n      /* Finding winner campaign using weighted Distibution :\n       1. Re-distribute the traffic by assigning range values for each camapign in particaptingCampaignList \n       2. Calculate bucket value for the given userId and groupId\n       3. Get the winnerCampaign by checking the Start and End Bucket Allocations of each campaign\n      */\n\n      CampaignUtil.setCampaignAllocation(participatingCampaignList);\n\n      winnerCampaign = BucketingService._getVariation(\n        participatingCampaignList,\n        BucketingService.calculateBucketValue(CampaignUtil.getBucketingSeed(userId, undefined, groupId))\n      );\n    }\n\n    if (winnerCampaign != null) {\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_GOT_WINNER_CAMPAIGN, {\n          userId,\n          groupName,\n          file,\n          campaignKey: winnerCampaign.key\n        })\n      );\n    }\n    // WinnerCampaign should not be null, in case when winnerCampaign hasn't been found through PriorityOrder and\n    // also shortlistedCampaigns and wt array does not have a single campaign id in common\n    if (winnerCampaign != null && winnerCampaign.id === calledCampaign.id) {\n      // if called campaign is the winner campaign, get the variation for the campaign\n      return DecisionUtil.evaluateTrafficAndGetVariation(\n        config,\n        winnerCampaign,\n        winnerCampaign.key,\n        userId,\n        metaData,\n        newGoalIdentifier,\n        decision\n      );\n    } else {\n      // if winning campaign not the called camapaign, return\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.MEG_CALLED_CAMPAIGN_NOT_WINNER, {\n          userId,\n          groupName,\n          file,\n          campaignKey: calledCampaign.key\n        })\n      );\n      return {};\n    }\n  }\n};\n\nmodule.exports = DecisionUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst GoalTypeEnum = {\n  REVENUE: 'REVENUE_TRACKING',\n  CUSTOM: 'CUSTOM_GOAL',\n  ALL: 'ALL'\n};\n\nmodule.exports = GoalTypeEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ObjectUtil = {\n  areObjectKeys: (obj = {}) => {\n    return Object.keys(obj).length;\n  },\n  getKeyValue: obj => {\n    if (!ObjectUtil.areObjectKeys(obj)) {\n      return;\n    }\n    let key = Object.keys(obj)[0];\n    let value = obj[key];\n    return {\n      key,\n      value\n    };\n  },\n  objectValues: obj => {\n    return Object.keys(obj).map(key => obj[key]);\n  }\n};\n\nmodule.exports = ObjectUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst UrlEnum = require('../enums/UrlEnum');\nconst GoalTypeEnum = require('../enums/GoalTypeEnum');\n\nconst UuidUtil = require('./UuidUtil');\nconst ValidateUtil = require('./ValidateUtil');\nconst FunctionUtil = require('./FunctionUtil');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst DataTypeUtil = require('./DataTypeUtil');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\nconst UrlService = require('../services/UrlService');\n/**\n * Return primary properties required for every network call to VWO server\n * @param {Object} configObj\n * @param {String} userId\n *\n * @returns primary properties\n */\nfunction getPrimaryProperties(configObj, userId) {\n  return {\n    sId: FunctionUtil.getCurrentUnixTimestamp(),\n    u: UuidUtil.generateFor(userId, configObj.accountId)\n  };\n}\n\n/**\n * Return base properties required for every network call to VWO server\n * @param {Object} configObj\n * @param {String} userId\n *\n * @returns base properties\n */\nfunction getBaseProperties(configObj, userId) {\n  const { accountId } = configObj;\n\n  return Object.assign({}, getPrimaryProperties(configObj, userId), ImpressionUtil.getReportingProperties(configObj), {\n    account_id: accountId,\n    random: FunctionUtil.getRandomNumber(),\n    ap: Constants.PLATFORM\n  });\n}\n\nlet ImpressionUtil = {\n  /**\n   * Build properties for the impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} tagKey the tag name\n   * @param {String} tagValue the tag value\n   */\n  buildEventForPushing(configObj, tagKey, tagValue, userId) {\n    const properties = Object.assign({}, getBaseProperties(configObj, userId));\n    properties.url = Constants.HTTPS_PROTOCOL + UrlService.getBaseUrl() + UrlEnum.PUSH;\n    properties.tags = JSON.stringify({\n      u: {\n        [encodeURIComponent(tagKey)]: encodeURIComponent(tagValue)\n      }\n    });\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_PUSH, {\n        file: FileNameEnum.ImpressionUtil,\n        properties: this._getStringifiedLogProperties(properties)\n      })\n    );\n\n    return properties;\n  },\n  /**\n   * Build properties for the bulk impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} tagKey the tag name\n   * @param {String} tagValue the tag value\n   */\n  buildBatchEventForPushing(configObj, tagKey, tagValue, userId) {\n    if (typeof process.env !== 'undefined') {\n      const properties = Object.assign({}, getPrimaryProperties(configObj, userId));\n      properties.eT = 3;\n      properties.t = encodeURIComponent(\n        JSON.stringify({\n          u: {\n            [tagKey]: tagValue\n          }\n        })\n      );\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_PUSH, {\n          file: FileNameEnum.ImpressionUtil,\n          properties: JSON.stringify(properties)\n        })\n      );\n\n      return properties;\n    }\n  },\n  /**\n   * Build properties for the impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} campaignKey, the Campaign ID\n   * @param {Number} variationId, the Variation ID\n   *\n   * @return null if campaign ID or variation ID is invalid\n   */\n  buildEventForTrackingUser(\n    configObj,\n    campaignKey,\n    variationId,\n    userId,\n    usageStats,\n    visitorUserAgent = '',\n    userIpAddress = ''\n  ) {\n    let properties = Object.assign(\n      {\n        experiment_id: campaignKey,\n        combination: variationId,\n        visitor_ua: visitorUserAgent,\n        visitor_ip: userIpAddress\n      },\n      getBaseProperties(configObj, userId),\n      usageStats\n    );\n    properties.ed = JSON.stringify({ p: 'server' });\n    properties.url = Constants.HTTPS_PROTOCOL + UrlService.getBaseUrl() + UrlEnum.TRACK_USER;\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_TRACK_USER, {\n        file: FileNameEnum.ImpressionUtil,\n        properties: this._getStringifiedLogProperties(properties)\n      })\n    );\n\n    return properties;\n  },\n  /**\n   * Build properties for the bulk impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} campaignKey, the Campaign ID\n   * @param {Number} variationId, the Variation ID\n   * @param {String} visitorUserAgent, user agent of visitor\n   * @param {String} userIpAddress, IP of the visitor\n   *\n   * @return null if campaign ID or variation ID is invalid\n   */\n  buildBatchEventForTrackingUser(\n    configObj,\n    campaignKey,\n    variationId,\n    userId,\n    visitorUserAgent = '',\n    userIpAddress = ''\n  ) {\n    if (typeof process.env !== 'undefined') {\n      let properties = Object.assign(\n        {\n          e: campaignKey,\n          c: variationId\n        },\n        getPrimaryProperties(configObj, userId)\n      );\n      properties.eT = 1;\n      properties.visitor_ua = visitorUserAgent;\n      properties.visitor_ip = userIpAddress;\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_TRACK_USER, {\n          file: FileNameEnum.ImpressionUtil,\n          properties: JSON.stringify(properties)\n        })\n      );\n\n      return properties;\n    }\n  },\n  /**\n   * Build properties for the impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} campaignKey, the Campaign ID\n   * @param {Number} variationId, the Variation ID\n   * @param {String} goalId, the Goal ID\n   * @param {String} revenue, the revenue generated on conversion\n   *\n   * @return null if campaign ID or variation ID is invalid\n   */\n  buildEventForTrackingGoal(\n    configObj,\n    campaignKey,\n    variationId,\n    userId,\n    goal = {},\n    revenue = null,\n    visitorUserAgent = '',\n    userIpAddress = ''\n  ) {\n    const goalId = goal.id;\n\n    let properties = Object.assign(\n      {\n        experiment_id: campaignKey,\n        combination: variationId\n      },\n      getBaseProperties(configObj, userId)\n    );\n\n    properties.visitor_ua = visitorUserAgent;\n    properties.visitor_ip = userIpAddress;\n    properties.url = Constants.HTTPS_PROTOCOL + UrlService.getBaseUrl() + UrlEnum.TRACK_GOAL;\n\n    properties['goal_id'] = goalId;\n    if (goal.type === GoalTypeEnum.REVENUE && ValidateUtil.isValidValue(revenue)) {\n      properties['r'] = revenue;\n    }\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_TRACK_GOAL, {\n        file: FileNameEnum.ImpressionUtil,\n        properties: this._getStringifiedLogProperties(properties)\n      })\n    );\n\n    return properties;\n  },\n  /**\n   * Build properties for the bulk impression event\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {String} campaignKey, the Campaign ID\n   * @param {Number} variationId, the Variation ID\n   * @param {String} goalId, the Goal ID\n   * @param {String} revenue, the revenue generated on conversion\n   *\n   * @return null if campaign ID or variation ID is invalid\n   */\n  buildBatchEventForTrackingGoal(\n    configObj,\n    campaignKey,\n    variationId,\n    userId,\n    goal = {},\n    revenue = null,\n    eventProperties = {},\n    visitorUserAgent = '',\n    userIpAddress = ''\n  ) {\n    if (typeof process.env !== 'undefined') {\n      let properties = Object.assign(\n        {\n          e: campaignKey,\n          c: variationId\n        },\n        getPrimaryProperties(configObj, userId)\n      );\n      properties.eT = 2;\n      properties.visitor_ua = visitorUserAgent;\n      properties.visitor_ip = userIpAddress;\n\n      properties.g = goal.id;\n      if (goal.type === GoalTypeEnum.REVENUE && ValidateUtil.isValidValue(revenue)) {\n        properties.r = revenue;\n      } else if (configObj.isEventArchEnabled && eventProperties.hasOwnProperty(goal.revenueProp)) {\n        properties.r = eventProperties[goal.revenueProp];\n      }\n\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_TRACK_GOAL, {\n          file: FileNameEnum.ImpressionUtil,\n          properties: JSON.stringify(properties)\n        })\n      );\n\n      return properties;\n    }\n  },\n\n  /**\n   * Return an object containing properties required for segmenting reports\n   * @param {Object} configObj\n   * @returns reporting properties\n   */\n  getReportingProperties(configObj) {\n    const { sdkKey } = configObj;\n\n    return {\n      [Constants.SDK_QUERY_PARAM]: Constants.SDK_NAME,\n      [Constants.SDK_VERSION_QUERY_PARAM]: Constants.SDK_VERSION,\n      env: sdkKey\n    };\n  },\n\n  /**\n   * Builds generic properties for different tracking calls required by VWO servers.\n   * @param {Object} configObj\n   * @param {String} eventName\n   * @returns properties\n   */\n  getEventsBaseProperties(config, eventName, usageStats = {}, visitorUserAgent = '', userIpAddress = '') {\n    const { sdkKey } = config;\n\n    let properties = Object.assign(\n      {\n        en: eventName,\n        a: config.accountId,\n        env: sdkKey,\n        eTime: FunctionUtil.getCurrentUnixTimestampInMillis(),\n        random: FunctionUtil.getRandomNumber(),\n        p: 'FS',\n        visitor_ua: visitorUserAgent,\n        visitor_ip: userIpAddress\n      },\n      usageStats\n    );\n\n    properties.url = Constants.HTTPS_PROTOCOL + UrlService.getBaseUrl() + UrlEnum.EVENTS;\n    return properties;\n  },\n\n  /**\n   * Builds generic payload required by all the different tracking calls.\n   * @param {Object} configObj\n   * @param {String} userId\n   * @param {String} eventName\n   * @param {Object} usageStats\n   * @returns properties\n   */\n  getEventBasePayload(configObj, userId, eventName) {\n    const uuid = UuidUtil.generateFor(userId, configObj.accountId);\n    const { sdkKey } = configObj;\n\n    let props = {\n      vwo_sdkName: Constants.SDK_NAME,\n      vwo_sdkVersion: Constants.SDK_VERSION,\n      vwo_envKey: sdkKey\n    };\n\n    // if (usageStats) {\n    //   props = Object.assign({}, props, usageStats);\n    // }\n\n    let properties = {\n      d: {\n        msgId: `${uuid}-${FunctionUtil.getCurrentUnixTimestampInMillis()}`,\n        visId: uuid,\n        sessionId: FunctionUtil.getCurrentUnixTimestamp(),\n        event: {\n          props: props,\n          name: eventName,\n          time: FunctionUtil.getCurrentUnixTimestampInMillis()\n        },\n        visitor: {\n          props: {\n            vwo_fs_environment: sdkKey\n          }\n        }\n      }\n    };\n\n    return properties;\n  },\n\n  /**\n   * Builds payload to track the visitor.\n   * @param {Object} configObj\n   * @param {String} userId\n   * @param {String} eventName\n   * @param {String} campaignId\n   * @param {Number} variationId\n   * @returns track-user payload\n   */\n  getTrackUserPayloadData(configObj, userId, eventName, campaignId, variationId) {\n    const properties = this.getEventBasePayload(configObj, userId, eventName);\n\n    properties.d.event.props.id = campaignId;\n    properties.d.event.props.variation = variationId;\n\n    // this is currently required by data-layer team, we can make changes on DACDN and remove it from here\n    properties.d.event.props.isFirst = 1;\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_EVENT_ARCH_TRACK_USER, {\n        file: FileNameEnum.ImpressionUtil,\n        accountId: configObj.accountId,\n        userId,\n        campaignId\n      })\n    );\n\n    return properties;\n  },\n\n  /**\n   * Builds payload to track the Goal.\n   * @param {Object} configObj\n   * @param {String} userId\n   * @param {String} eventName\n   * @param {Object} metricMap\n   * @param {String} revenueValue\n   * @returns track-goal payload\n   */\n  getTrackGoalPayloadData(\n    configObj,\n    userId,\n    eventName,\n    metricMap,\n    revenueValue,\n    revenuePropList,\n    eventProperties = {}\n  ) {\n    const properties = this.getEventBasePayload(configObj, userId, eventName);\n\n    let metric = {};\n    Object.keys(metricMap).forEach(key => {\n      metric[`id_${key}`] = [`g_${metricMap[key].goal.id}`];\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_EVENT_ARCH_TRACK_GOAL, {\n          file: FileNameEnum.ImpressionUtil,\n          goalName: eventName,\n          accountId: configObj.accountId,\n          u: userId,\n          campaignId: key\n        })\n      );\n    });\n\n    properties.d.event.props.vwoMeta = {\n      metric: metric\n    };\n\n    if (revenuePropList && revenueValue && revenuePropList.size > 0) {\n      revenuePropList.forEach(revenueProp => {\n        properties.d.event.props.vwoMeta[revenueProp] = revenueValue;\n      });\n    }\n\n    properties.d.event.props.isCustomEvent = true;\n\n    if (Object.keys(eventProperties).length > 0) {\n      for (const prop in eventProperties) {\n        properties.d.event.props[prop] = eventProperties[prop];\n      }\n    }\n\n    return properties;\n  },\n\n  /**\n   * Builds payload to appply post segmentation on VWO campaign reports.\n   * @param {Object} configObj\n   * @param {String} userId\n   * @param {String} eventName\n   * @param {Object} customDimensionMap\n   * @returns push payload\n   */\n  getPushPayloadData(configObj, userId, eventName, customDimensionMap) {\n    const properties = this.getEventBasePayload(configObj, userId, eventName);\n\n    properties.d.event.props.isCustomEvent = true;\n\n    Object.keys(customDimensionMap).forEach(function(key) {\n      const tagValue = DataTypeUtil.isString(customDimensionMap[key])\n        ? customDimensionMap[key]\n        : JSON.stringify(customDimensionMap[key]);\n      properties.d.visitor.props[key] = tagValue;\n    });\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.IMPRESSION_FOR_EVENT_ARCH_PUSH, {\n        file: FileNameEnum.ImpressionUtil,\n        accountId: configObj.accountId,\n        userId,\n        property: JSON.stringify(customDimensionMap)\n      })\n    );\n\n    return properties;\n  },\n\n  /**\n   * Remove the sensitive keys from the properties to te displayed in the log.\n   * @param {Object} properties\n   * @returns properties without sensitive keys\n   */\n  _getStringifiedLogProperties(properties) {\n    const logProperties = Object.assign({}, properties);\n    delete logProperties.env;\n    return JSON.stringify(logProperties);\n  }\n};\n\nmodule.exports = ImpressionUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst EventEnum = {\n  VWO_VARIATION_SHOWN: 'vwo_variationShown',\n  VWO_SYNC_VISITOR_PROP: 'vwo_syncVisitorProp'\n};\n\nmodule.exports = EventEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst VWOFeatureFlags = {\n  init(settingsFile) {\n    VWOFeatureFlags.isEventArchEnabled = settingsFile.isEventArchEnabled;\n    VWOFeatureFlags.isNB = settingsFile.isNB;\n    VWOFeatureFlags.isNBv2 = settingsFile.isNBv2;\n  },\n\n  getAll() {\n    return {\n      isEventArchEnabled: VWOFeatureFlags.isEventArchEnabled,\n      isNB: VWOFeatureFlags.isNB,\n      isNBv2: VWOFeatureFlags.isNBv2\n    };\n  }\n};\n\nmodule.exports = VWOFeatureFlags;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst UrlEnum = {\n  BASE_URL: 'dev.visualwebsiteoptimizer.com',\n  SETTINGS_URL: '/server-side/settings',\n  WEBHOOK_SETTINGS_URL: '/server-side/pull',\n  TRACK_USER: '/server-side/track-user',\n  TRACK_GOAL: '/server-side/track-goal',\n  PUSH: '/server-side/push',\n  BATCH_EVENTS: '/server-side/batch-events',\n  EVENTS: '/events/t'\n};\n\nmodule.exports = UrlEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Hasher = require('murmurhash');\n\nconst Constants = require('../constants');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst VWOFeatureFlags = require('../utils/VWOFeatureFlags');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\n\nconst file = FileNameEnum.BucketingService;\n\nlet BucketingService = {\n  /**\n   * Generates Bucket Value of the User by hashing the User ID by murmurHash\n   * and scaling it down.\n   *\n   * @param {Number} hashValue the hashValue generated after hashing\n   * @param {Number} maxValue the value up-to which hashValue needs to be scaled\n   * @param {Number} multiplier multiplier in case the traffic allocation is less than 100\n   *\n   * @return {Number} bucket Value of the User\n   */\n  _generateBucketValue: (hashValue, maxValue, multiplier = 1) => {\n    const ratio = hashValue / Math.pow(2, 32);\n    const multipliedValue = (maxValue * ratio + 1) * multiplier;\n    const value = Math.floor(multipliedValue);\n\n    return value;\n  },\n\n  /**\n   * Returns the Variation by checking the Start and End Bucket Allocations of each Variation\n   *\n   * @param {Object} campaign which contains the variations\n   * @param {Number} bucketValue the bucket Value of the user\n   *\n   * @return {Object|null} variation data allotted to the user or null if not\n   */\n  _getVariation: (variations, bucketValue) => {\n    for (let i = 0; i < Object.keys(variations).length; i++) {\n      let variation = variations[i];\n\n      if (bucketValue >= variation.startVariationAllocation && bucketValue <= variation.endVariationAllocation) {\n        return variation;\n      }\n    }\n\n    return null;\n  },\n\n  /**\n   * Validates the User ID and generates Bucket Value of the User by hashing the userId by murmurHash and scaling it down.\n   *\n   * @param {String} userId the unique ID assigned to User\n   *\n   * @return {Number} the bucket Value allotted to User (between 1 to $this->$MAX_TRAFFIC_PERCENT)\n   */\n  _getBucketValueForUser: (seed, userId, disableLog) => {\n    let hashValue = Hasher.v3(seed, Constants.SEED_VALUE);\n    let bucketValue = BucketingService._generateBucketValue(hashValue, Constants.MAX_TRAFFIC_PERCENT);\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_HASH_BUCKET_VALUE, {\n        file,\n        hashValue,\n        bucketValue,\n        userId\n      }),\n      disableLog\n    );\n\n    return bucketValue;\n  },\n\n  /**\n   * Calculate if this user should become part of the campaign or not\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {Object} campaign fot getting the value of traffic allotted to the campaign\n   *\n   * @return {Boolean} if User is a part of Campaign or not\n   */\n  isUserPartOfCampaign: (userId, campaign, disableLog = false) => {\n    if (!campaign) {\n      return false;\n    }\n\n    let trafficAllocation = campaign.percentTraffic;\n    let valueAssignedToUser = BucketingService._getBucketValueForUser(\n      CampaignUtil.getBucketingSeed(userId, campaign),\n      userId,\n      disableLog\n    );\n    let isUserPart = valueAssignedToUser !== 0 && valueAssignedToUser <= trafficAllocation;\n\n    logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.USER_CAMPAIGN_ELIGIBILITY, {\n        file,\n        userId,\n        campaignKey: campaign.key,\n        status: isUserPart ? 'eligible' : 'not eligible'\n      }),\n      disableLog\n    );\n\n    return isUserPart;\n  },\n\n  /**\n   * Validates the User ID and generates Variation into which the User is bucketed in.\n   *\n   * @param {String} userId the unique ID assigned to User\n   * @param {Object} campaign the Campaign of which User is a part of\n   *\n   * @return {Object|null} variation data into which user is bucketed in or null if not\n   */\n  bucketUserToVariation: (userId, campaign, accountId) => {\n    const isNB = VWOFeatureFlags.getAll().isNB;\n    const isNBv2 = VWOFeatureFlags.getAll().isNBv2;\n    let multiplier;\n    let seed;\n\n    if (!ValidateUtil.isValidValue(userId)) {\n      return null;\n    }\n\n    if (!campaign) {\n      return null;\n    }\n\n    if (((!isNB && !isNBv2) || (isNB && campaign.isOB)) && campaign.percentTraffic) {\n      // Old bucketing logic if feature flag is OFF or\n      // Feature flag is ON and campaign is old i.e. created before feature flag was turned ON\n      multiplier = Constants.MAX_TRAFFIC_VALUE / campaign.percentTraffic / 100;\n      seed = CampaignUtil.getBucketingSeed(userId, campaign);\n    } else if ((isNB && !campaign.isOB && !isNBv2) || (isNBv2 && campaign.isOBv2)) {\n      // New bucketing logic if feature flag is ON and campaign is new i.e. created after feature flag was turned ON\n      multiplier = 1;\n      seed = userId;\n    } else {\n      // new bucketing V2 Logic\n      multiplier = 1;\n      seed = CampaignUtil.getBucketingSeed(accountId + '_' + userId, campaign);\n    }\n\n    const hashValue = BucketingService._generateHashValue(seed);\n    const bucketValue = BucketingService._generateBucketValue(hashValue, Constants.MAX_TRAFFIC_VALUE, multiplier);\n\n    logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.USER_CAMPAIGN_BUCKET_VALUES, {\n        file,\n        userId,\n        campaignKey: campaign.key,\n        percentTraffic: campaign.percentTraffic,\n        bucketValue,\n        hashValue\n      })\n    );\n\n    return BucketingService._getVariation(campaign.variations, bucketValue);\n  },\n  calculateBucketValue: (seed, multiplier = 1) => {\n    const hashValue = BucketingService._generateHashValue(seed);\n    return BucketingService._generateBucketValue(hashValue, Constants.MAX_TRAFFIC_VALUE, multiplier);\n  },\n  _generateHashValue: userId => {\n    return Hasher.v3(userId, Constants.SEED_VALUE);\n  }\n};\n\nmodule.exports = BucketingService;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst AnsiColorEnum = require('./AnsiColorEnum');\n\nconst LogNumberLevel = {\n  _0: 'NOTSET',\n  _1: 'DEBUG',\n  _2: 'INFO',\n  _3: 'WARN',\n  _4: 'ERROR'\n};\n\nconst LogLevelEnum = {\n  NOTSET: 0,\n  DEBUG: 1,\n  INFO: 2,\n  WARN: 3,\n  ERROR: 4\n};\n\nconst LogLevelColorInfoEnum = {\n  [LogLevelEnum.NOTSET]: `${AnsiColorEnum.BOLD}${AnsiColorEnum.WHITE}[NOTSET]:${AnsiColorEnum.RESET}`,\n  [LogLevelEnum.DEBUG]: `${AnsiColorEnum.BOLD}${AnsiColorEnum.LIGHTBLUE}[DEBUG]: ${AnsiColorEnum.RESET}`,\n  [LogLevelEnum.INFO]: `${AnsiColorEnum.BOLD}${AnsiColorEnum.CYAN}[INFO]:  ${AnsiColorEnum.RESET}`,\n  [LogLevelEnum.WARN]: `${AnsiColorEnum.BOLD}${AnsiColorEnum.YELLOW}[WARN]:  ${AnsiColorEnum.RESET}`,\n  [LogLevelEnum.ERROR]: `${AnsiColorEnum.BOLD}${AnsiColorEnum.RED}[ERROR]: ${AnsiColorEnum.RESET}`\n};\n\nconst LogLevelInfoEnum = {\n  [LogLevelEnum.NOTSET]: `[NOTSET]:`,\n  [LogLevelEnum.DEBUG]: `[DEBUG]: `,\n  [LogLevelEnum.INFO]: `[INFO]:  `,\n  [LogLevelEnum.WARN]: `[WARN]:  `,\n  [LogLevelEnum.ERROR]: `[ERROR]: `\n};\n\nmodule.exports = {\n  LogLevelEnum,\n  LogNumberLevel,\n  LogLevelInfoEnum,\n  LogLevelColorInfoEnum\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst CampaignTypeEnum = {\n  FEATURE_TEST: 'FEATURE_TEST',\n  FEATURE_ROLLOUT: 'FEATURE_ROLLOUT',\n  AB: 'VISUAL_AB'\n};\n\nmodule.exports = CampaignTypeEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst SegmentOperandTypes = require('./SegmentOperandTypesEnum');\nconst SegmentOperatorTypes = require('./SegmentOperatorTypesEnum');\nconst SegmentOperandValueTypeRegexes = require('./SegmentOperandValueTypeRegexesEnum');\nconst SegmentOperandValues = require('./SegmentOperandValuesEnum');\n\nconst SegmentEnum = {\n  SegmentOperandTypes,\n  SegmentOperatorTypes,\n  SegmentOperandValueTypeRegexes,\n  SegmentOperandValues\n};\n\nmodule.exports = SegmentEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\n/**\n * Hooks Manager is responsible for triggering callbacks useful to the end-user based on certain lifecycle events.\n * Possible use with integrations when the user intends to send an event when a visitor is part of the experiment.\n */\nconst HooksManager = {\n  /**\n   * Initializes with configuration from VWO Object.\n   * @param {Object} config\n   */\n  init(config = {}) {\n    this.callback = config.integrations && config.integrations.callback;\n  },\n  /**\n   * Executes the callback\n   * @param {Object} properties Properties from the callback\n   */\n  execute(properties) {\n    if (DataTypeUtil.isFunction(this.callback)) {\n      this.callback(properties);\n    }\n  }\n};\n\nmodule.exports = HooksManager;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst uuidv5 = require('uuid/v5');\nconst Constants = require('../constants');\n\nconst VWO_NAMESPACE = uuidv5(Constants.SEED_URL, uuidv5.URL);\n\nconst UuidUtil = {\n  generateFor: (userId, accountId) => {\n    userId = `${userId}`; // type-cast\n    const hash = `${accountId}`;\n    const userIdNamespace = UuidUtil.generate(hash, VWO_NAMESPACE);\n    const uuidForUserIdAccountId = UuidUtil.generate(userId, userIdNamespace);\n\n    let desiredUuid = uuidForUserIdAccountId.replace(/-/gi, '').toUpperCase();\n\n    return desiredUuid;\n  },\n  generate: (name, namespace) => {\n    if (!name || !namespace) {\n      return;\n    }\n\n    return uuidv5(name, namespace);\n  }\n};\n\nmodule.exports = UuidUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst UrlEnum = require('../enums/UrlEnum');\nconst { isString } = require('../utils/DataTypeUtil');\n\nconst UrlService = {\n  init({ collectionPrefix } = {}) {\n    if (collectionPrefix && isString(collectionPrefix)) {\n      UrlService.collectionPrefix = collectionPrefix;\n    }\n\n    return UrlService;\n  },\n\n  getBaseUrl() {\n    const baseUrl = UrlEnum.BASE_URL;\n\n    if (UrlService.collectionPrefix) {\n      return `${baseUrl}/${UrlService.collectionPrefix}`;\n    }\n\n    return baseUrl;\n  }\n};\n\nmodule.exports = UrlService;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst { getCurrentTime } = require('./FunctionUtil');\nconst { isObject, isFunction } = require('./DataTypeUtil');\n\nconst FetchUtil = {\n  _getStoredSettings: function(userStorageService) {\n    let isStoredData = false;\n    let parsedSettings;\n\n    if (userStorageService && isObject(userStorageService) && isFunction(userStorageService.getSettings)) {\n      try {\n        const settings = userStorageService.getSettings();\n        parsedSettings = JSON.parse(settings);\n\n        if (parsedSettings && isObject(parsedSettings) && Object.keys(parsedSettings).length > 3) {\n          const info = `VWO-SDK - [INFO]: ${getCurrentTime()} VWO settings found in Storage Service.`;\n\n          console.info(info);\n\n          isStoredData = true;\n        } else if (parsedSettings) {\n          const error = `VWO-SDK - [ERROR]: ${getCurrentTime()} VWO settings found in Storage Service is not valid.`;\n\n          console.error(error);\n        } else {\n          const warning = `VWO-SDK - [WARNING]: ${getCurrentTime()} VWO settings is empty in Storage Service.`;\n\n          console.warn(warning);\n        }\n      } catch (err) {\n        const error = `VWO-SDK - [ERROR]: ${getCurrentTime()} VWO settings found in Storage Service is not valid. ${err}`;\n\n        console.error(error);\n        isStoredData = false;\n      }\n    }\n\n    return {\n      isStoredData,\n      parsedSettings\n    };\n  },\n\n  send: function({ method, url, payload, userStorageService, customHeaders = {}, retries = 5, delay = 1000 } = {}) {\n    if (!url || !method) {\n      return;\n    }\n\n    const attemptRequest = attempt => {\n      return new Promise((resolve, reject) => {\n        const { isStoredData, parsedSettings } = FetchUtil._getStoredSettings(userStorageService);\n\n        if (isStoredData) {\n          resolve(parsedSettings);\n        } else {\n          const options = {\n            method,\n            headers: customHeaders\n          };\n\n          if (method === 'POST') {\n            options.body = JSON.stringify(payload);\n          }\n\n          fetch(url, options)\n            .then(res => {\n              return res.text().then(text => {\n                let jsonData = {};\n                try {\n                  jsonData = JSON.parse(text);\n                } catch (err) {\n                  console.info(\n                    `VWO-SDK - [INFO]: ${getCurrentTime()} VWO didn't send JSON response which is expected: ${err}`\n                  );\n                }\n\n                if (userStorageService && isObject(userStorageService) && isFunction(userStorageService.setSettings)) {\n                  userStorageService.setSettings(jsonData);\n                }\n\n                if (res.status === 200) {\n                  resolve(jsonData);\n                } else {\n                  let error = `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed for fetching account settings. Got Status Code: ${\n                    res.status\n                  }`;\n                  console.error(error);\n\n                  if (attempt < retries) {\n                    setTimeout(() => {\n                      console.warn(`VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying request in ${delay/1000} seconds (Attempt ${attempt + 1}/${retries})`);\n                      attemptRequest(attempt + 1)\n                        .then(resolve)\n                        .catch(reject);\n                    }, delay * Math.pow(2, attempt)); // Exponential backoff\n                  } else {\n                    reject(error);\n                  }\n                }\n              });\n            })\n            .catch(err => {\n              let error = `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed for fetching account settings. Error: ${err}`;\n              console.error(error);\n\n              if (attempt < retries) {\n                setTimeout(() => {\n                  console.warn(`VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying request in ${delay/1000} seconds (Attempt ${attempt + 1}/${retries})`);\n                  attemptRequest(attempt + 1)\n                    .then(resolve)\n                    .catch(reject);\n                }, delay * Math.pow(2, attempt)); // Exponential backoff\n              } else {\n                reject(error);\n              }\n            });\n        }\n      });\n    };\n\n    return attemptRequest(0);\n  }\n};\n\nmodule.exports = FetchUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst logging = require('../services/logging');\nconst { LogLevelEnum } = logging;\nconst { getCurrentTime } = require('./FunctionUtil');\nconst { isObject, isFunction } = require('./DataTypeUtil');\n\nconst XhrUtil = {\n  _getStoredSettings: function(userStorageService) {\n    let isStoredData = false;\n    let parsedSettings;\n\n    if (userStorageService && isObject(userStorageService) && isFunction(userStorageService.getSettings)) {\n      try {\n        const settings = userStorageService.getSettings();\n        parsedSettings = JSON.parse(settings);\n\n        if (parsedSettings && isObject(parsedSettings) && Object.keys(parsedSettings).length > 3) {\n          const info = `VWO-SDK - [INFO]: ${getCurrentTime()} VWO settings found in Storage Service.`;\n\n          console.info(info);\n\n          isStoredData = true;\n        } else if (parsedSettings) {\n          const error = `VWO-SDK - [ERROR]: ${getCurrentTime()} VWO settings found in Storage Service is not valid.`;\n\n          console.error(error);\n        } else {\n          const warning = `VWO-SDK - [WARNING]: ${getCurrentTime()} VWO settings is empty in Storage Service.`;\n\n          console.warn(warning);\n        }\n      } catch (err) {\n        const error = `VWO-SDK - [ERROR]: ${getCurrentTime()} VWO settings found in Storage Service is not valid. ${err}`;\n\n        console.error(error);\n        isStoredData = false;\n      }\n    }\n\n    return {\n      isStoredData,\n      parsedSettings\n    };\n  },\n  send: function({ method, url, payload, userStorageService, customHeaders = {}, logger, maxRetries = 5 } = {}) {\n    if (!url || !method) return;\n\n    return new Promise((resolve, reject) => {\n      const { isStoredData, parsedSettings } = XhrUtil._getStoredSettings(userStorageService);\n\n      if (isStoredData) {\n        resolve(parsedSettings);\n      } else {\n        if (method === 'GET') {\n          // Implement retry mechanism for GET requests\n          this.sendGetRequestWithRetry(\n            0,\n            maxRetries,\n            logger,\n            customHeaders,\n            method,\n            url,\n            userStorageService,\n            resolve,\n            reject\n          );\n        } else if (method === 'POST') {\n          // Use the existing retry logic for POST requests (no changes)\n          this.sendRequest(0, maxRetries, logger, customHeaders, payload, method, url, resolve, reject);\n        }\n      }\n    });\n  },\n\n  /**\n   * Sends a GET request with retry mechanism using exponential backoff\n   * @param {*} attempt - The current attempt number\n   * @param {*} maxRetries - The maximum number of retries\n   * @param {*} logger - The logger instance\n   * @param {*} customHeaders - Additional headers to include in the request\n   * @param {*} method - The HTTP method (GET, POST, etc.)\n   * @param {*} url - The URL to request\n   * @param {*} userStorageService - The user storage service instance\n   * @param {*} resolve - The resolve function of the Promise\n   * @param {*} reject - The reject function of the Promise\n   */\n  sendGetRequestWithRetry: function(\n    attempt,\n    maxRetries,\n    logger,\n    customHeaders,\n    method,\n    url,\n    userStorageService,\n    resolve,\n    reject\n  ) {\n    let delay = 1000 * Math.pow(2, attempt); // Exponential backoff (1s, 2s, 4s, 8s, 16s)\n    let xhr = new XMLHttpRequest();\n    xhr.timeout = 5000; // Set timeout to 5 seconds\n\n    xhr.onload = () => {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        try {\n          let parsedXhrResponse = JSON.parse(xhr.response);\n\n          if (userStorageService && isObject(userStorageService) && isFunction(userStorageService.setSettings)) {\n            userStorageService.setSettings(xhr.response);\n          }\n\n          resolve(parsedXhrResponse);\n        } catch (err) {\n          console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} JSON parse error: ${err}`);\n          reject(err);\n        }\n      } else {\n        console.error(\n          `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed with status ${xhr.status}, response: ${\n            xhr.responseText\n          }`\n        );\n        this.retryGetRequest(\n          attempt,\n          maxRetries,\n          delay,\n          logger,\n          method,\n          url,\n          customHeaders,\n          userStorageService,\n          resolve,\n          reject,\n          xhr\n        );\n      }\n    };\n\n    xhr.onerror = () => {\n      console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} Network error while calling ${url}`);\n      this.retryGetRequest(\n        attempt,\n        maxRetries,\n        delay,\n        logger,\n        method,\n        url,\n        customHeaders,\n        userStorageService,\n        resolve,\n        reject,\n        xhr\n      );\n    };\n\n    xhr.ontimeout = () => {\n      console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} Timeout error while calling ${url}`);\n      this.retryGetRequest(\n        attempt,\n        maxRetries,\n        delay,\n        logger,\n        method,\n        url,\n        customHeaders,\n        userStorageService,\n        resolve,\n        reject,\n        xhr\n      );\n    };\n\n    xhr.open(method, url);\n    for (let header in customHeaders) {\n      if (customHeaders.hasOwnProperty(header)) {\n        xhr.setRequestHeader(header, customHeaders[header]);\n      }\n    }\n\n    xhr.send();\n  },\n\n  /**\n   * Retries the GET request with exponential backoff if the request fails\n   * @param {*} attempt - The current attempt number\n   * @param {*} maxRetries - The maximum number of retries\n   * @param {*} delay - The delay in milliseconds before retrying\n   * @param {*} logger - The logger instance\n   * @param {*} method - The HTTP method (GET, POST, etc.)\n   * @param {*} url - The URL to request\n   * @param {*} customHeaders - Additional headers to include in the request\n   * @param {*} userStorageService - The user storage service instance\n   * @param {*} resolve - The resolve function of the Promise\n   * @param {*} reject - The reject function of the Promise\n   * @param {*} xhr - The XMLHttpRequest instance\n   */\n  retryGetRequest: function(\n    attempt,\n    maxRetries,\n    delay,\n    logger,\n    method,\n    url,\n    customHeaders,\n    userStorageService,\n    resolve,\n    reject,\n    xhr\n  ) {\n    if (attempt < maxRetries) {\n      console.warn(\n        `VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying GET request to ${url} in ${delay /\n          1000} seconds (Attempt ${attempt + 1}/${maxRetries})`\n      );\n\n      setTimeout(() => {\n        this.sendGetRequestWithRetry(\n          attempt + 1,\n          maxRetries,\n          logger,\n          customHeaders,\n          method,\n          url,\n          userStorageService,\n          resolve,\n          reject\n        );\n      }, delay);\n    } else {\n      let errorMsg = `VWO-SDK - [ERROR]: ${getCurrentTime()} GET request to ${url} failed after ${maxRetries} retries. Status: ${\n        xhr.status\n      }, Response: ${xhr.responseText}`;\n      console.error(errorMsg);\n      reject(errorMsg);\n    }\n  },\n\n  // send request function definition (to allow for retries)\n  sendRequest: function(retries, maxRetries, logger, customHeaders, payload, method, url, resolve, reject) {\n    let delay = 1000 * Math.pow(2, retries); // Exponential backoff (1s, 2s, 4s, 8s, 16s)\n    let xhr = new XMLHttpRequest();\n\n    // Configure timeout\n    xhr.timeout = 5000; // Set timeout to 5 seconds (5000 ms)\n\n    // onload event\n    xhr.onload = () => {\n      // retry if error and less than max retries\n      if (xhr.status < 200 || xhr.status >= 300) {\n        if (retries < maxRetries) {\n          retries++;\n\n          // log retried times\n          logger.log(\n            LogLevelEnum.ERROR,\n            `Error with Status Code : ${xhr.status}, and Response : ${xhr.responseText}. Retrying request in ${delay/1000} seconds (Attempt ${retries + 1}/${maxRetries})`\n          );\n\n          // call send request again, after delay\n          setTimeout(() => {\n            this.sendRequest(retries, maxRetries, logger, customHeaders, payload, method, url, resolve, reject);\n          }, delay);\n        } else {\n          // log errors with status (clean up later)\n          logger.log(\n            LogLevelEnum.ERROR,\n            `Request failed with Status Code : ${xhr.status} and Response : ${xhr.responseText}`\n          );\n          reject(`Got Error: ${xhr.statusText} and Status Code: ${xhr.status}`);\n        }\n      } else {\n        // resolve the promise if all well\n        resolve(xhr.responseText);\n      }\n    };\n\n    // onerror event\n    xhr.onerror = () => {\n      if (retries < maxRetries) {\n        retries++;\n        logger.log(LogLevelEnum.ERROR, `Network error: ${xhr.statusText}, Status Code: ${xhr.status}. Retrying request in ${delay/1000} seconds (Attempt ${retries + 1}/${maxRetries})`);\n        setTimeout(() => {\n          this.sendRequest(retries, maxRetries, logger, customHeaders, payload, method, url, resolve, reject);\n        }, delay);\n      } else {\n        reject(`Network error: ${xhr.statusText}, Status Code: ${xhr.status}`);\n      }\n    };\n\n    // ontimeout event\n    xhr.ontimeout = () => {\n      if (retries < maxRetries) {\n        retries++;\n        logger.log(LogLevelEnum.ERROR, `Timeout error: ${xhr.statusText}, Status Code: ${xhr.status}. Retrying request in ${delay/1000} seconds (Attempt ${retries + 1}/${maxRetries})`);\n        setTimeout(() => {\n          this.sendRequest(retries, maxRetries, logger, customHeaders, payload, method, url, resolve, reject);\n        }, delay);\n      } else {\n        reject(`Timeout error: ${xhr.statusText}, Status Code: ${xhr.status}`);\n      }\n    };\n\n    // open connection and add headers if any, and then send\n    xhr.open(method, url, true);\n    for (var newHeaderName in customHeaders) {\n      if (customHeaders.hasOwnProperty(newHeaderName)) {\n        xhr.setRequestHeader(newHeaderName, customHeaders[newHeaderName]);\n      }\n    }\n    xhr.send(JSON.stringify(payload));\n  },\n\n  xhrOnLoad: function(xhr, userStorageService, resolve) {\n    try {\n      let parsedXhrResponse = JSON.parse(xhr.response);\n\n      if (userStorageService && isObject(userStorageService) && isFunction(userStorageService.setSettings)) {\n        userStorageService.setSettings(xhr.response);\n      }\n\n      resolve(parsedXhrResponse);\n    } catch (err) {\n      console.error(err);\n    }\n  },\n\n  xhrOnError: function(xhr, reject) {\n    let error = `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed for fetching account settings. Got Status Code: ${\n      xhr.status\n    }`;\n\n    console.error(error);\n    reject(error);\n  }\n};\n\nmodule.exports = XhrUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst UrlEnum = require('../enums/UrlEnum');\nconst { getRandomNumber, getCurrentTime } = require('./FunctionUtil');\n\nlet SettingsFileUtil = {\n  get: (accountId, sdkKey, userStorageService, config = {}) => {\n    if (!accountId || !sdkKey) {\n      console.error('AccountId and sdkKey are required for fetching account settings. Aborting!');\n      return;\n    }\n\n    let protocol = 'https';\n    let port;\n    let hostname = UrlEnum.BASE_URL;\n    let path = UrlEnum.SETTINGS_URL;\n\n    if (config.isViaWebhook) {\n      path = UrlEnum.WEBHOOK_SETTINGS_URL;\n    }\n\n    path +=\n      `?a=${accountId}&` +\n      `i=${sdkKey}&` +\n      `r=${getRandomNumber()}&` +\n      `platform=${Constants.PLATFORM}&` +\n      `${Constants.SDK_QUERY_PARAM}=${Constants.SDK_NAME}&` +\n      `${Constants.SDK_VERSION_QUERY_PARAM}=${Constants.SDK_VERSION}`;\n\n    if (config.hostname && config.path) {\n      protocol = config.protocol;\n      port = config.port;\n      hostname = config.hostname || hostname;\n      path = config.path || path;\n    }\n\n    if (typeof process.env === 'undefined') {\n      if (typeof XMLHttpRequest === 'undefined') {\n        return require('./FetchUtil').send({\n          method: 'GET',\n          url: `${protocol}://${hostname}${path}`,\n          userStorageService\n        });\n      }\n      return require('./XhrUtil').send({\n        method: 'GET',\n        url: `${protocol}://${hostname}${path}`,\n        userStorageService\n      });\n    } else {\n      const http = require('http');\n      const https = require('https');\n\n      return new Promise((resolve, reject) => {\n        const maxRetries = 5; // Number of retry attempts\n        const initialDelay = 1000; // Initial retry delay in ms (1 second)\n\n        const makeRequest = attempt => {\n          const delay = initialDelay * Math.pow(2, attempt); // Exponential backoff (1s, 2s, 4s, 8s, 16s)\n\n          const options = {\n            hostname,\n            path,\n            agent: false\n          };\n\n          if (port) {\n            options.port = port;\n          }\n\n          (protocol === 'https' ? https : http)\n            .get(options, res => {\n              if (res.statusCode >= 200 && res.statusCode < 300) {\n                // Successful response\n                SettingsFileUtil.handleHttpRequest(res, resolve, reject);\n              } else {\n                console.error(\n                  `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed with Status Code: ${res.statusCode}`\n                );\n\n                if (attempt < maxRetries) {\n                  console.warn(\n                    `VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying request in ${delay /\n                      1000} seconds (Attempt ${attempt + 1}/${maxRetries})`\n                  );\n\n                  setTimeout(() => {\n                    makeRequest(attempt + 1);\n                  }, delay);\n                } else {\n                  console.error(\n                    `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed after ${maxRetries} retries. Status Code: ${\n                      res.statusCode\n                    }`\n                  );\n                }\n              }\n            })\n            .on('error', err => {\n              console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} Network error: ${err.message}`);\n\n              if (attempt < maxRetries) {\n                console.warn(\n                  `VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying request in ${delay /\n                    1000} seconds (Attempt ${attempt + 1}/${maxRetries})`\n                );\n\n                setTimeout(() => {\n                  makeRequest(attempt + 1);\n                }, delay);\n              } else {\n                console.error(\n                  `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed after ${maxRetries} retries due to network error.`\n                );\n              }\n            });\n        };\n\n        makeRequest(0); // Initial request (attempt 0)\n      });\n    }\n  },\n\n  handleHttpRequest: (res, resolve, reject) => {\n    const { statusCode } = res;\n    const contentType = res.headers['content-type'];\n\n    let error;\n    let rawData = '';\n\n    if (!/^application\\/json/.test(contentType)) {\n      error = `Invalid content-type.\\nExpected application/json but received ${contentType}`;\n    }\n\n    if (error) {\n      console.error(error.message);\n      // Consume response data to free up memory\n      res.resume();\n      reject(error);\n\n      return;\n    }\n\n    res.setEncoding('utf8');\n\n    res.on('data', chunk => {\n      rawData += chunk;\n    });\n\n    res.on('end', () => {\n      SettingsFileUtil.handleHttpResponse(statusCode, rawData, resolve, reject);\n    });\n  },\n\n  handleHttpResponse: (statusCode, rawData, resolve, reject) => {\n    try {\n      const parsedData = JSON.parse(rawData);\n\n      if (statusCode !== 200) {\n        let error = `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed for fetching account settings. Got Status Code: ${statusCode} and message: ${rawData}`;\n        console.error(error);\n        reject(error);\n\n        return;\n      }\n      resolve(parsedData);\n    } catch (err) {\n      console.error(\n        `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed for fetching account settings - ${err.message}`\n      );\n      reject(err);\n    }\n  }\n};\n\nmodule.exports = SettingsFileUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst VWO = require('./VWO');\n\nconst DataTypeUtil = require('./utils/DataTypeUtil');\nconst FunctionUtil = require('./utils/FunctionUtil');\nconst { objectValues } = require('./utils/ObjectUtil');\nconst SettingsFileUtil = require('./utils/SettingsFileUtil');\nconst GoalTypeEnum = require('./enums/GoalTypeEnum');\nconst { MAX_EVENTS_PER_REQUEST } = require('./constants');\n\nconst logging = require('./services/logging');\nconst ApiEnum = require('./enums/ApiEnum');\nconst FileNameEnum = require('./enums/FileNameEnum');\nconst file = FileNameEnum.INDEX;\nconst { setLogHandler, setLogLevel, LogLevelEnum, LogNumberLevel, LogMessageEnum, LogMessageUtil } = logging;\n\nconst logger = logging.getLogger();\n\n// By default, all ERRORS should be logged\nlogging.setLogLevel(LogLevelEnum.ERROR);\n\nfunction logError(parameter = '', type = '') {\n  const log = LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.CONFIG_PARAMETER_INVALID, {\n    file: file,\n    parameter,\n    type,\n    api: ApiEnum.LAUNCH\n  });\n\n  throw new Error(logger.log(LogLevelEnum.ERROR, log));\n}\n\nfunction logInfo(parameter = '', type = '') {\n  const log = LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_PARAMETER_USED, {\n    file: file,\n    parameter,\n    type\n  });\n\n  console.info(`VWO-SDK - [INFO]:   ${FunctionUtil.getCurrentTime()} ${log}`);\n}\n\nmodule.exports = {\n  logging,\n  setLogger: setLogHandler,\n  setLogLevel,\n  getSettingsFile: SettingsFileUtil.get,\n  GoalTypeEnum,\n  LogLevelEnum,\n  /**\n   * Initializes the SDK and parses the settingsfile\n   *\n   * @param {Object} config configuration for the SDK\n   */\n  launch: function(sdkConfig) {\n    let config = {};\n    try {\n      // validating config schema\n      FunctionUtil.cloneObject(sdkConfig);\n      if (\n        !DataTypeUtil.isUndefined(sdkConfig.shouldTrackReturningUser) &&\n        !DataTypeUtil.isBoolean(sdkConfig.shouldTrackReturningUser)\n      ) {\n        logError('shouldTrackReturningUser', 'boolean');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.shouldTrackReturningUser)) {\n        logInfo('shouldTrackReturningUser', 'boolean');\n      }\n\n      if (\n        !DataTypeUtil.isUndefined(sdkConfig.isDevelopmentMode) &&\n        !DataTypeUtil.isBoolean(sdkConfig.isDevelopmentMode)\n      ) {\n        logError('isDevelopmentMode', 'boolean');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.isDevelopmentMode)) {\n        logInfo('isDevelopmentMode', 'boolean');\n      }\n\n      if (sdkConfig.goalTypeToTrack && !objectValues(GoalTypeEnum).includes(sdkConfig.goalTypeToTrack)) {\n        logError('goalTypeToTrack', 'string(REVENUE_TRACKING, CUSTOM_GOAL, ALL)');\n      } else if (sdkConfig.goalTypeToTrack) {\n        logInfo('goalTypeToTrack', 'string(REVENUE_TRACKING, CUSTOM_GOAL, ALL)');\n      }\n\n      if (\n        sdkConfig.logging &&\n        sdkConfig.logging.level &&\n        !objectValues(LogLevelEnum).includes(sdkConfig.logging.level)\n      ) {\n        logError('logLevel', 'number(1,2,3,4)');\n      } else if (sdkConfig.logging && sdkConfig.logging.level) {\n        logInfo('logLevel', 'number(1,2,3,4)');\n      }\n\n      if (sdkConfig.pollingInterval && !DataTypeUtil.isNumber(sdkConfig.pollingInterval)) {\n        logError('pollingInterval', 'number(in miliiseconds)');\n      } else if (sdkConfig.pollingInterval) {\n        logInfo('pollingInterval', 'number(in miliiseconds)');\n      }\n\n      if (sdkConfig.pollingInterval && DataTypeUtil.isUndefined(sdkConfig.sdkKey)) {\n        logError('sdkKey(required for polling)', 'string');\n      }\n\n      if (sdkConfig.pollingInterval && !DataTypeUtil.isString(sdkConfig.sdkKey)) {\n        logError('sdkKey', 'string');\n      }\n\n      if (!DataTypeUtil.isUndefined(sdkConfig.batchEvents) && !DataTypeUtil.isObject(sdkConfig.batchEvents)) {\n        logError('batchEvents', 'object');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.batchEvents)) {\n        logInfo('batchEvents', 'object');\n      }\n\n      if (!DataTypeUtil.isUndefined(sdkConfig.returnPromiseFor) && !DataTypeUtil.isObject(sdkConfig.returnPromiseFor)) {\n        logError('returnPromiseFor', 'object');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.returnPromiseFor)) {\n        logInfo('returnPromiseFor', 'object');\n      }\n\n      if (\n        !DataTypeUtil.isUndefined(sdkConfig.asyncStorageConfig) &&\n        !DataTypeUtil.isObject(sdkConfig.asyncStorageConfig)\n      ) {\n        logError('asyncStorageConfig', 'object');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.asyncStorageConfig)) {\n        logInfo('asyncStorageConfig', 'object');\n      }\n\n      if (!DataTypeUtil.isUndefined(sdkConfig.integrations) && !DataTypeUtil.isObject(sdkConfig.integrations)) {\n        logError('integrations', 'object');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.integrations)) {\n        logInfo('integrations', 'object');\n      }\n\n      if (\n        !DataTypeUtil.isUndefined(sdkConfig.userStorageService) &&\n        !DataTypeUtil.isObject(sdkConfig.userStorageService)\n      ) {\n        logError('userStorageService', 'object');\n      } else if (!DataTypeUtil.isUndefined(sdkConfig.userStorageService)) {\n        logInfo('userStorageService', 'object');\n      }\n\n      // For JavaScript SDK, batching is not required and is not available\n      if (DataTypeUtil.isObject(sdkConfig.batchEvents) && typeof process.env === 'undefined') {\n        sdkConfig.batchEvents = null;\n      }\n\n      // For Node.js SDK\n      if (typeof process.env !== 'undefined') {\n        if (\n          DataTypeUtil.isObject(sdkConfig.batchEvents) &&\n          (!(\n            (DataTypeUtil.isNumber(sdkConfig.batchEvents.eventsPerRequest) &&\n              sdkConfig.batchEvents.eventsPerRequest > 0 &&\n              sdkConfig.batchEvents.eventsPerRequest <= MAX_EVENTS_PER_REQUEST) ||\n            (DataTypeUtil.isNumber(sdkConfig.batchEvents.requestTimeInterval) &&\n              sdkConfig.batchEvents.requestTimeInterval >= 1)\n          ) ||\n            (sdkConfig.batchEvents.flushCallback && !DataTypeUtil.isFunction(sdkConfig.batchEvents.flushCallback)))\n        ) {\n          logError('batchEvents', 'object');\n        }\n      }\n\n      config = sdkConfig;\n    } catch (err) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.CONFIG_CORRUPTED, {\n          file: file,\n          api: ApiEnum.LAUNCH\n        })\n      );\n\n      config = {};\n    }\n\n    // If DEV mode, set colorful logs to true\n    if (config.isDevelopmentMode) {\n      logging.setLogColorMode(true);\n    }\n\n    // If logging is enabled, use the logger and logLevel defined by the client\n    if (config.logging && DataTypeUtil.isObject(config.logging)) {\n      if (config.logging.haveColoredLogs !== undefined) {\n        logging.setLogColorMode(config.logging.haveColoredLogs);\n      }\n\n      if (\n        config.logging.logger &&\n        DataTypeUtil.isObject(config.logging.logger) &&\n        DataTypeUtil.isFunction(config.logging.logger.log)\n      ) {\n        logging.setLogHandler(config.logging.logger);\n        logging.setLogLevel(logging.LogLevelEnum.NOTSET);\n\n        logger.log(\n          LogLevelEnum.DEBUG,\n          LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.CONFIG_CUSTOM_LOGGER_USED, {\n            file: file\n          })\n        );\n      } else if (config.logging.logger) {\n        logError('logging.logger', 'object');\n      }\n\n      if (config.logging.level !== undefined) {\n        logging.setLogLevel(config.logging.level);\n        logger.log(\n          LogLevelEnum.DEBUG,\n          LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.CONFIG_LOG_LEVEL_SET, {\n            file: file,\n            level: LogNumberLevel['_' + config.logging.level]\n          })\n        );\n      }\n    }\n\n    // DEBUG log for knowing whether it's DEV mode\n    if (config.isDevelopmentMode) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.CONFIG_DEVELOPMENT_MODE_STATUS, {\n          file: file\n        })\n      );\n    }\n\n    // Set logger on config Obkect, to be required later\n    config.logger = (config.logging && config.logging.logger) || logger;\n\n    // Create an instance of VWO class which exposes API methods\n    return new VWO(config);\n  }\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst api = require('./api');\n\nconst FileNameEnum = require('./enums/FileNameEnum');\nconst ApiEnum = require('./enums/ApiEnum');\n\nconst DataTypeUtil = require('./utils/DataTypeUtil');\nconst FunctionUtil = require('./utils/FunctionUtil');\nconst VWOFeatureFlags = require('./utils/VWOFeatureFlags');\n\nconst EventQueue = require('./services/EventQueue');\nconst SettingsFileService = require('./services/SettingsFileManager');\nconst logging = require('./services/logging');\nconst HooksManager = require('./services/HooksManager');\nconst UrlService = require('./services/UrlService');\nconst UsageStats = require('./services/UsageStats');\n\nlet BatchEventsDispatcher;\nlet customEventUtil;\nlet BatchEventsQueue;\n\nif (typeof process.env !== 'undefined') {\n  BatchEventsQueue = require('./services/BatchEventsQueue');\n  BatchEventsDispatcher = require('./utils/BatchEventsDispatcher').dispatch;\n  customEventUtil = require('./utils/CustomEventUtil');\n}\n\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst file = FileNameEnum.VWO;\n\nclass VWO {\n  // Setting various services on the instance to be accessible by its member functions\n  constructor(config = {}) {\n    this.getVariation = this.getVariationName; // to be backward compatible\n    this.userStorageService = config.userStorageService;\n    this.logger = config.logger;\n    this.returnPromiseFor = config.returnPromiseFor;\n    this.asyncStorageConfig = config.asyncStorageConfig;\n    this.optOut = false;\n\n    if (this.userStorageService === undefined && config.asyncStorageConfig) {\n      // replace the userStorageService with the redisObject passed in asyncStorageConfig\n      this.userStorageService = config.asyncStorageConfig.redisStorage;\n      config.userStorageService = this.userStorageService;\n    }\n    let settingsFileManager = new SettingsFileService(config);\n\n    // Validate the config file i.e. check if required fields contain appropriate data\n    if (!settingsFileManager.isSettingsFileValid()) {\n      this.logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.SETTINGS_FILE_INVALID, {\n          file\n        })\n      );\n\n      return;\n    }\n\n    this.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_VALID, {\n        file\n      })\n    );\n\n    // Initialize Hooks manager so that callbacks can be invoked\n    HooksManager.init(config);\n\n    // Setup event quque for sending impressions to VWO server\n    this.eventQueue = new EventQueue();\n    this.usageStats = new UsageStats();\n\n    this.SettingsFileManager = settingsFileManager;\n    settingsFileManager.checkAndPoll(); // Checks if pollingInterval is passed then starts polling settingsFile\n\n    if (!config.isDevelopmentMode) {\n      this.usageStats.collectUsageStats(settingsFileManager.getConfig());\n    }\n\n    // Only for Node.js SDK\n    if (typeof process.env !== 'undefined') {\n      if (config.batchEvents) {\n        const accountId = settingsFileManager.getSettingsFile().accountId;\n        const sdkKey = settingsFileManager.getSettingsFile().sdkKey;\n\n        this.batchEventsQueue = new BatchEventsQueue(\n          Object.assign(\n            {},\n            config.batchEvents,\n            { isDevelopmentMode: config.isDevelopmentMode },\n            {\n              accountId,\n              dispatcher: (events, callback) =>\n                BatchEventsDispatcher(\n                  {\n                    ev: events\n                  },\n                  callback,\n                  Object.assign(\n                    {},\n                    {\n                      a: accountId\n                    },\n                    this.usageStats.getUsageStats()\n                  ),\n                  sdkKey\n                )\n            }\n          )\n        );\n\n        this.batchEventsQueue.flushAndClearTimer.bind(this.batchEventsQueue);\n      }\n    }\n\n    // Process settingsFile for various things. For eg: assign bucket range to variation, etc.\n    this.SettingsFileManager.processSettingsFile();\n\n    this.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.SDK_INITIALIZED, {\n        file\n      })\n    );\n\n    this.UrlService = UrlService.init(config.settingsFile);\n    this.VWOFeatureFlags = VWOFeatureFlags.init(config.settingsFile);\n  }\n\n  // PUBLIC METHODS\n\n  /**\n   * This API method: Gets the variation assigned for the user for the campaign and send the metrics to VWO server\n   *\n   * @param {String} campaignKey       unique campaign key specified in VWO app\n   * @param {String} userId            ID assigned to a user\n   * @param {Object} options           optional params - customVariables, variationTargetingVariables\n   *\n   * @return {String|null}             If variation is assigned then variation-name otherwise null in case of user not becoming part\n   */\n  activate(campaignKey, userId, options = {}) {\n    try {\n      let self = this;\n\n      if (self.asyncStorageConfig && DataTypeUtil.isObject(self.asyncStorageConfig)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_ASYNC_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.ACTIVATE\n          })\n        );\n\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.ACTIVATE\n              })\n            );\n            resolve(null);\n          } else {\n            return api.activate(self, campaignKey, userId, options).then(function(data) {\n              if (DataTypeUtil.isObject(data)) {\n                resolve(data.variationName);\n              } else {\n                resolve(data);\n              }\n            });\n          }\n        });\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      // i.e. wait till the network call is not successful\n      if (self.returnPromiseFor && (self.returnPromiseFor.activate || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.ACTIVATE\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.ACTIVATE\n              })\n            );\n            resolve(null);\n          } else {\n            let variationName;\n            options.responseCallback = (_error, _response) => {\n              resolve(variationName);\n            };\n            variationName = api.activate(self, campaignKey, userId, options);\n\n            // If we get null from the API i.e. no tracking call was sent\n            // In this case, responseCallback will not be fired and hence we have to manually resolve the promise\n            if (!variationName) {\n              resolve(variationName);\n            } else if (DataTypeUtil.isObject(variationName)) {\n              resolve(variationName.variationName);\n            }\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.ACTIVATE\n          })\n        );\n        return null;\n      }\n\n      const apiResponse = api.activate(self, campaignKey, userId, options);\n\n      if (DataTypeUtil.isObject(apiResponse)) {\n        return apiResponse.variationName;\n      }\n\n      return apiResponse;\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return null;\n    }\n  }\n\n  /**\n   * This API method: Gets the variation assigned for the user for the campaign\n   *\n   * @param {String} campaignKey       unique campaign key specified in VWO app\n   * @param {String} userId            ID assigned to a user\n   * @param {Object} options           optional params - customVariables, variationTargetingVariables\n   *\n   * @return {String|null}             If variation is assigned then variation-name otherwise null in case of user not becoming part\n   */\n  getVariationName(campaignKey, userId, options = {}) {\n    try {\n      let self = this;\n\n      if (self.asyncStorageConfig && DataTypeUtil.isObject(self.asyncStorageConfig)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_ASYNC_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.GET_VARIATION_NAME\n          })\n        );\n\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.GET_VARIATION_NAME\n              })\n            );\n            resolve(null);\n          } else {\n            return api.getVariation(self, campaignKey, userId, options).then(function(data) {\n              if (DataTypeUtil.isObject(data)) {\n                resolve(data.variationName);\n              } else {\n                resolve(data);\n              }\n            });\n          }\n        });\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      if (self.returnPromiseFor && (self.returnPromiseFor.getVariationName || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.GET_VARIATION_NAME\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.GET_VARIATION_NAME\n              })\n            );\n            resolve(null);\n          } else {\n            // since this API does not send any async call, we can simply resolve the returned value\n            resolve(api.getVariation(self, campaignKey, userId, options));\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.GET_VARIATION_NAME\n          })\n        );\n        return null;\n      }\n\n      return api.getVariation(self, campaignKey, userId, options);\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return null;\n    }\n  }\n\n  /**\n   * This API method: Marks the conversion of the campaign for a particular goal\n   *\n   * @param {String/Array<string>/null/undefined} campaignSpecifier campaign keys to track           unique campaignSpecifier\n   * @param {String} userId                ID assigned to a user\n   * @param {String} goalIdentifier         unique campaign's goal identifier\n   * @param {Object} options               optional params - customVariables, variationTargetingVariables, revenueValue\n   */\n  track(campaignSpecifier, userId, goalIdentifier, options = {}) {\n    try {\n      let self = this;\n\n      // In case we use any asyncStorage like redis, promisify track\n      if (self.asyncStorageConfig && DataTypeUtil.isObject(self.asyncStorageConfig)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_ASYNC_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.TRACK\n          })\n        );\n\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.TRACK\n              })\n            );\n            resolve(null);\n          } else {\n            return api.track(self, campaignSpecifier, userId, goalIdentifier, options).then(function(trackResponse) {\n              resolve(trackResponse);\n            });\n          }\n        });\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      // i.e. wait till the network call is not successful\n      if (self.returnPromiseFor && (self.returnPromiseFor.track || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.TRACK\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.TRACK\n              })\n            );\n            resolve(null);\n          } else {\n            let trackResponse;\n            let counter = 0;\n            options.responseCallback = (_error, _response) => {\n              counter += 1;\n              // For Data360, one single call is there to track multiple metrices\n              // For global goals, we are now sending one single batch-events call\n              if (\n                self.isEventArchEnabled ||\n                (DataTypeUtil.isArray(campaignSpecifier) ||\n                  ((DataTypeUtil.isUndefined(campaignSpecifier) || DataTypeUtil.isNull(campaignSpecifier)) &&\n                    FunctionUtil.objectValues(trackResponse).filter(Boolean).length))\n              ) {\n                resolve(trackResponse);\n              } else if (counter === FunctionUtil.objectValues(trackResponse).filter(Boolean).length) {\n                // In case of global goals, when all campaigns are tracked, then only resolve\n                // TODO: verify if this can be removed as we are sending batch events call always for non-Data360 accounts\n                resolve(trackResponse);\n              }\n            };\n            trackResponse = api.track(self, campaignSpecifier, userId, goalIdentifier, options);\n            // If we get null/false from the API i.e. no tracking call was sent\n            // In this case, respponseCallback will not be fired and hence we have to manually resolve the promise\n            // Or, in case of global goals, if none campaign got success, manually resolve\n            if (!trackResponse || !FunctionUtil.objectValues(trackResponse).some(Boolean)) {\n              resolve(trackResponse);\n            } else if (trackResponse && trackResponse.isDevelopmentMode) {\n              delete trackResponse.isDevelopmentMode;\n              resolve(trackResponse);\n            }\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.TRACK\n          })\n        );\n        return null;\n      }\n\n      return api.track(self, campaignSpecifier, userId, goalIdentifier, options);\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return null;\n    }\n  }\n\n  /**\n   * This API method checks: Whether a feature is enabled or not for the given user\n   *\n   * @param {String} campaignKey       Unique key for a campaign\n   * @param {String} userId            Unique identifier for the user\n   * @param {Object} options           optional params - customVariables, variationTargetingVariables\n   *\n   * @return {Boolean}                 true if feature enabled, false otherwise\n   */\n  isFeatureEnabled(campaignKey, userId, options = {}) {\n    try {\n      let self = this;\n\n      if (self.asyncStorageConfig && DataTypeUtil.isObject(self.asyncStorageConfig)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_ASYNC_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.IS_FEATURE_ENABLED\n          })\n        );\n\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.IS_FEATURE_ENABLED\n              })\n            );\n            resolve(null);\n          } else {\n            return api.isFeatureEnabled(self, campaignKey, userId, options).then(function(data) {\n              if (DataTypeUtil.isObject(data)) {\n                resolve(data.isFeatureEnabled);\n              } else {\n                resolve(data);\n              }\n            });\n          }\n        });\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      // i.e. wait till the network call is not successful\n      if (self.returnPromiseFor && (self.returnPromiseFor.isFeatureEnabled || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.IS_FEATURE_ENABLED\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.IS_FEATURE_ENABLED\n              })\n            );\n            resolve(false);\n          } else {\n            let isFeatureEnabledApiResponse;\n            options.responseCallback = (_error, _response) => {\n              resolve(!!isFeatureEnabledApiResponse);\n            };\n            isFeatureEnabledApiResponse = api.isFeatureEnabled(self, campaignKey, userId, options);\n            // If we get null from the API i.e. no tracking call was sent\n            // In this case, respponseCallback will not be fired and hence we have to manually resolve the promise\n            if (DataTypeUtil.isNull(isFeatureEnabledApiResponse)) {\n              resolve(false);\n            } else if (DataTypeUtil.isObject(isFeatureEnabledApiResponse)) {\n              resolve(!!isFeatureEnabledApiResponse.isFeatureEnabled);\n            }\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.IS_FEATURE_ENABLED\n          })\n        );\n        return false;\n      }\n\n      const apiResponse = api.isFeatureEnabled(self, campaignKey, userId, options);\n\n      if (DataTypeUtil.isObject(apiResponse)) {\n        return !!apiResponse.isFeatureEnabled;\n      }\n\n      return !!apiResponse;\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return false;\n    }\n  }\n\n  /**\n   * This API method: Return the variable for that variation(if Feature Test),\n   *    otherwise the default values being set in Feature\n   *\n   * @param {String} campaignKey   Unique key for a campaign\n   * @param {String} variableKey   Unique key for a feature's variable\n   * @param {String} userId        Unique identifier for the user\n   * @param {Object} options           optional params - customVariables, variationTargetingVariables\n   *\n   * @return {string|number|double|boolean|null} Variable value as is set in the VWO app i.e.\n   *                                             maintaining the data-type,\n   *                                             null if anything fails like campaign / variable not found\n   */\n  getFeatureVariableValue(campaignKey, variableKey, userId, options = {}) {\n    try {\n      let self = this;\n\n      if (self.asyncStorageConfig && DataTypeUtil.isObject(self.asyncStorageConfig)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_ASYNC_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.GET_FEATURE_VARIABLE_VALUE\n          })\n        );\n\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.GET_FEATURE_VARIABLE_VALUE\n              })\n            );\n            resolve(null);\n          } else {\n            return api.getFeatureVariableValue(self, campaignKey, variableKey, userId, options).then(function(data) {\n              if (DataTypeUtil.isObject(data)) {\n                resolve(data.typeCastedValue);\n              } else {\n                resolve(data);\n              }\n            });\n          }\n        });\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      if (self.returnPromiseFor && (self.returnPromiseFor.getFeatureVariableValue || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.GET_FEATURE_VARIABLE_VALUE\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.GET_FEATURE_VARIABLE_VALUE\n              })\n            );\n            resolve(null);\n          } else {\n            // since this API does not send any async call, we can simply resolve the returned value\n            resolve(api.getFeatureVariableValue(self, campaignKey, variableKey, userId, options));\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.GET_FEATURE_VARIABLE_VALUE\n          })\n        );\n        return null;\n      }\n\n      return api.getFeatureVariableValue(self, campaignKey, variableKey, userId, options);\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return null;\n    }\n  }\n\n  /**\n   * This API method: Pushes the key-value tag pair for a particular user\n   *\n   * @param {String} tagKey                    tag key\n   * @param {String} tagValue                  tag Value\n   * @param {String} userId                    ID assigned to a user\n   *\n   * @return {Boolean}                    true if request is pushed to eventQueue, false if params are invalid or settings file is unavailable\n   */\n  push(tagKey, tagValue, userId) {\n    try {\n      let self = this;\n      let customDimensionMap;\n\n      if (arguments.length === 2) {\n        // Argument reshuffling.\n        customDimensionMap = tagKey;\n        userId = tagValue;\n\n        tagKey = ' ';\n        tagValue = ' ';\n      } else if (arguments.length === 3) {\n        customDimensionMap = {};\n      } else {\n        this.logger.log(\n          LogLevelEnum.ERROR,\n          LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n            file,\n            api: ApiEnum.PUSH\n          })\n        );\n        return false;\n      }\n\n      // Check if returnPromiseFor is provided. If yes, return a promise instead of value\n      // i.e. wait till the network call is not successful\n      if (self.returnPromiseFor && (self.returnPromiseFor.push || self.returnPromiseFor.all)) {\n        self.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CONFIG_RETURN_PROMISE, {\n            file,\n            method: ApiEnum.PUSH\n          })\n        );\n        return new Promise(resolve => {\n          if (this.optOut) {\n            this.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n                file,\n                api: ApiEnum.PUSH\n              })\n            );\n            resolve(null);\n          } else {\n            let apiResponse;\n            let counter = 0;\n\n            const options = {\n              responseCallback: (_error, _response) => {\n                counter += 1;\n                // In case of multiple custom dimensions, when all are tracked, then only resolve\n                // if customDimensionMap is used\n                if (\n                  customDimensionMap &&\n                  DataTypeUtil.isObject(customDimensionMap) &&\n                  FunctionUtil.objectValues(customDimensionMap).filter(Boolean).length > 1\n                ) {\n                  resolve(apiResponse);\n                }\n                // else if custom dimensions are sent with tag key and value instead of a map\n                else if (counter === FunctionUtil.objectValues(apiResponse).filter(Boolean).length) {\n                  resolve(apiResponse);\n                }\n              }\n            };\n            apiResponse = api.push(self, tagKey, tagValue, userId, customDimensionMap, options);\n            // If we get false from the API i.e. no tracking call was sent\n            // In this case, respponseCallback will not be fired and hence we have to manually resolve the promise\n            if (!apiResponse) {\n              resolve(false);\n            } else if (apiResponse && apiResponse.isDevelopmentMode) {\n              delete apiResponse.isDevelopmentMode;\n              resolve(apiResponse);\n            }\n          }\n        });\n      }\n\n      if (this.optOut) {\n        this.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n            file,\n            api: ApiEnum.PUSH\n          })\n        );\n        return null;\n      }\n\n      return api.push(self, tagKey, tagValue, userId, customDimensionMap);\n    } catch (err) {\n      this.logger.log(LogLevelEnum.ERROR, err.message);\n      return false;\n    }\n  }\n\n  setOptOut() {\n    this.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.OPT_OUT_API_CALLED, {\n        file\n      })\n    );\n\n    if (this.returnPromiseFor && (this.returnPromiseFor.optOut || this.returnPromiseFor.all)) {\n      return new Promise(resolve => {\n        this._destroyInstanceVariables();\n        if (this.batchEventsQueue) {\n          this.flushEvents().then(() => {\n            this.batchEventsQueue = undefined;\n            resolve(true);\n          });\n        } else {\n          resolve(true);\n        }\n      });\n    }\n\n    if (this.batchEventsQueue) {\n      this.flushEvents().then(() => {\n        this.batchEventsQueue = undefined;\n      });\n    }\n\n    this._destroyInstanceVariables();\n\n    return true;\n  }\n  /**\n   * Manually flush impression events to VWO which are queued in batch queue as per batchEvents config\n   */\n  flushEvents() {\n    const accountId = this.SettingsFileManager.getSettingsFile().accountId;\n\n    if (typeof process.env !== 'undefined') {\n      this.logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.EVENT_BATCH_FLUSH, {\n          file,\n          accountId\n        })\n      );\n\n      return new Promise((resolve, _reject) => {\n        if (this.optOut) {\n          this.logger.log(\n            LogLevelEnum.INFO,\n            LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n              file,\n              api: 'flushEvents'\n            })\n          );\n          resolve({\n            status: false,\n            message: 'opted out'\n          });\n        } else {\n          if (this.batchEventsQueue) {\n            customEventUtil.getInstance().once('batchCallCompleteion', (status, message) => {\n              if (status) {\n                resolve({\n                  status: true,\n                  message: message || 'Batch call sent to VWO'\n                });\n              } else {\n                resolve({\n                  status: false,\n                  message: message || 'Batch call could not be processed'\n                });\n              }\n            });\n\n            this.batchEventsQueue.flushAndClearTimer();\n\n            return;\n          }\n\n          this.logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.NO_BATCH_QUEUE, {\n              file,\n              accountId\n            })\n          );\n\n          resolve({\n            status: false,\n            message: 'No batchEvents config present in launch API'\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Fetch latest settings-file and update so that vwoClientInstance could use latest settings\n   * Helpful especially when using webhooks\n   *\n   * @param {Number} accountId\n   * @param {String} sdkKey\n   *\n   * @return {Promise}\n   */\n  getAndUpdateSettingsFile(accountId, sdkKey) {\n    if (this.optOut) {\n      this.logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.API_NOT_ENABLED, {\n          file,\n          api: 'getAndUpdateSettingsFile'\n        })\n      );\n      return new Promise(resolve => {\n        resolve(null);\n      });\n    }\n    return this.SettingsFileManager.getAndUpdateSettingsFile(accountId, sdkKey);\n  }\n\n  _destroyInstanceVariables() {\n    this.userStorageService = undefined;\n    this.SettingsFileManager = undefined;\n    this.usageStats = undefined;\n    this.eventQueue = undefined;\n    this.optOut = true;\n  }\n}\n\nmodule.exports = VWO;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst activate = require('./activate');\nconst getVariation = require('./getVariation');\nconst track = require('./track');\nconst isFeatureEnabled = require('./isFeatureEnabled');\nconst getFeatureVariableValue = require('./getFeatureVariableValue');\nconst push = require('./push');\n\nmodule.exports = {\n  activate,\n  getVariation,\n  track,\n  isFeatureEnabled,\n  getFeatureVariableValue,\n  push\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst ApiEnum = require('../enums/ApiEnum');\n\nconst DecisionUtil = require('../utils/DecisionUtil');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst ImpressionUtil = require('../utils/ImpressionUtil');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst EventEnum = require('../enums/EventEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.Activate;\n\n/**\n * This API method: Gets the variation assigned for the user for the campaign and send the metrics to VWO server\n *\n * 1. Validates the arguments being passed\n * 2. Checks if user is eligible to get bucketed into the campaign,\n * 3. Assigns the determinitic variation to the user(based on userId), if user becomes part of campaign\n *    If userStorageService is used, it will look into it for the variation and if found, no further processing is done\n * 4. Sends an impression call to VWO server to track user\n *\n * @param {Object} vwoInstance       VWO instance which has logger, settingsFile etc.\n * @param {String} campaignKey       unique campaign key specified in VWO app\n * @param {String} userId            ID assigned to a user\n * @param {Object} options           Optional params\n *\n * @return {String|null}             If variation is assigned then variation-name otherwise null in case of user not becoming part\n */\nfunction activate(vwoInstance, campaignKey, userId, options = {}) {\n  const api = ApiEnum.ACTIVATE;\n  let areParamsValid = false;\n  if (DataTypeUtil.isObject(options)) {\n    var {\n      customVariables,\n      variationTargetingVariables,\n      userStorageData,\n      shouldTrackReturningUser,\n      metaData,\n      responseCallback,\n      userAgent,\n      userIpAddress\n    } = options;\n\n    var visitorUserAgent = userAgent;\n\n    // Check if arguments have valid data-type\n    if (\n      ValidateUtil.areValidParamsForAPIMethod({\n        method: ApiEnum.ACTIVATE,\n        campaignKey,\n        userId,\n        customVariables,\n        variationTargetingVariables,\n        userStorageData,\n        shouldTrackReturningUser,\n        metaData,\n        responseCallback,\n        visitorUserAgent,\n        userIpAddress\n      })\n    ) {\n      areParamsValid = true;\n    }\n  }\n\n  if (areParamsValid === false) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n        file,\n        api: ApiEnum.ACTIVATE\n      })\n    );\n    return null;\n  }\n\n  // Get the cached configuration\n  let config = vwoInstance.SettingsFileManager.getConfig();\n  let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n\n  // If no settings are found, simply return no variation\n  if (!settingsFile) {\n    return null;\n  }\n\n  shouldTrackReturningUser = shouldTrackReturningUser || config.shouldTrackReturningUser || false;\n\n  // Get the campaign settings based on campaignKey from the settings\n  let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n  // check if MAB enabled, if yes, then userStorage must be defined\n  if (campaign && campaign.hasOwnProperty('isMAB') && campaign.isMAB === true) {\n    if (vwoInstance.userStorageService === undefined) {\n      vwoInstance.logger.log(\n        LogLevelEnum.ERROR,\n        '(' +\n          file +\n          ') This campaign: ' +\n          campaignKey +\n          ' has MAB configured. Please configure User Storage to proceed.'\n      );\n\n      return null;\n    }\n  }\n\n  // If matching campaign is not found with campaignKey or if found but is in not RUNNING state, simply return no variation\n  if (!campaign || campaign.status !== Constants.STATUS_RUNNING) {\n    vwoInstance.logger.log(\n      LogLevelEnum.WARN,\n      LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_RUNNING, {\n        file,\n        campaignKey,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  if (!CampaignUtil.isAbCampaign(campaign)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_NOT_APPLICABLE, {\n        file,\n        campaignKey,\n        campaignType: campaign.type,\n        userId,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  // Once the matching RUNNING campaign is found, assign the deterministic variation to the userId provided\n  const result = DecisionUtil.getVariation(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables,\n    userStorageData,\n    metaData,\n    true,\n    false,\n    undefined,\n    api\n  );\n\n  if (DataTypeUtil.isPromise(result)) {\n    return result.then(function(data) {\n      return _validateAndReturnVariation(\n        vwoInstance,\n        campaignKey,\n        userId,\n        config,\n        api,\n        shouldTrackReturningUser,\n        settingsFile,\n        campaign,\n        visitorUserAgent,\n        userIpAddress,\n        responseCallback,\n        data\n      );\n    });\n  }\n\n  return _validateAndReturnVariation(\n    vwoInstance,\n    campaignKey,\n    userId,\n    config,\n    api,\n    shouldTrackReturningUser,\n    settingsFile,\n    campaign,\n    visitorUserAgent,\n    userIpAddress,\n    responseCallback,\n    result\n  );\n}\n\nfunction _validateAndReturnVariation(\n  vwoInstance,\n  campaignKey,\n  userId,\n  config,\n  api,\n  shouldTrackReturningUser,\n  settingsFile,\n  campaign,\n  visitorUserAgent,\n  userIpAddress,\n  responseCallback,\n  result\n) {\n  var { variationId, variationName, isStoredVariation } = result;\n\n  // Check if variation-name has been assigned to the userId. If not, return no variation\n  if (!ValidateUtil.isValidValue(variationName)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.DECISION_NO_VARIATION_ALLOTED, {\n        file,\n        userId,\n        campaignKey\n      })\n    );\n\n    return null;\n  }\n\n  // check if variation found from storage. return it without sending a call to VWO server\n  if (isStoredVariation && !shouldTrackReturningUser) {\n    vwoInstance.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CAMPAIGN_USER_ALREADY_TRACKED, {\n        file,\n        userId,\n        campaignKey,\n        api\n      })\n    );\n    return { variationName };\n  }\n\n  // Variation found...let VWO server knows about it to show report stats\n  if (config.batchEvents) {\n    let properties = ImpressionUtil.buildBatchEventForTrackingUser(\n      settingsFile,\n      campaign.id,\n      variationId,\n      userId,\n      visitorUserAgent,\n      userIpAddress\n    );\n    vwoInstance.batchEventsQueue.enqueue(properties);\n  } else if (settingsFile.isEventArchEnabled) {\n    let properties = ImpressionUtil.getEventsBaseProperties(\n      settingsFile,\n      EventEnum.VWO_VARIATION_SHOWN,\n      vwoInstance.usageStats.getUsageStats(),\n      visitorUserAgent,\n      userIpAddress\n    );\n    let payload = ImpressionUtil.getTrackUserPayloadData(\n      settingsFile,\n      userId,\n      EventEnum.VWO_VARIATION_SHOWN,\n      campaign.id,\n      variationId\n    );\n    vwoInstance.eventQueue.process(config, properties, vwoInstance, { payload, responseCallback });\n  } else {\n    let properties = ImpressionUtil.buildEventForTrackingUser(\n      settingsFile,\n      campaign.id,\n      variationId,\n      userId,\n      vwoInstance.usageStats.getUsageStats(),\n      visitorUserAgent,\n      userIpAddress\n    );\n    vwoInstance.eventQueue.process(config, properties, vwoInstance, { responseCallback });\n  }\n\n  if (config.isDevelopmentMode) {\n    return { variationName };\n  }\n\n  return variationName;\n}\nmodule.exports = activate;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ValidateUtil = require('../utils/ValidateUtil');\n\nconst Bucketer = require('./BucketingService');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\n\nconst file = FileNameEnum.VariationDecider;\n\nconst VariationDecider = {\n  /**\n   * Returns the Variation Allotted to User\n   *\n   * @param {String} userId the unique ID assigned to User\n   * @param {Object} campaign\n   *\n   * @return {Object} Variation object allotted to User\n   */\n  getVariationAllotted: (userId, campaign, accountId) => {\n    let response = {\n      variation: null,\n      variationId: null,\n      variationName: null\n    };\n\n    if (!ValidateUtil.isValidValue(userId)) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.USER_ID_INVALID, {\n          file,\n          userId\n        })\n      );\n\n      return response;\n    }\n\n    if (Bucketer.isUserPartOfCampaign(userId, campaign)) {\n      let variation = VariationDecider.getVariationOfCampaignForUser(userId, campaign, accountId) || {};\n      response.variation = variation;\n      response.variationId = variation.id;\n      response.variationName = variation.name;\n    } else {\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.USER_NOT_PART_OF_CAMPAIGN, {\n          file,\n          userId,\n          campaignKey: campaign.key\n        })\n      );\n    }\n\n    return response;\n  },\n\n  /**\n   * Assigns random variation ID to a particular user depending on the PercentTraffic.\n   * Makes user a part of campaign if user's included in Traffic.\n   *\n   * @param {String} userId the unique ID assigned to a user\n   * @param {Object} campaign the Campaign of which user is to be made a part of\n   *\n   * @return {Object|null} Variation allotted to User\n   */\n  getVariationOfCampaignForUser: (userId, campaign, accountId) => {\n    if (!campaign) {\n      return null;\n    }\n\n    let variation = Bucketer.bucketUserToVariation(userId, campaign, accountId);\n\n    if (variation && variation.name) {\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.USER_VARIATION_STATUS, {\n          file,\n          userId,\n          campaignKey: campaign.key,\n          status: `got Varation:${variation.name}`\n        })\n      );\n      return {\n        variation,\n        name: variation.name,\n        id: variation.id\n      };\n    }\n\n    logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.USER_VARIATION_STATUS, {\n        file,\n        userId,\n        campaignKey: campaign.key,\n        status: 'got no variation'\n      })\n    );\n\n    return null;\n  }\n};\n\nmodule.exports = VariationDecider;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeEnum = {\n  NUMBER: 'number',\n  STRING: 'string',\n  // FUNCTION: 'function',\n  BOOLEAN: 'boolean',\n  OBJECT: 'object'\n};\n\nmodule.exports = DataTypeEnum;\n","(function(){\n  var _global = this;\n\n  /**\n   * JS Implementation of MurmurHash2\n   *\n   * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n   * @see http://github.com/garycourt/murmurhash-js\n   * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\n   * @see http://sites.google.com/site/murmurhash/\n   *\n   * @param {string} str ASCII only\n   * @param {number} seed Positive integer only\n   * @return {number} 32-bit positive integer hash\n   */\n  function MurmurHashV2(str, seed) {\n    var\n      l = str.length,\n      h = seed ^ l,\n      i = 0,\n      k;\n\n    while (l >= 4) {\n      k =\n        ((str.charCodeAt(i) & 0xff)) |\n        ((str.charCodeAt(++i) & 0xff) << 8) |\n        ((str.charCodeAt(++i) & 0xff) << 16) |\n        ((str.charCodeAt(++i) & 0xff) << 24);\n\n      k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n      k ^= k >>> 24;\n      k = (((k & 0xffff) * 0x5bd1e995) + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n\n    h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16)) ^ k;\n\n      l -= 4;\n      ++i;\n    }\n\n    switch (l) {\n    case 3: h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n    case 2: h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n    case 1: h ^= (str.charCodeAt(i) & 0xff);\n            h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n    }\n\n    h ^= h >>> 13;\n    h = (((h & 0xffff) * 0x5bd1e995) + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16));\n    h ^= h >>> 15;\n\n    return h >>> 0;\n  };\n\n  /**\n   * JS Implementation of MurmurHash3 (r136) (as of May 20, 2011)\n   *\n   * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n   * @see http://github.com/garycourt/murmurhash-js\n   * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\n   * @see http://sites.google.com/site/murmurhash/\n   *\n   * @param {string} key ASCII only\n   * @param {number} seed Positive integer only\n   * @return {number} 32-bit positive integer hash\n   */\n  function MurmurHashV3(key, seed) {\n    var remainder, bytes, h1, h1b, c1, c1b, c2, c2b, k1, i;\n\n    remainder = key.length & 3; // key.length % 4\n    bytes = key.length - remainder;\n    h1 = seed;\n    c1 = 0xcc9e2d51;\n    c2 = 0x1b873593;\n    i = 0;\n\n    while (i < bytes) {\n        k1 =\n          ((key.charCodeAt(i) & 0xff)) |\n          ((key.charCodeAt(++i) & 0xff) << 8) |\n          ((key.charCodeAt(++i) & 0xff) << 16) |\n          ((key.charCodeAt(++i) & 0xff) << 24);\n      ++i;\n\n      k1 = ((((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16))) & 0xffffffff;\n      k1 = (k1 << 15) | (k1 >>> 17);\n      k1 = ((((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16))) & 0xffffffff;\n\n      h1 ^= k1;\n          h1 = (h1 << 13) | (h1 >>> 19);\n      h1b = ((((h1 & 0xffff) * 5) + ((((h1 >>> 16) * 5) & 0xffff) << 16))) & 0xffffffff;\n      h1 = (((h1b & 0xffff) + 0x6b64) + ((((h1b >>> 16) + 0xe654) & 0xffff) << 16));\n    }\n\n    k1 = 0;\n\n    switch (remainder) {\n      case 3: k1 ^= (key.charCodeAt(i + 2) & 0xff) << 16;\n      case 2: k1 ^= (key.charCodeAt(i + 1) & 0xff) << 8;\n      case 1: k1 ^= (key.charCodeAt(i) & 0xff);\n\n      k1 = (((k1 & 0xffff) * c1) + ((((k1 >>> 16) * c1) & 0xffff) << 16)) & 0xffffffff;\n      k1 = (k1 << 15) | (k1 >>> 17);\n      k1 = (((k1 & 0xffff) * c2) + ((((k1 >>> 16) * c2) & 0xffff) << 16)) & 0xffffffff;\n      h1 ^= k1;\n    }\n\n    h1 ^= key.length;\n\n    h1 ^= h1 >>> 16;\n    h1 = (((h1 & 0xffff) * 0x85ebca6b) + ((((h1 >>> 16) * 0x85ebca6b) & 0xffff) << 16)) & 0xffffffff;\n    h1 ^= h1 >>> 13;\n    h1 = ((((h1 & 0xffff) * 0xc2b2ae35) + ((((h1 >>> 16) * 0xc2b2ae35) & 0xffff) << 16))) & 0xffffffff;\n    h1 ^= h1 >>> 16;\n\n    return h1 >>> 0;\n  }\n\n  var murmur = MurmurHashV3;\n  murmur.v2 = MurmurHashV2;\n  murmur.v3 = MurmurHashV3;\n\n  if (typeof(module) != 'undefined') {\n    module.exports = murmur;\n  } else {\n    var _previousRoot = _global.murmur;\n    murmur.noConflict = function() {\n      _global.murmur = _previousRoot;\n      return murmur;\n    }\n    _global.murmur = murmur;\n  }\n}());\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Took reference from: \"loglevel\" - https://github.com/pimterry/loglevel\n *\n * Name: loglevel\n * Published Name: loglevel\n * URL: https://github.com/pimterry/loglevel\n * Description: Minimal lightweight logging for JavaScript, adding reliable log level methods to wrap any available console.log methods\n * Author: Tim Perry (https://github.com/pimterry)\n * LICENSE: MIT License\n * Local Modifications: This library is not used as a dependency. Source code was referenced and is modified as per requirements.\n *\n */\n\n// TODO: change path\nconst LogMessageEnum = {\n  DEBUG_MESSAGES: require('vwo-sdk-log-messages/src/debug-messages.json'),\n  INFO_MESSAGES: require('vwo-sdk-log-messages/src/info-messages.json'),\n  WARNING_MESSAGES: require('vwo-sdk-log-messages/src/warning-messages.json'),\n  ERROR_MESSAGES: require('vwo-sdk-log-messages/src/error-messages.json')\n};\n\nconst { LogLevelEnum, LogNumberLevel } = require('../../enums/LogLevelEnum');\nconst LogMessageUtil = require('../../utils/LogMessageUtil');\n\nconst ConsoleLogManager = require('./ConsoleLogManager');\n\nlet globalLogLevel = LogLevelEnum.NOTSET;\nlet isColoredLogEnabled = false;\nlet globalLogHandler = new ConsoleLogManager();\n\nclass LogManager {\n  constructor(name) {\n    this.name = name;\n    this.isColoredLogEnabled = isColoredLogEnabled;\n  }\n\n  _customLog(level, message) {\n    if (level < globalLogLevel) {\n      return;\n    }\n\n    globalLogHandler.log(level, message);\n  }\n\n  log(level, message, disableLogs = false) {\n    if (disableLogs) {\n      return;\n    }\n    try {\n      this._customLog(level, message);\n    } catch (err) {\n      console.error('VWO: Could not log.', err);\n    }\n  }\n\n  info(message) {\n    this._customLog(LogLevelEnum.INFO, message);\n  }\n  debug(message) {\n    this._customLog(LogLevelEnum.DEBUG, message);\n  }\n  warn(message) {\n    this._customLog(LogLevelEnum.WARN, message);\n  }\n  error(message) {\n    this._customLog(LogLevelEnum.ERROR, message);\n  }\n}\n\nfunction getLogger(name) {\n  return new LogManager(name);\n}\n\nfunction setLogHandler(logger) {\n  globalLogHandler = logger;\n}\n\nfunction setLogLevel(level) {\n  if (level === undefined) {\n    globalLogLevel = LogLevelEnum.ERROR;\n  } else {\n    globalLogLevel = level;\n  }\n}\n\nfunction getLogLevel() {\n  return globalLogLevel;\n}\n\nfunction setLogColorMode(value) {\n  isColoredLogEnabled = value;\n  globalLogHandler.isColoredLogEnabled = isColoredLogEnabled;\n}\n\nfunction getLogColorMode() {\n  return isColoredLogEnabled;\n}\n\nmodule.exports = {\n  LogLevelEnum,\n  LogNumberLevel,\n  LogMessageUtil,\n  LogMessageEnum,\n  getLogger,\n  setLogHandler,\n  setLogLevel,\n  getLogLevel,\n  LogManager,\n  setLogColorMode,\n  getLogColorMode,\n  globalLogHandler\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst AnsiColorEnum = {\n  BOLD: '\\x1b[1m',\n  CYAN: '\\x1b[36m',\n  GREEN: '\\x1b[32m',\n  LIGHTBLUE: '\\x1b[94m',\n  RED: '\\x1b[31m',\n  RESET: '\\x1b[0m',\n  WHITE: '\\x1b[30m',\n  YELLOW: '\\x1b[33m'\n};\n\nmodule.exports = AnsiColorEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = require('./DataTypeUtil');\n\nconst nargs = /\\{([0-9a-zA-Z_]+)\\}/g;\n\nlet LogMessageUtil = {\n  /**\n   * Took reference from: string-template\n   *\n   * Name: string-template\n   * Published Name: string-template\n   * URL: https://github.com/Matt-Esch/string-template\n   * Description: A lightweight string replace engine for text-based templates\n   * Author: Matt-Esch (https://github.com/Matt-Esch)\n   * License: MIT License\n   * Local Modifications: This library is not used as a dependency.\n   *       Source code was referenced and is modified as per requirements.\n   */\n  build: (template, data) => {\n    try {\n      return template.replace(nargs, (match, key, index) => {\n        let result;\n        let isKey;\n\n        if (template[index - 1] === '{' && template[index + match.length] === '}') {\n          return key;\n        } else {\n          isKey = data.hasOwnProperty(key);\n\n          if (isKey) {\n            let value = data[key];\n\n            if (DataTypeUtil.isFunction(value)) {\n              value = data[key]();\n            }\n            result = value;\n          } else {\n            result = null;\n          }\n          if (result === null || result === undefined) {\n            return '';\n          }\n\n          return result;\n        }\n      });\n    } catch (err) {\n      return template;\n    }\n  }\n};\n\nmodule.exports = LogMessageUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst { getCurrentTime } = require('../../utils/FunctionUtil');\nconst { LogLevelEnum, LogLevelInfoEnum, LogLevelColorInfoEnum } = require('../../enums/LogLevelEnum');\n\nclass ConsoleLogManager {\n  constructor() {\n    this.logLevel = LogLevelEnum.NOTSET;\n    this.prefix = `VWO-SDK`;\n    this.isColoredLogEnabled = false;\n  }\n\n  log(level, message) {\n    if (!this.shouldLog(level)) {\n      return;\n    }\n\n    let logMessage;\n    if (this.isColoredLogEnabled) {\n      logMessage = `${this.prefix} - ${LogLevelColorInfoEnum[level]} ${getCurrentTime()} ${message}`;\n    } else {\n      logMessage = `${this.prefix} - ${LogLevelInfoEnum[level]} ${getCurrentTime()} ${message}`;\n    }\n\n    this.consoleLog(level, [logMessage]);\n  }\n\n  shouldLog(targetLogLevel) {\n    return targetLogLevel >= this.logLevel;\n  }\n\n  setLogLevel(level) {\n    if (level === undefined) {\n      this.logLevel = LogLevelEnum.ERROR;\n    } else {\n      this.logLevel = level;\n    }\n  }\n\n  consoleLog(level, logArguments) {\n    switch (level) {\n      case LogLevelEnum.INFO:\n        console.info.apply(console, logArguments);\n        break;\n      case LogLevelEnum.WARN:\n        console.warn.apply(console, logArguments);\n        break;\n      case LogLevelEnum.ERROR:\n        console.error.apply(console, logArguments);\n        break;\n      default:\n        console.log.apply(console, logArguments);\n        break;\n    }\n  }\n}\n\nmodule.exports = ConsoleLogManager;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = {\n  PASSED: 'passed',\n  FAILED: 'failed'\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst SegmentEnum = require('../enums/segment');\nconst { getKeyValue } = require('../utils/ObjectUtil');\nconst { operandCustomVariablesParser, operandUserParser } = require('../utils/SegmentUtil');\nconst logging = require('../services/logging');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\nconst FileNameEnum = require('../enums/FileNameEnum');\n\nconst { AND, OR, NOT } = SegmentEnum.SegmentOperatorTypes;\nconst { CUSTOM_VARIABLE, USER } = SegmentEnum.SegmentOperandTypes;\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst file = FileNameEnum.SegmentEvaluator;\n\nconst logger = logging.getLogger();\n\nmodule.exports = SegmentEvaluator;\n/**\n * This method: A parser which recursively evaluates the expression tree represented by dsl\n *\n * @param {Object} dsl                     The segments defined in the campaing\n * @param {Object} customVariables         Key/value pair of custom_attributs properties\n *\n * @return {Boolean}                       true if user is to be made part of campaign, else false\n */\nfunction evaluator(dsl, customVariables) {\n  let { key, value } = getKeyValue(dsl);\n  let operator = key;\n  let subDsl = value;\n  if (operator === NOT) {\n    return !evaluator(subDsl, customVariables);\n  } else if (operator === AND) {\n    let list = [];\n    for (let i = 0; i < subDsl.length; i++) {\n      list.push(evaluator(subDsl[i], customVariables));\n    }\n\n    return list.every(val => val);\n  } else if (operator === OR) {\n    let list = [];\n    for (let i = 0; i < subDsl.length; i++) {\n      list.push(evaluator(subDsl[i], customVariables));\n    }\n\n    return list.some(val => val);\n  } else if (operator === CUSTOM_VARIABLE) {\n    return operandCustomVariablesParser(subDsl, customVariables);\n  } else if (operator === USER) {\n    return operandUserParser(subDsl, customVariables);\n  }\n}\n\nfunction SegmentEvaluator(dsl, customVariables = {}, campaignKey, userId, variation = '', disableLogs = false) {\n  try {\n    if (DataTypeUtil.isObject(dsl) && !Object.keys(dsl).length) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.SEGMENTATION_SKIPPED, {\n          campaignKey,\n          userId,\n          file\n        }),\n        disableLogs\n      );\n      return true;\n    }\n    if (DataTypeUtil.isObject(dsl) && Object.keys(dsl).length) {\n      return evaluator(dsl, customVariables);\n    }\n    return true;\n  } catch (err) {\n    logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.SEGMENTATION_ERROR, {\n        campaignKey,\n        userId,\n        customVariables: JSON.stringify(customVariables),\n        file,\n        err,\n        variation\n      }),\n      disableLogs\n    );\n    return false;\n  }\n}\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = {\n  CUSTOM_VARIABLE: 'custom_variable',\n  USER: 'user'\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = {\n  AND: 'and',\n  NOT: 'not',\n  OR: 'or'\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = {\n  LOWER: /^lower/,\n  LOWER_MATCH: /^lower\\((.*)\\)/,\n  WILDCARD: /^wildcard/,\n  WILDCARD_MATCH: /^wildcard\\((.*)\\)/,\n  REGEX: /^regex/,\n  REGEX_MATCH: /^regex\\((.*)\\)/,\n  STARTING_STAR: /^\\*/,\n  ENDING_STAR: /\\*$/,\n  GREATER_THAN_MATCH: /^gt\\(((\\d+\\.?\\d*)|(\\.\\d+))\\)/,\n  GREATER_THAN_EQUAL_TO_MATCH: /^gte\\(((\\d+\\.?\\d*)|(\\.\\d+))\\)/,\n  LESS_THAN_MATCH: /^lt\\(((\\d+\\.?\\d*)|(\\.\\d+))\\)/,\n  LESS_THAN_EQUAL_TO_MATCH: /^lte\\(((\\d+\\.?\\d*)|(\\.\\d+))\\)/\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = {\n  LOWER_VALUE: 1,\n  STARTING_ENDING_STAR_VALUE: 2,\n  STARTING_STAR_VALUE: 3,\n  ENDING_STAR_VALUE: 4,\n  REGEX_VALUE: 5,\n  EQUAL_VALUE: 6,\n  GREATER_THAN_VALUE: 7,\n  GREATER_THAN_EQUAL_TO_VALUE: 8,\n  LESS_THAN_VALUE: 9,\n  LESS_THAN_EQUAL_TO_VALUE: 10\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = require('../utils/DataTypeUtil');\nconst { matchWithRegex } = require('../utils/FunctionUtil');\nconst { getKeyValue } = require('../utils/ObjectUtil');\nconst SegmentEnum = require('../enums/segment');\n\nconst {\n  LOWER_MATCH,\n  WILDCARD_MATCH,\n  REGEX_MATCH,\n  STARTING_STAR,\n  ENDING_STAR,\n  GREATER_THAN_MATCH,\n  GREATER_THAN_EQUAL_TO_MATCH,\n  LESS_THAN_MATCH,\n  LESS_THAN_EQUAL_TO_MATCH\n} = SegmentEnum.SegmentOperandValueTypeRegexes;\n\nconst {\n  LOWER_VALUE,\n  STARTING_ENDING_STAR_VALUE,\n  STARTING_STAR_VALUE,\n  ENDING_STAR_VALUE,\n  REGEX_VALUE,\n  EQUAL_VALUE,\n  GREATER_THAN_VALUE,\n  GREATER_THAN_EQUAL_TO_VALUE,\n  LESS_THAN_VALUE,\n  LESS_THAN_EQUAL_TO_VALUE\n} = SegmentEnum.SegmentOperandValues;\n\nfunction extractOperandValue(operand, regex) {\n  return matchWithRegex(operand, regex) && matchWithRegex(operand, regex)[1];\n}\n\nfunction processValues(operandValue, tagValue) {\n  // this is atomic, either both will be processed or none\n  let processedOperandValue = parseFloat(operandValue, 10);\n  let processedTagValue = parseFloat(tagValue, 10);\n  if (!processedOperandValue || !processedTagValue) {\n    return {\n      operandValue: operandValue,\n      tagValue: tagValue\n    };\n  }\n  // now we have surity that both are numbers\n  // now we can convert them independently to int type if they\n  // are int rather than floats\n  if (processedOperandValue === Math.floor(processedOperandValue)) {\n    processedOperandValue = parseInt(processedOperandValue, 10);\n  }\n  if (processedTagValue === Math.floor(processedTagValue)) {\n    processedTagValue = parseInt(processedTagValue, 10);\n  }\n  // convert it back to string and return\n  return {\n    operandValue: processedOperandValue.toString(),\n    tagValue: processedTagValue.toString()\n  };\n}\n\nfunction preProcessTagValue(tagValue) {\n  if (tagValue === undefined) {\n    tagValue = '';\n  }\n  if (DataTypeUtil.isBoolean(tagValue)) {\n    if (tagValue) {\n      tagValue = true;\n    } else {\n      tagValue = false;\n    }\n  }\n  if (tagValue !== null) {\n    tagValue = tagValue.toString();\n  }\n  return tagValue;\n}\n\nfunction preProcessOperandValue(operand) {\n  let operandType;\n  let operandValue;\n  let startingStar;\n  let endingStar;\n  // Pre process operand value\n  if (matchWithRegex(operand, LOWER_MATCH)) {\n    operandType = LOWER_VALUE;\n    operandValue = extractOperandValue(operand, LOWER_MATCH);\n  } else if (matchWithRegex(operand, WILDCARD_MATCH)) {\n    operandValue = extractOperandValue(operand, WILDCARD_MATCH);\n    startingStar = matchWithRegex(operandValue, STARTING_STAR);\n    endingStar = matchWithRegex(operandValue, ENDING_STAR);\n    // In case of wildcard, the operand type is further divided into contains, startswith and endswith\n    if (startingStar && endingStar) {\n      operandType = STARTING_ENDING_STAR_VALUE;\n    } else if (startingStar) {\n      operandType = STARTING_STAR_VALUE;\n    } else if (endingStar) {\n      operandType = ENDING_STAR_VALUE;\n    }\n    operandValue = operandValue.replace(STARTING_STAR, '').replace(ENDING_STAR, '');\n  } else if (matchWithRegex(operand, REGEX_MATCH)) {\n    operandType = REGEX_VALUE;\n    operandValue = extractOperandValue(operand, REGEX_MATCH);\n  } else if (matchWithRegex(operand, GREATER_THAN_MATCH)) {\n    operandType = GREATER_THAN_VALUE;\n    operandValue = extractOperandValue(operand, GREATER_THAN_MATCH);\n  } else if (matchWithRegex(operand, GREATER_THAN_EQUAL_TO_MATCH)) {\n    operandType = GREATER_THAN_EQUAL_TO_VALUE;\n    operandValue = extractOperandValue(operand, GREATER_THAN_EQUAL_TO_MATCH);\n  } else if (matchWithRegex(operand, LESS_THAN_MATCH)) {\n    operandType = LESS_THAN_VALUE;\n    operandValue = extractOperandValue(operand, LESS_THAN_MATCH);\n  } else if (matchWithRegex(operand, LESS_THAN_EQUAL_TO_MATCH)) {\n    operandType = LESS_THAN_EQUAL_TO_VALUE;\n    operandValue = extractOperandValue(operand, LESS_THAN_EQUAL_TO_MATCH);\n  } else {\n    operandType = EQUAL_VALUE;\n    operandValue = operand;\n  }\n  return {\n    operandType,\n    operandValue\n  };\n}\n\nfunction operandCustomVariablesParser(operand, customVariables) {\n  // Extract custom_variable_key and custom_variable_value from operand\n  let { key, value } = getKeyValue(operand);\n  let operandKey = key;\n  operand = value;\n  if (!customVariables.hasOwnProperty(key)) {\n    // For handling \".*\" regex case when key is not present in customVariables and matches regex is used.\n    return false;\n  }\n  let tagValue = customVariables[operandKey];\n  // Pre process tag value\n  tagValue = preProcessTagValue(tagValue);\n  let { operandType, operandValue } = preProcessOperandValue(operand);\n  // Process both operand and tag values\n  let processedValues = processValues(operandValue, tagValue);\n  tagValue = processedValues.tagValue;\n  return extractResult(operandType, processedValues.operandValue, tagValue);\n}\n\nfunction operandUserParser(operand, customVariables) {\n  const users = operand.split(',');\n  for (let i = 0; i < users.length; i++) {\n    if (users[i].trim() === customVariables._vwoUserId) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction extractResult(operandType, operandValue, tagValue) {\n  let result;\n\n  switch (operandType) {\n    case LOWER_VALUE:\n      if (tagValue !== null) {\n        result = operandValue.toLowerCase() === tagValue.toLowerCase();\n      }\n      break;\n    case STARTING_ENDING_STAR_VALUE:\n      if (tagValue !== null) {\n        result = tagValue.indexOf(operandValue) > -1;\n      }\n      break;\n    case STARTING_STAR_VALUE:\n      if (tagValue !== null) {\n        result = tagValue.endsWith(operandValue);\n      }\n      break;\n    case ENDING_STAR_VALUE:\n      if (tagValue !== null) {\n        result = tagValue.startsWith(operandValue);\n      }\n      break;\n    case REGEX_VALUE:\n      try {\n        let pattern = new RegExp(operandValue, 'g');\n        result = !!pattern.test(tagValue);\n      } catch (err) {\n        result = false;\n      }\n      break;\n    case GREATER_THAN_VALUE:\n      if (tagValue !== null) {\n        try {\n          result = parseFloat(operandValue) < parseFloat(tagValue);\n        } catch (err) {\n          result = false;\n        }\n      }\n      break;\n    case GREATER_THAN_EQUAL_TO_VALUE:\n      if (tagValue !== null) {\n        try {\n          result = parseFloat(operandValue) <= parseFloat(tagValue);\n        } catch (err) {\n          result = false;\n        }\n      }\n      break;\n    case LESS_THAN_VALUE:\n      if (tagValue !== null) {\n        try {\n          result = parseFloat(operandValue) > parseFloat(tagValue);\n        } catch (err) {\n          result = false;\n        }\n      }\n      break;\n    case LESS_THAN_EQUAL_TO_VALUE:\n      if (tagValue !== null) {\n        try {\n          result = parseFloat(operandValue) >= parseFloat(tagValue);\n        } catch (err) {\n          result = false;\n        }\n      }\n      break;\n    default:\n      result = tagValue === operandValue;\n  }\n\n  return result;\n}\n\nmodule.exports = {\n  extractOperandValue,\n  processValues,\n  preProcessTagValue,\n  preProcessOperandValue,\n  operandCustomVariablesParser,\n  operandUserParser\n};\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst HooksEnum = {\n  DECISION_TYPES: {\n    CAMPAIGN_DECISION: 'CAMPAIGN_DECISION'\n  }\n};\n\nmodule.exports = HooksEnum;\n","var v35 = require('./lib/v35.js');\nvar sha1 = require('./lib/sha1');\nmodule.exports = v35('v5', 0x50, sha1);\n","var bytesToUuid = require('./bytesToUuid');\n\nfunction uuidToBytes(uuid) {\n  // Note: We assume we're being passed a valid uuid string\n  var bytes = [];\n  uuid.replace(/[a-fA-F0-9]{2}/g, function(hex) {\n    bytes.push(parseInt(hex, 16));\n  });\n\n  return bytes;\n}\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n  var bytes = new Array(str.length);\n  for (var i = 0; i < str.length; i++) {\n    bytes[i] = str.charCodeAt(i);\n  }\n  return bytes;\n}\n\nmodule.exports = function(name, version, hashfunc) {\n  var generateUUID = function(value, namespace, buf, offset) {\n    var off = buf && offset || 0;\n\n    if (typeof(value) == 'string') value = stringToBytes(value);\n    if (typeof(namespace) == 'string') namespace = uuidToBytes(namespace);\n\n    if (!Array.isArray(value)) throw TypeError('value must be an array of bytes');\n    if (!Array.isArray(namespace) || namespace.length !== 16) throw TypeError('namespace must be uuid string or an Array of 16 byte values');\n\n    // Per 4.3\n    var bytes = hashfunc(namespace.concat(value));\n    bytes[6] = (bytes[6] & 0x0f) | version;\n    bytes[8] = (bytes[8] & 0x3f) | 0x80;\n\n    if (buf) {\n      for (var idx = 0; idx < 16; ++idx) {\n        buf[off+idx] = bytes[idx];\n      }\n    }\n\n    return buf || bytesToUuid(bytes);\n  };\n\n  // Function#name is not settable on some platforms (#270)\n  try {\n    generateUUID.name = name;\n  } catch (err) {\n  }\n\n  // Pre-defined namespaces, per Appendix C\n  generateUUID.DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\n  generateUUID.URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\n\n  return generateUUID;\n};\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","// Adapted from Chris Veness' SHA1 code at\n// http://www.movable-type.co.uk/scripts/sha1.html\n'use strict';\n\nfunction f(s, x, y, z) {\n  switch (s) {\n    case 0: return (x & y) ^ (~x & z);\n    case 1: return x ^ y ^ z;\n    case 2: return (x & y) ^ (x & z) ^ (y & z);\n    case 3: return x ^ y ^ z;\n  }\n}\n\nfunction ROTL(x, n) {\n  return (x << n) | (x>>> (32 - n));\n}\n\nfunction sha1(bytes) {\n  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  if (typeof(bytes) == 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n    bytes = new Array(msg.length);\n    for (var i = 0; i < msg.length; i++) bytes[i] = msg.charCodeAt(i);\n  }\n\n  bytes.push(0x80);\n\n  var l = bytes.length/4 + 2;\n  var N = Math.ceil(l/16);\n  var M = new Array(N);\n\n  for (var i=0; i<N; i++) {\n    M[i] = new Array(16);\n    for (var j=0; j<16; j++) {\n      M[i][j] =\n        bytes[i * 64 + j * 4] << 24 |\n        bytes[i * 64 + j * 4 + 1] << 16 |\n        bytes[i * 64 + j * 4 + 2] << 8 |\n        bytes[i * 64 + j * 4 + 3];\n    }\n  }\n\n  M[N - 1][14] = ((bytes.length - 1) * 8) /\n    Math.pow(2, 32); M[N - 1][14] = Math.floor(M[N - 1][14]);\n  M[N - 1][15] = ((bytes.length - 1) * 8) & 0xffffffff;\n\n  for (var i=0; i<N; i++) {\n    var W = new Array(80);\n\n    for (var t=0; t<16; t++) W[t] = M[i][t];\n    for (var t=16; t<80; t++) {\n      W[t] = ROTL(W[t - 3] ^ W[t - 8] ^ W[t - 14] ^ W[t - 16], 1);\n    }\n\n    var a = H[0];\n    var b = H[1];\n    var c = H[2];\n    var d = H[3];\n    var e = H[4];\n\n    for (var t=0; t<80; t++) {\n      var s = Math.floor(t/20);\n      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[t] >>> 0;\n      e = d;\n      d = c;\n      c = ROTL(b, 30) >>> 0;\n      b = a;\n      a = T;\n    }\n\n    H[0] = (H[0] + a) >>> 0;\n    H[1] = (H[1] + b) >>> 0;\n    H[2] = (H[2] + c) >>> 0;\n    H[3] = (H[3] + d) >>> 0;\n    H[4] = (H[4] + e) >>> 0;\n  }\n\n  return [\n    H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff,\n    H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff,\n    H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff,\n    H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff,\n    H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff\n  ];\n}\n\nmodule.exports = sha1;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst ApiEnum = require('../enums/ApiEnum');\n\nconst DecisionUtil = require('../utils/DecisionUtil');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.GetVariation;\n\n/**\n * This API method: Gets the variation assigned for the user for the campaign\n *\n * 1. Validates the arguments being passed\n * 2. Checks if user is eligible to get bucketed into the campaign,\n * 3. Assigns the determinitic variation to the user(based on userId), if user becomes part of campaign\n *    If userStorageService is used, it will look into it for the variation and if found, no further processing is done\n *\n * @param {Object} vwoInstance       VWO instance which has logger, settingsFile etc.\n * @param {String} campaignKey       unique campaign key specified in VWO app\n * @param {String} userId            ID assigned to a user\n * @param {Object} options           Optional params\n *\n * @return {String|null}             If variation is assigned then variation-name otherwise null in case of user not becoming part\n */\nfunction getVariation(vwoInstance, campaignKey, userId, options = {}) {\n  const api = ApiEnum.GET_VARIATION_NAME;\n  let areParamsValid = false;\n  if (DataTypeUtil.isObject(options)) {\n    var { customVariables, variationTargetingVariables, userStorageData, metaData } = options;\n    // Check if arguments have valid data-type\n    if (\n      ValidateUtil.areValidParamsForAPIMethod({\n        method: ApiEnum.GET_VARIATION_NAME,\n        campaignKey,\n        userId,\n        customVariables,\n        variationTargetingVariables,\n        userStorageData,\n        metaData\n      })\n    ) {\n      areParamsValid = true;\n    }\n  }\n\n  if (areParamsValid === false) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n        file,\n        api: ApiEnum.GET_VARIATION_NAME\n      })\n    );\n    return null;\n  }\n\n  // Get the cached configuration\n  let config = vwoInstance.SettingsFileManager.getConfig();\n  let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n  config.apiName = api;\n\n  // If no settings are found, simply return no variation\n  if (!settingsFile) {\n    return null;\n  }\n\n  // Get the campaign settings based on campaignKey from the settings\n  let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n  // If matching campaign is not found with campaignKey or if found but is in not RUNNING state, simply return no variation\n  if (!campaign || campaign.status !== Constants.STATUS_RUNNING) {\n    vwoInstance.logger.log(\n      LogLevelEnum.WARN,\n      LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_RUNNING, {\n        file,\n        campaignKey: campaignKey,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  if (CampaignUtil.isFeatureRolloutCampaign(campaign)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_NOT_APPLICABLE, {\n        file,\n        campaignKey,\n        campaignType: campaign.type,\n        userId,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  const result = DecisionUtil.getVariation(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables,\n    userStorageData,\n    metaData,\n    false,\n    false,\n    undefined,\n    api\n  );\n\n  if (DataTypeUtil.isPromise(result)) {\n    return result.then(function(data) {\n      return data;\n    });\n  }\n\n  if (!result.variationName) {\n    return null;\n  }\n\n  return result.variationName;\n}\n\nmodule.exports = getVariation;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst GoalTypeEnum = require('../enums/GoalTypeEnum');\nconst ApiEnum = require('../enums/ApiEnum');\n\nconst DecisionUtil = require('../utils/DecisionUtil');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst { objectValues } = require('../utils/ObjectUtil');\nconst ImpressionUtil = require('../utils/ImpressionUtil');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\nconst logging = require('../services/logging');\n\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.Track;\nconst GOAL_TYPE_TO_TRACK_DEFAULT = GoalTypeEnum.ALL;\nconst GOAL_IDENTIFIER_SEPERATOR = '_vwo_';\nconst api = ApiEnum.TRACK;\n\nlet BatchEventsDispatcher;\nif (typeof process.env !== 'undefined') {\n  BatchEventsDispatcher = require('../utils/BatchEventsDispatcher');\n}\n\n/**\n * This API method: Marks the conversion of the campaign for a particular goal\n *\n * 1. validates the arguments being passed\n * 2. Checks if user is eligible to get bucketed into the campaign,\n * 3. Gets the assigned determinitic variation to the user(based on userId), if user becomes part of campaign\n * 4. Sends an impression call to VWO server to track goal data\n *\n * @param {Object} vwoInstance               VWO instance which has logger, settingsFile etc.\n * @param {Number} campaignKey               unique campaign test key\n * @param {String} userId                    ID assigned to a user\n * @param {String} goalIdentifier             unique campaign's goal identifier\n * @param {Object} options                   Optional params\n */\nfunction track(vwoInstance, campaignKey, userId, goalIdentifier, options = {}) {\n  let areParamsValid = false;\n  if (DataTypeUtil.isObject(options)) {\n    var {\n      revenueValue,\n      customVariables,\n      variationTargetingVariables,\n      userStorageData,\n      goalTypeToTrack,\n      shouldTrackReturningUser,\n      metaData,\n      responseCallback,\n      eventProperties,\n      userAgent,\n      userIpAddress\n    } = options;\n    var visitorUserAgent = userAgent;\n    // Check if arguments have valid data-type\n    if (\n      ValidateUtil.areValidParamsForAPIMethod({\n        method: ApiEnum.TRACK,\n        campaignKey,\n        userId,\n        goalIdentifier,\n        customVariables,\n        variationTargetingVariables,\n        userStorageData,\n        goalTypeToTrack,\n        shouldTrackReturningUser,\n        metaData,\n        responseCallback,\n        eventProperties,\n        visitorUserAgent,\n        userIpAddress\n      }) &&\n      (!goalTypeToTrack || (goalTypeToTrack && objectValues(GoalTypeEnum).includes(goalTypeToTrack)))\n    ) {\n      areParamsValid = true;\n    }\n  }\n\n  if (areParamsValid === false) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n        file,\n        api: ApiEnum.TRACK\n      })\n    );\n    return null;\n  }\n\n  // Get the cached configuration\n  let config = vwoInstance.SettingsFileManager.getConfig();\n  let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n  config.apiName = api;\n  let revenuePropList = new Set();\n\n  // If no settings are found, simply do not track goal and return false\n  if (!settingsFile) {\n    return null;\n  }\n\n  let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n  // check if MAB enabled, if yes, then userStorage must be defined\n  if (campaign && campaign.hasOwnProperty('isMAB') && campaign.isMAB === true) {\n    if (vwoInstance.userStorageService === undefined) {\n      vwoInstance.logger.log(\n        LogLevelEnum.ERROR,\n        '(' +\n          file +\n          ') This campaign: ' +\n          campaignKey +\n          ' has MAB configured. Please configure User Storage to proceed.'\n      );\n\n      return null;\n    }\n  }\n\n  let campaigns = [];\n  goalTypeToTrack = goalTypeToTrack || config.goalTypeToTrack || GOAL_TYPE_TO_TRACK_DEFAULT; // priority order - options > launchConfig > default\n  if (DataTypeUtil.isUndefined(shouldTrackReturningUser)) {\n    // if shouldTrackReturningUser is not given in options\n    if (DataTypeUtil.isBoolean(config.shouldTrackReturningUser)) {\n      // if shouldTrackReturningUser is given in config at launch\n      shouldTrackReturningUser = config.shouldTrackReturningUser;\n    } else {\n      shouldTrackReturningUser = false;\n    }\n  }\n  if (!DataTypeUtil.isString(campaignKey)) {\n    if (DataTypeUtil.isArray(campaignKey)) {\n      campaigns = CampaignUtil.getCampaignsForKeys(settingsFile, campaignKey);\n    } else {\n      campaigns = CampaignUtil.getCampaignsForGoal(settingsFile, goalIdentifier, goalTypeToTrack);\n    }\n  } else {\n    // Get the campaign settings based on campaignKey from the settings\n    let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n    campaigns.push(campaign || { key: campaignKey });\n  }\n  const result = {};\n  let metricMap = {};\n  let events = [];\n  let areGlobalGoals = typeof process.env === 'undefined' ? false : campaigns.length > 1;\n\n  campaigns.forEach(\n    campaign =>\n      (result[campaign.key] = trackCampaignGoal(\n        vwoInstance,\n        campaign,\n        campaign.key,\n        userId,\n        settingsFile,\n        goalIdentifier,\n        revenueValue,\n        config,\n        customVariables,\n        variationTargetingVariables,\n        userStorageData,\n        goalTypeToTrack,\n        shouldTrackReturningUser,\n        metaData,\n        metricMap,\n        revenuePropList,\n        events,\n        areGlobalGoals,\n        eventProperties,\n        visitorUserAgent,\n        userIpAddress\n      ))\n  );\n\n  // Check if each object in result is a promise\n  // in case of asyncStorageConfig, each object would be a promise only\n  // Check if result is a non-empty object\n  const areAllPromises =\n    result && Object.keys(result).length > 0\n      ? Object.values(result).every(item => DataTypeUtil.isPromise(item))\n      : false;\n  // const areAllPromises = Object.values(result).every(item => DataTypeUtil.isPromise(item));\n\n  if (areAllPromises) {\n    // Promise.all - This method takes an array of promises and returns a new promise that resolves to an array of the resolved values when all of the input promises have resolved.\n    // If any of the promises in the array reject, the whole Promise.all is rejected.\n    return Promise.all(Object.values(result)).then(dataArray => {\n      dataArray.forEach((data, index) => {\n        const campaignKey = Object.keys(result)[index];\n        const ans = _validateAndReturnTrackValue(\n          vwoInstance,\n          config,\n          settingsFile,\n          revenuePropList,\n          userId,\n          goalIdentifier,\n          revenueValue,\n          metricMap,\n          events,\n          areGlobalGoals,\n          responseCallback,\n          eventProperties,\n          visitorUserAgent,\n          userIpAddress,\n          { [campaignKey]: data }\n        );\n        result[campaignKey] = ans[campaignKey];\n      });\n      return result;\n    });\n  }\n  return _validateAndReturnTrackValue(\n    vwoInstance,\n    config,\n    settingsFile,\n    revenuePropList,\n    userId,\n    goalIdentifier,\n    revenueValue,\n    metricMap,\n    events,\n    areGlobalGoals,\n    responseCallback,\n    eventProperties,\n    visitorUserAgent,\n    userIpAddress,\n    result\n  );\n}\n\nfunction _validateAndReturnTrackValue(\n  vwoInstance,\n  config,\n  settingsFile,\n  revenuePropList,\n  userId,\n  goalIdentifier,\n  revenueValue,\n  metricMap,\n  events,\n  areGlobalGoals,\n  responseCallback,\n  eventProperties,\n  visitorUserAgent,\n  userIpAddress,\n  result\n) {\n  if (!Object.keys(result).length) {\n    return null;\n  }\n\n  if (typeof process.env === 'undefined') {\n    if (events && events.length) {\n      for (let k = 0; k < events.length; k++) {\n        vwoInstance.eventQueue.process(config, events[k], vwoInstance, { responseCallback });\n      }\n    }\n  } else if (!settingsFile.isEventArchEnabled && events && events.length) {\n    if (!areGlobalGoals) {\n      vwoInstance.eventQueue.process(config, events[0], vwoInstance, { responseCallback });\n    } else if (!config.isDevelopmentMode) {\n      BatchEventsDispatcher.dispatch(\n        {\n          ev: events\n        },\n        responseCallback,\n        Object.assign(\n          {},\n          {\n            a: vwoInstance.SettingsFileManager.getSettingsFile().accountId\n          },\n          vwoInstance.usageStats.getUsageStats()\n        ),\n        vwoInstance.SettingsFileManager.getSettingsFile().sdkKey\n      );\n    }\n  }\n\n  if (settingsFile.isEventArchEnabled && Object.keys(metricMap).length > 0) {\n    let properties = ImpressionUtil.getEventsBaseProperties(\n      settingsFile,\n      goalIdentifier,\n      {},\n      visitorUserAgent,\n      userIpAddress\n    );\n    let payload = ImpressionUtil.getTrackGoalPayloadData(\n      settingsFile,\n      userId,\n      goalIdentifier,\n      metricMap,\n      revenueValue,\n      revenuePropList,\n      eventProperties\n    );\n    vwoInstance.eventQueue.process(config, properties, vwoInstance, { payload, responseCallback });\n\n    // save to user storage if not event arch\n    if (!settingsFile.isEventArchEnabled) {\n      Object.keys(metricMap).forEach(function(key) {\n        DecisionUtil._saveUserData(\n          config,\n          metricMap[key].campaign,\n          metricMap[key].variationName,\n          metricMap[key].userId,\n          metricMap[key].metaData,\n          goalIdentifier\n        );\n      });\n    }\n  }\n\n  if (config.isDevelopmentMode) {\n    return Object.assign({}, result, { isDevelopmentMode: config.isDevelopmentMode });\n  }\n\n  return result;\n}\n\nfunction trackCampaignGoal(\n  vwoInstance,\n  campaign,\n  campaignKey,\n  userId,\n  settingsFile,\n  goalIdentifier,\n  revenueValue,\n  config,\n  customVariables,\n  variationTargetingVariables,\n  userStorageData,\n  goalTypeToTrack,\n  shouldTrackReturningUser,\n  metaData,\n  metricMap,\n  revenuePropList,\n  events,\n  areGlobalGoals,\n  eventProperties,\n  visitorUserAgent,\n  userIpAddress\n) {\n  // If matching campaign is not found with campaignKey or if found but is in not RUNNING state, simply return no variation\n  if (!campaign || campaign.status !== Constants.STATUS_RUNNING) {\n    vwoInstance.logger.log(\n      LogLevelEnum.WARN,\n      LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_RUNNING, {\n        file,\n        campaignKey: campaignKey,\n        api\n      })\n    );\n\n    return false;\n  }\n\n  if (CampaignUtil.isFeatureRolloutCampaign(campaign)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_NOT_APPLICABLE, {\n        file,\n        campaignKey,\n        campaignType: campaign.type,\n        userId,\n        api\n      })\n    );\n\n    return false;\n  }\n\n  let campaignId = campaign.id;\n\n  // Get the campaign goal settings based on goalIdentifier\n  let goal = CampaignUtil.getCampaignGoal(settingsFile, campaign.key, goalIdentifier);\n\n  if (!goal) {\n    // If no goal is found, something is wrong with the goalIdentifier\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.TRACK_API_GOAL_NOT_FOUND, {\n        file,\n        userId,\n        goalIdentifier,\n        campaignKey: campaignKey\n      })\n    );\n    return false;\n  } else if (goalTypeToTrack !== GOAL_TYPE_TO_TRACK_DEFAULT && goal.type !== goalTypeToTrack) {\n    return false;\n  } else if (goal.type === GoalTypeEnum.REVENUE && !ValidateUtil.isValidValue(revenueValue)) {\n    if (settingsFile.isEventArchEnabled) {\n      /* \n      If it's a metric of type - value of an event property and calculation logic is first Value (mca != -1 )\n      */\n      if (goal.mca !== -1) {\n        /*\n        In this case it is expected that goal will have revenueProp\n        Error should be logged if eventProperties is not Defined ` OR ` eventProperties does not have revenueProp key\n        */\n        if (DataTypeUtil.isUndefined(eventProperties) || !eventProperties.hasOwnProperty(goal.revenueProp)) {\n          logIncorrectParamsForRevenueGoal(vwoInstance, userId, goalIdentifier, campaignKey);\n          return false;\n        }\n      } else {\n        /*\n        here mca == -1 so there could only be 2 scenarios, \n        1. If revenueProp is defined then eventProperties should have revenueProp key\n        2. if revenueProp is not defined then it's a metric of type - Number of times an event has been triggered.\n        */\n        if (goal.revenueProp) {\n          // Error should be logged if eventProperties is not Defined ` OR ` eventProperties does not have revenueProp key\n          if (DataTypeUtil.isUndefined(eventProperties) || !eventProperties.hasOwnProperty(goal.revenueProp)) {\n            logIncorrectParamsForRevenueGoal(vwoInstance, userId, goalIdentifier, campaignKey);\n            return false;\n          }\n        }\n      }\n    } else {\n      logIncorrectParamsForRevenueGoal(vwoInstance, userId, goalIdentifier, campaignKey);\n      return false;\n    }\n  }\n\n  if (goal.type === GoalTypeEnum.REVENUE && goal.revenueProp) {\n    revenuePropList.add(goal.revenueProp);\n  }\n\n  const result = DecisionUtil.getVariation(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables,\n    userStorageData,\n    metaData,\n    false,\n    true,\n    goalIdentifier,\n    api\n  );\n\n  if (DataTypeUtil.isPromise(result)) {\n    return result.then(function(data) {\n      if (!Object.keys(data).length) {\n        return null;\n      }\n      return _validateAndReturnTrackEvent(\n        vwoInstance,\n        campaignKey,\n        campaignId,\n        userId,\n        config,\n        goal,\n        shouldTrackReturningUser,\n        settingsFile,\n        campaign,\n        goalIdentifier,\n        revenueValue,\n        metaData,\n        metricMap,\n        events,\n        areGlobalGoals,\n        eventProperties,\n        visitorUserAgent,\n        userIpAddress,\n        data\n      );\n    });\n  }\n\n  return _validateAndReturnTrackEvent(\n    vwoInstance,\n    campaignKey,\n    campaignId,\n    userId,\n    config,\n    goal,\n    shouldTrackReturningUser,\n    settingsFile,\n    campaign,\n    goalIdentifier,\n    revenueValue,\n    metaData,\n    metricMap,\n    events,\n    areGlobalGoals,\n    eventProperties,\n    visitorUserAgent,\n    userIpAddress,\n    result\n  );\n}\n\nfunction _validateAndReturnTrackEvent(\n  vwoInstance,\n  campaignKey,\n  campaignId,\n  userId,\n  config,\n  goal,\n  shouldTrackReturningUser,\n  settingsFile,\n  campaign,\n  goalIdentifier,\n  revenueValue,\n  metaData,\n  metricMap,\n  events,\n  areGlobalGoals,\n  eventProperties,\n  visitorUserAgent,\n  userIpAddress,\n  result\n) {\n  var { variationId, variationName, storedGoalIdentifier } = result;\n  // Is User is a part of Campaign and has been decided to be a part of particular variation\n  if (variationName) {\n    if (storedGoalIdentifier) {\n      const identifiers = storedGoalIdentifier.split(GOAL_IDENTIFIER_SEPERATOR);\n      if (!identifiers.includes(goalIdentifier)) {\n        storedGoalIdentifier += GOAL_IDENTIFIER_SEPERATOR + goalIdentifier;\n\n        // save to user storage if not event arch\n        if (!settingsFile.isEventArchEnabled) {\n          DecisionUtil._saveUserData(config, campaign, variationName, userId, metaData, storedGoalIdentifier);\n        }\n      } else if (!shouldTrackReturningUser && goal.mca !== -1) {\n        vwoInstance.logger.log(\n          LogLevelEnum.INFO,\n          LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CAMPAIGN_GOAL_ALREADY_TRACKED, {\n            file,\n            userId,\n            goalIdentifier,\n            campaignKey\n          })\n        );\n        return false;\n      }\n    }\n    // If goal is found, send an impression to VWO server for report stats\n    if (config.batchEvents) {\n      let properties = ImpressionUtil.buildBatchEventForTrackingGoal(\n        settingsFile,\n        campaignId,\n        variationId,\n        userId,\n        goal,\n        revenueValue,\n        eventProperties,\n        visitorUserAgent,\n        userIpAddress\n      );\n      vwoInstance.batchEventsQueue.enqueue(properties);\n    } else if (settingsFile.isEventArchEnabled) {\n      metricMap[campaign.id] = {\n        config,\n        campaign,\n        variationName,\n        userId,\n        metaData,\n        goal\n      };\n      return true;\n    } else {\n      let properties = {};\n\n      if (areGlobalGoals) {\n        properties = ImpressionUtil.buildBatchEventForTrackingGoal(\n          settingsFile,\n          campaignId,\n          variationId,\n          userId,\n          goal,\n          revenueValue,\n          visitorUserAgent,\n          userIpAddress\n        );\n      } else {\n        properties = ImpressionUtil.buildEventForTrackingGoal(\n          settingsFile,\n          campaignId,\n          variationId,\n          userId,\n          goal,\n          revenueValue,\n          visitorUserAgent,\n          userIpAddress\n        );\n      }\n\n      events.push(properties);\n    }\n\n    // save to user storage if not event arch\n    if (!settingsFile.isEventArchEnabled) {\n      DecisionUtil._saveUserData(config, campaign, variationName, userId, metaData, goalIdentifier);\n    }\n    return true;\n  }\n\n  return false;\n}\n\nfunction logIncorrectParamsForRevenueGoal(vwoInstance, userId, goalIdentifier, campaignKey) {\n  vwoInstance.logger.log(\n    LogLevelEnum.ERROR,\n    LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.TRACK_API_REVENUE_NOT_PASSED_FOR_REVENUE_GOAL, {\n      file,\n      userId,\n      goalIdentifier,\n      campaignKey\n    })\n  );\n}\n\nmodule.exports = track;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst ApiEnum = require('../enums/ApiEnum');\n\nconst DecisionUtil = require('../utils/DecisionUtil');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst ImpressionUtil = require('../utils/ImpressionUtil');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst EventEnum = require('../enums/EventEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.IsFeatureEnabled;\n\n/**\n * This API checks: Whether a feature is enabled or not for the given user\n *\n * 1. Validates the arguments being passed\n * 2. Checks if user is eligible for campaign and check if feature is enabled for the user.\n * 4. If feature enabled, sends a call to VWO server for tracking visitor\n *\n * @param {Object} vwoInstance       VWO instance which has logger, settingsFile etc.\n * @param {String} campaignKey       Unique key for a campaign\n * @param {String} userId            Unique identifier for the user\n * @param {Object} options           Optional params\n *\n * @return {Boolean}                 true if feature enabled, false otherwise\n */\nfunction isFeatureEnabled(vwoInstance, campaignKey, userId, options = {}) {\n  const api = ApiEnum.IS_FEATURE_ENABLED;\n  let areParamsValid = false;\n  if (DataTypeUtil.isObject(options)) {\n    var {\n      customVariables,\n      variationTargetingVariables,\n      userStorageData,\n      shouldTrackReturningUser,\n      metaData,\n      responseCallback,\n      userAgent,\n      userIpAddress\n    } = options;\n    var visitorUserAgent = userAgent;\n    // Check if arguments have valid data-type\n    if (\n      ValidateUtil.areValidParamsForAPIMethod({\n        method: ApiEnum.IS_FEATURE_ENABLED,\n        campaignKey,\n        userId,\n        customVariables,\n        variationTargetingVariables,\n        userStorageData,\n        shouldTrackReturningUser,\n        metaData,\n        responseCallback,\n        visitorUserAgent,\n        userIpAddress\n      })\n    ) {\n      areParamsValid = true;\n    }\n  }\n\n  if (areParamsValid === false) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n        file,\n        api: ApiEnum.isFeatureEnabled\n      })\n    );\n    return null;\n  }\n\n  // Get the cached configuration\n  let config = vwoInstance.SettingsFileManager.getConfig();\n  let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n\n  // If no settings are found, simply log and return false\n  if (!settingsFile) {\n    return null;\n  }\n\n  shouldTrackReturningUser = shouldTrackReturningUser || config.shouldTrackReturningUser || false;\n\n  // Get the campaign settings based on campaignKey from the settings\n  let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n  // check if MAB enabled, if yes, then userStorage must be defined\n  if (campaign && campaign.hasOwnProperty('isMAB') && campaign.isMAB === true) {\n    if (vwoInstance.userStorageService === undefined) {\n      vwoInstance.logger.log(\n        LogLevelEnum.ERROR,\n        '(' +\n          file +\n          ') This campaign: ' +\n          campaignKey +\n          ' has MAB configured. Please configure User Storage to proceed.'\n      );\n\n      return null;\n    }\n  }\n\n  if (!campaign || campaign.status !== Constants.STATUS_RUNNING) {\n    vwoInstance.logger.log(\n      LogLevelEnum.WARN,\n      LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_RUNNING, {\n        file,\n        campaignKey,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  if (CampaignUtil.isAbCampaign(campaign)) {\n    // API not allowed for full-stack AB campaigns\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_NOT_APPLICABLE, {\n        file,\n        campaignKey,\n        campaignType: campaign.type,\n        userId,\n        api\n      })\n    );\n\n    return null;\n  }\n\n  const result = DecisionUtil.getVariation(\n    config,\n    settingsFile,\n    campaign,\n    campaignKey,\n    userId,\n    customVariables,\n    variationTargetingVariables,\n    userStorageData,\n    metaData,\n    true,\n    false,\n    undefined,\n    api\n  );\n\n  // check if result is a promise, if yes then wait for it untill it resolves, then only proceed further\n  if (DataTypeUtil.isPromise(result)) {\n    return result.then(function(data) {\n      return _validateAndReturnFeatureEnabled(\n        vwoInstance,\n        campaignKey,\n        userId,\n        config,\n        api,\n        shouldTrackReturningUser,\n        settingsFile,\n        campaign,\n        responseCallback,\n        visitorUserAgent,\n        userIpAddress,\n        data\n      );\n    });\n  }\n\n  return _validateAndReturnFeatureEnabled(\n    vwoInstance,\n    campaignKey,\n    userId,\n    config,\n    api,\n    shouldTrackReturningUser,\n    settingsFile,\n    campaign,\n    responseCallback,\n    visitorUserAgent,\n    userIpAddress,\n    result\n  );\n}\n\nfunction _validateAndReturnFeatureEnabled(\n  vwoInstance,\n  campaignKey,\n  userId,\n  config,\n  api,\n  shouldTrackReturningUser,\n  settingsFile,\n  campaign,\n  responseCallback,\n  visitorUserAgent,\n  userIpAddress,\n  result\n) {\n  var { variation, variationId, variationName, isStoredVariation } = result;\n\n  let isFeatureEnabled = false;\n\n  if (variationName) {\n    isFeatureEnabled = CampaignUtil.isFeatureRolloutCampaign(campaign) || variation.isFeatureEnabled;\n\n    if (isStoredVariation && !shouldTrackReturningUser) {\n      vwoInstance.logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.CAMPAIGN_USER_ALREADY_TRACKED, {\n          file,\n          userId,\n          campaignKey,\n          api\n        })\n      );\n    } else {\n      // Variation found...let VWO server knows about it to show report stats\n      if (config.batchEvents) {\n        let properties = ImpressionUtil.buildBatchEventForTrackingUser(\n          settingsFile,\n          campaign.id,\n          variationId,\n          userId,\n          visitorUserAgent,\n          userIpAddress\n        );\n        vwoInstance.batchEventsQueue.enqueue(properties);\n      } else if (settingsFile.isEventArchEnabled) {\n        let properties = ImpressionUtil.getEventsBaseProperties(\n          settingsFile,\n          EventEnum.VWO_VARIATION_SHOWN,\n          vwoInstance.usageStats.getUsageStats(),\n          visitorUserAgent,\n          userIpAddress\n        );\n        let payload = ImpressionUtil.getTrackUserPayloadData(\n          settingsFile,\n          userId,\n          EventEnum.VWO_VARIATION_SHOWN,\n          campaign.id,\n          variationId\n        );\n        vwoInstance.eventQueue.process(config, properties, vwoInstance, { payload, responseCallback });\n      } else {\n        let properties = ImpressionUtil.buildEventForTrackingUser(\n          settingsFile,\n          campaign.id,\n          variationId,\n          userId,\n          vwoInstance.usageStats.getUsageStats(),\n          visitorUserAgent,\n          userIpAddress\n        );\n        vwoInstance.eventQueue.process(config, properties, vwoInstance, { responseCallback });\n      }\n\n      vwoInstance.logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.FEATURE_STATUS, {\n          file,\n          campaignKey,\n          userId,\n          status: isFeatureEnabled ? 'enabled' : 'disabled'\n        })\n      );\n\n      if (config.isDevelopmentMode) {\n        return { isFeatureEnabled };\n      }\n\n      return isFeatureEnabled;\n    }\n  }\n\n  vwoInstance.logger.log(\n    LogLevelEnum.INFO,\n    LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.FEATURE_STATUS, {\n      file,\n      campaignKey,\n      userId,\n      status: isFeatureEnabled ? 'enabled' : 'disabled'\n    })\n  );\n\n  if (isStoredVariation || config.isDevelopmentMode) {\n    return { isFeatureEnabled };\n  }\n\n  return { isFeatureEnabled };\n}\n\nmodule.exports = isFeatureEnabled;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst Constants = require('../constants');\nconst ApiEnum = require('../enums/ApiEnum');\n\nconst DecisionUtil = require('../utils/DecisionUtil');\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst FeatureUtil = require('../utils/FeatureUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\nconst ObjectUtil = require('../utils/ObjectUtil');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.GetFeatureVariableValue;\n\n/**\n * This API method:\n *\n * 1. Validates the arguments being passed\n * 2. Checks if user is eligible for campaign and check if feature is enabled for the user.\n * 4. If feature enabled, return the variable for that variation(if Feature Test),\n *    otherwise the default values being set in Feature\n *\n * @param {Object} vwoInstance   VWO instance which has logger, settingsFile etc.\n * @param {String} campaignKey   Unique key for a campaign\n * @param {String} variableKey   Unique key for a feature's variable\n * @param {String} userId        Unique identifier for the user\n * @param {Object} options           Optional params\n *\n * @return {string|number|double|boolean|null} Variable value as is set in the VWO app i.e.\n *                                             maintaining the data-type,\n *                                             null if anything fails like campaign / variable not found\n */\nfunction getFeatureVariableValue(vwoInstance, campaignKey, variableKey, userId, options = {}) {\n  try {\n    const api = ApiEnum.GET_FEATURE_VARIABLE_VALUE;\n    let areParamsValid = false;\n    if (DataTypeUtil.isObject(options)) {\n      var { customVariables, variationTargetingVariables, userStorageData, metaData } = options;\n      // Check if arguments have valid data-type\n      if (\n        ValidateUtil.areValidParamsForAPIMethod({\n          method: ApiEnum.GET_FEATURE_VARIABLE_VALUE,\n          campaignKey,\n          variableKey,\n          userId,\n          customVariables,\n          variationTargetingVariables,\n          userStorageData,\n          metaData\n        })\n      ) {\n        areParamsValid = true;\n      }\n    }\n\n    if (areParamsValid === false) {\n      vwoInstance.logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_BAD_PARAMETERS, {\n          file,\n          api: ApiEnum.GetFeatureVariableValue\n        })\n      );\n      return null;\n    }\n\n    // Get the cached configuration\n    let config = vwoInstance.SettingsFileManager.getConfig();\n    let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n    config.apiName = api;\n\n    // If no settings are found, simply return no variation\n    if (!settingsFile) {\n      return null;\n    }\n\n    let campaign = CampaignUtil.getCampaign(settingsFile, campaignKey);\n\n    if (!campaign || campaign.status !== Constants.STATUS_RUNNING) {\n      vwoInstance.logger.log(\n        LogLevelEnum.WARN,\n        LogMessageUtil.build(LogMessageEnum.WARNING_MESSAGES.CAMPAIGN_NOT_RUNNING, {\n          file,\n          campaignKey,\n          api\n        })\n      );\n\n      return null;\n    }\n\n    if (CampaignUtil.isAbCampaign(campaign)) {\n      // API not allowed for full-stack AB campaigns\n      vwoInstance.logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_NOT_APPLICABLE, {\n          file,\n          campaignKey,\n          campaignType: campaign.type,\n          userId,\n          api\n        })\n      );\n\n      return null;\n    }\n\n    const result = DecisionUtil.getVariation(\n      config,\n      settingsFile,\n      campaign,\n      campaignKey,\n      userId,\n      customVariables,\n      variationTargetingVariables,\n      userStorageData,\n      metaData,\n      false,\n      false,\n      undefined,\n      api\n    );\n\n    if (DataTypeUtil.isPromise(result)) {\n      return result.then(function(data) {\n        return _validateAndReturnFeaureVariable(vwoInstance, campaignKey, variableKey, userId, campaign, data);\n      });\n    }\n\n    return _validateAndReturnFeaureVariable(vwoInstance, campaignKey, variableKey, userId, campaign, result);\n  } catch (err) {\n    vwoInstance.logger.log(LogLevelEnum.ERROR, err.message);\n\n    return null;\n  }\n}\n\nfunction _validateAndReturnFeaureVariable(vwoInstance, campaignKey, variableKey, userId, campaign, result) {\n  let variable;\n  var { variation, variationName } = result;\n\n  if (!variationName) {\n    vwoInstance.logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.FEATURE_STATUS, {\n        file,\n        campaignKey,\n        userId,\n        status: 'disabled'\n      })\n    );\n\n    return null;\n  }\n\n  if (CampaignUtil.isFeatureRolloutCampaign(campaign)) {\n    variable = FeatureUtil.getVariableForFeature(campaign, variableKey);\n  } else if (CampaignUtil.isFeatureTestCampaign(campaign)) {\n    variable = FeatureUtil.getVariableValueForVariation(campaign, variation, variableKey);\n\n    if (ObjectUtil.areObjectKeys(variable) && variation.isFeatureEnabled) {\n      vwoInstance.logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.FEATURE_VARIABLE_VALUE, {\n          file,\n          variableKey,\n          campaignKey: campaign.key,\n          variableValue: variable.value,\n          userId\n        })\n      );\n    } else if (ObjectUtil.areObjectKeys(variable) && !variation.isFeatureEnabled) {\n      vwoInstance.logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.FEATURE_VARIABLE_DEFAULT_VALUE, {\n          file,\n          variableKey,\n          variationName\n        })\n      );\n    }\n  }\n\n  if (!ObjectUtil.areObjectKeys(variable)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.VARIABLE_NOT_FOUND, {\n        file,\n        variableKey,\n        userId\n      })\n    );\n\n    return null;\n  }\n\n  let variableValue = variable.value;\n  let typeCastedValue = FeatureUtil.getTypeCastVariableValue(variableValue, variable.type);\n\n  return typeCastedValue;\n}\n\nmodule.exports = getFeatureVariableValue;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst CampaignUtil = require('./CampaignUtil');\nconst DataTypeUtil = require('./DataTypeUtil');\nconst FeatureVariableTypeEnum = require('../enums/FeatureVariableTypeEnum');\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\n\nconst file = FileNameEnum.FeatureUtil;\n\nlet FeatureUtil = {\n  getVariableForFeature: (campaign, variableKey) => {\n    let variableData = {};\n\n    if (CampaignUtil.isFeatureRolloutCampaign(campaign)) {\n      let variables = campaign.variables || [];\n\n      for (let i = 0; i < variables.length; i++) {\n        if (variables[i].key === variableKey) {\n          variableData = variables[i];\n\n          break;\n        }\n      }\n\n      return variableData;\n    }\n\n    return variableData;\n  },\n  getVariableValueForVariation: (campaign, variation, variableKey) => {\n    let variationVariable = {};\n\n    if (CampaignUtil.isFeatureTestCampaign(campaign)) {\n      if (!variation || !variation || !variation.variables) {\n        return variationVariable;\n      }\n\n      if (!variation.isFeatureEnabled) {\n        variation = CampaignUtil.getControlForCampaign(campaign);\n      }\n\n      for (let i = 0; i < variation.variables.length; i++) {\n        let variable = variation.variables[i];\n\n        if (variableKey === variable.key) {\n          variationVariable = variable;\n          break;\n        }\n      }\n    }\n\n    return variationVariable;\n  },\n  getTypeCastVariableValue: (variableValue, variableType) => {\n    let typeCastedValue;\n\n    switch (variableType) {\n      case FeatureVariableTypeEnum.INTEGER:\n        typeCastedValue = parseInt(variableValue, 10);\n        if (!DataTypeUtil.isNumber(typeCastedValue) || isNaN(typeCastedValue)) {\n          logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.UNABLE_TO_CAST_VALUE, {\n              file,\n              variableValue,\n              variableType\n            })\n          );\n          typeCastedValue = null;\n        }\n        break;\n\n      case FeatureVariableTypeEnum.DOUBLE:\n        typeCastedValue = parseFloat(variableValue);\n        if (!DataTypeUtil.isNumber(typeCastedValue) || isNaN(typeCastedValue)) {\n          logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.UNABLE_TO_CAST_VALUE, {\n              file,\n              variableValue,\n              variableType\n            })\n          );\n          typeCastedValue = null;\n        }\n        break;\n\n      case FeatureVariableTypeEnum.BOOLEAN:\n        if (!DataTypeUtil.isBoolean(variableValue)) {\n          logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.UNABLE_TO_CAST_VALUE, {\n              file,\n              variableValue,\n              variableType\n            })\n          );\n          typeCastedValue = null;\n        } else {\n          typeCastedValue = variableValue;\n        }\n        break;\n\n      case FeatureVariableTypeEnum.JSON:\n        if (!DataTypeUtil.isObject(variableValue)) {\n          logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.UNABLE_TO_CAST_VALUE, {\n              file,\n              variableValue,\n              variableType\n            })\n          );\n          typeCastedValue = null;\n        } else {\n          typeCastedValue = variableValue;\n        }\n        break;\n\n      default:\n        typeCastedValue = variableValue;\n        break;\n    }\n\n    return typeCastedValue;\n  }\n};\n\nmodule.exports = FeatureUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst FeatureVariableTypeEnum = {\n  BOOLEAN: 'boolean',\n  DOUBLE: 'double',\n  INTEGER: 'integer',\n  STRING: 'string',\n  JSON: 'json'\n};\n\nmodule.exports = FeatureVariableTypeEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst ApiEnum = require('../enums/ApiEnum');\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst EventEnum = require('../enums/EventEnum');\nconst ValidateUtil = require('../utils/ValidateUtil');\nconst ImpressionUtil = require('../utils/ImpressionUtil');\nconst DataTypeUtil = require('../utils/DataTypeUtil');\n\nlet BatchEventsDispatcher;\n\nif (typeof process.env !== 'undefined') {\n  BatchEventsDispatcher = require('../utils/BatchEventsDispatcher');\n}\n\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.Push;\n\n/**\n * This API method: Pushes the key-value tag pair for a particular user\n *\n * 1. validates the arguments being passed\n * 2. Sends a call to VWO push api\n *\n * @param {Object} vwoInstance               VWO instance which has logger, settingsFile etc.\n * @param {String} tagKey                    tag key\n * @param {String} tagValue                  tag Value\n * @param {String} userId                    ID assigned to a user\n *\n * @return {Boolean}                         true if request is pushed to eventQueue, false if params are invalid or settings file is unavailable\n */\nfunction push(vwoInstance, tagKey, tagValue, userId, customDimensionMap, { responseCallback } = {}) {\n  const api = ApiEnum.PUSH;\n\n  if (\n    !ValidateUtil.areValidParamsForAPIMethod({\n      method: ApiEnum.PUSH,\n      tagKey,\n      tagValue,\n      userId,\n      customDimensionMap,\n      responseCallback\n    })\n  ) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.PUSH_INVALID_PARAMS, {\n        file,\n        method: api\n      })\n    );\n    return false;\n  }\n\n  if (tagKey.length > 255) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.TAG_KEY_LENGTH_EXCEEDED, {\n        file,\n        tagKey,\n        userId\n      })\n    );\n    return false;\n  }\n\n  if (tagValue.length > 255) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.TAG_VALUE_LENGTH_EXCEEDED, {\n        file,\n        tagKey,\n        userId,\n        tagValue\n      })\n    );\n    return false;\n  }\n\n  if (tagKey === ' ' && tagValue === ' ' && (!customDimensionMap || Object.keys(customDimensionMap).length === 0)) {\n    vwoInstance.logger.log(\n      LogLevelEnum.ERROR,\n      LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.PUSH_INVALID_PARAMS, {\n        file,\n        method: api\n      })\n    );\n    return false;\n  }\n\n  if (tagKey !== ' ' && tagValue !== ' ') {\n    customDimensionMap[tagKey] = tagValue;\n  }\n\n  // Get the cached configuration\n  let config = vwoInstance.SettingsFileManager.getConfig();\n  let settingsFile = vwoInstance.SettingsFileManager.getSettingsFile(api);\n\n  // If no settings are found, simply false\n  if (!settingsFile) {\n    return false;\n  }\n\n  let result = {};\n  if (config.batchEvents) {\n    Object.keys(customDimensionMap).forEach(key => {\n      const tagValue = DataTypeUtil.isString(customDimensionMap[key])\n        ? customDimensionMap[key]\n        : JSON.stringify(customDimensionMap[key]);\n      let properties = ImpressionUtil.buildBatchEventForPushing(settingsFile, key, tagValue, userId);\n      vwoInstance.batchEventsQueue.enqueue(properties);\n\n      result[key] = true;\n    });\n  } else if (settingsFile.isEventArchEnabled) {\n    let properties = ImpressionUtil.getEventsBaseProperties(settingsFile, EventEnum.VWO_SYNC_VISITOR_PROP);\n    let payload = ImpressionUtil.getPushPayloadData(\n      settingsFile,\n      userId,\n      EventEnum.VWO_SYNC_VISITOR_PROP,\n      customDimensionMap\n    );\n    vwoInstance.eventQueue.process(config, properties, vwoInstance, { payload, responseCallback });\n\n    result.success = true;\n  } else {\n    const events = [];\n    const customDimensionKeys = Object.keys(customDimensionMap);\n\n    customDimensionKeys.forEach(key => {\n      let properties;\n      const tagValue = DataTypeUtil.isString(customDimensionMap[key])\n        ? customDimensionMap[key]\n        : JSON.stringify(customDimensionMap[key]);\n\n      if (typeof process.env === 'undefined') {\n        properties = ImpressionUtil.buildEventForPushing(settingsFile, key, tagValue, userId);\n        vwoInstance.eventQueue.process(config, properties, vwoInstance, { responseCallback });\n      } else if (customDimensionKeys.length === 1) {\n        properties = ImpressionUtil.buildEventForPushing(settingsFile, key, tagValue, userId);\n      } else {\n        properties = ImpressionUtil.buildBatchEventForPushing(settingsFile, key, tagValue, userId);\n      }\n\n      events.push(properties);\n      result[key] = true;\n    });\n\n    if (typeof process.env !== 'undefined') {\n      if (customDimensionKeys.length === 1) {\n        vwoInstance.eventQueue.process(config, events[0], vwoInstance, { responseCallback });\n      } else {\n        if (!config.isDevelopmentMode) {\n          BatchEventsDispatcher.dispatch(\n            {\n              ev: events\n            },\n            responseCallback,\n            Object.assign(\n              {},\n              {\n                a: vwoInstance.SettingsFileManager.getSettingsFile().accountId\n              },\n              vwoInstance.usageStats.getUsageStats()\n            ),\n            vwoInstance.SettingsFileManager.getSettingsFile().sdkKey\n          );\n        }\n      }\n    }\n  }\n\n  if (config.isDevelopmentMode) {\n    return Object.assign({}, result, { isDevelopmentMode: config.isDevelopmentMode });\n  }\n\n  return result;\n}\n\nmodule.exports = push;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst DataTypeUtil = require('../utils/DataTypeUtil');\nconst EventDispatcher = require('../utils/EventDispatcherUtil');\n\nconst logging = require('./logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst HeadersEnum = require('../enums/HeadersEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\n\nconst file = FileNameEnum.EventQueue;\n\nclass EventQueue {\n  constructor() {\n    this.running = false;\n    this.queue = [];\n  }\n\n  process(config, properties, vwoInstance, { payload, responseCallback } = {}) {\n    let customHeaders = {};\n\n    if (properties && properties.visitor_ua) {\n      customHeaders[HeadersEnum.USER_AGENT] = encodeURIComponent(properties.visitor_ua);\n      properties.visitor_ua = customHeaders[HeadersEnum.USER_AGENT];\n    }\n    if (properties && properties.visitor_ip) {\n      customHeaders[HeadersEnum.IP] = encodeURIComponent(properties.visitor_ip);\n      properties.visitor_ip = customHeaders[HeadersEnum.IP];\n    }\n\n    if (config && config.isDevelopmentMode) {\n      logger.log(\n        LogLevelEnum.DEBUG,\n        LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.CONFIG_DEVELOPMENT_MODE_STATUS, {\n          file\n        })\n      );\n      return;\n    }\n\n    this.enqueue(properties, vwoInstance, { payload, responseCallback }, customHeaders);\n  }\n\n  enqueue(properties, vwoInstance, { payload, responseCallback }, customHeaders = {}) {\n    this.queue.push({\n      eventName: properties.eventName,\n      properties: properties,\n      callback: () => {\n        if (payload) {\n          EventDispatcher.dispatchPostCall(properties, payload, { responseCallback }, customHeaders);\n        } else {\n          EventDispatcher.dispatchGetCall(properties, { responseCallback }, customHeaders);\n        }\n      }\n    });\n\n    logger.log(\n      LogLevelEnum.INFO,\n      LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.EVENT_QUEUE, {\n        file,\n        queueType: 'normal',\n        event: 'VWO_MASKED_PAYLOAD'\n      })\n    );\n\n    vwoInstance.eventQueue.executeNext(properties);\n\n    if (!this.running) {\n      // if nothing is running, then start the engines!\n      this.executeNext(properties);\n    }\n\n    return this;\n  }\n\n  executeNext(properties) {\n    this.running = false;\n\n    // get the first element off the queue\n    if (this.queue && this.queue.length) {\n      let event = this.queue.shift();\n\n      if (event) {\n        this.running = true;\n        if (event.callback && DataTypeUtil.isFunction(event.callback)) {\n          event.callback(properties);\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = EventQueue;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\nconst FunctionUtil = require('./FunctionUtil');\nconst EventEnum = require('../enums/EventEnum');\nconst excludedProperties = ['url'];\n\nconst file = FileNameEnum.EventDispatcherUtil;\n\nlet EventDispatcher = {\n  dispatchGetCall: function(properties, { responseCallback }, customHeaders = {}) {\n    let parsedUrl;\n    let queryParams = '?';\n\n    queryParams += FunctionUtil.convertObjectKeysToString(properties, excludedProperties);\n\n    try {\n      // Require files only if required in respective Engine i.e. Node / Browser\n      if (typeof process.env === 'undefined') {\n        require('./HttpXMLUtil').sendCall(\n          properties,\n          queryParams,\n          { successCallback: responseCallback },\n          customHeaders\n        );\n      } else {\n        const url = require('url');\n\n        parsedUrl = url.parse(properties.url);\n\n        require('./HttpHandlerUtil').sendGetCall(\n          parsedUrl,\n          queryParams,\n          null,\n          (error, response) => {\n            this.handleGetResponse(properties, error, response);\n            if (responseCallback) {\n              responseCallback(error, response);\n            }\n          },\n          customHeaders\n        );\n      }\n    } catch (err) {\n      let endPoint = properties.url;\n\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.IMPRESSION_FAILED, {\n          file: FileNameEnum.EventDispatcher,\n          endPoint,\n          err\n        })\n      );\n    }\n\n    return false;\n  },\n\n  handleGetResponse: function(properties, error, response) {\n    if (error) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.IMPRESSION_FAILED, {\n          file,\n          endPoint: response.endPoint,\n          err: error\n        })\n      );\n      return false;\n    } else {\n      const baseParams = {\n        file,\n        endPoint: response.endPoint,\n        accountId: properties && properties.account_id\n      };\n      let params = {};\n      if (baseParams.endPoint.includes('push')) {\n        let customVariables = JSON.parse(properties.tags).u;\n        params = Object.assign({}, baseParams, { customVariables: customVariables });\n        params.mainKeys = `customDimension:${JSON.stringify(params.customVariables)}`;\n      } else {\n        params = Object.assign({}, baseParams, {\n          campaignId: properties && properties.experiment_id,\n          variationId: properties && properties.combination\n        });\n        params.mainKeys = `campaignId:${params.campaignId} and variationId:${params.variationId}`;\n      }\n      logger.log(LogLevelEnum.INFO, LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.IMPRESSION_SUCCESS, params));\n      return true;\n    }\n  },\n\n  dispatchPostCall: function(properties, payload, { responseCallback }, customHeaders = {}) {\n    let parsedUrl;\n    let queryParams = '?';\n\n    queryParams += FunctionUtil.convertObjectKeysToString(properties, excludedProperties);\n\n    try {\n      // Require files only if required in respective Engine i.e. Node / Browser\n\n      if (typeof process.env === 'undefined') {\n        if (typeof XMLHttpRequest === 'undefined') {\n          return require('./FetchUtil')\n            .send({\n              method: 'POST',\n              url: `${properties.url}${queryParams}`,\n              payload,\n              customHeaders\n            })\n            .then(() => {\n              this.handlePostResponse(properties, payload);\n              if (responseCallback) {\n                responseCallback(null, { status: 'success' });\n              }\n            })\n            .catch(error => {\n              this.handlePostResponse(properties, payload, error);\n              responseCallback(error, { status: 'failure' });\n            });\n        }\n\n        return require('./XhrUtil')\n          .send({\n            method: 'POST',\n            url: `${properties.url}${queryParams}`,\n            payload,\n            customHeaders,\n            logger\n          })\n          .then(() => {\n            this.handlePostResponse(properties, payload);\n            if (responseCallback) {\n              responseCallback(null, { status: 'success' });\n            }\n          })\n          .catch(error => {\n            this.handlePostResponse(properties, payload, error);\n            responseCallback(error, { status: 'failure' });\n          });\n      } else {\n        const url = require('url');\n\n        parsedUrl = url.parse(properties.url);\n\n        return new Promise(resolve => {\n          require('./HttpHandlerUtil').sendPostCall(\n            parsedUrl,\n            payload,\n            queryParams,\n            null,\n            error => {\n              const result = this.handlePostResponse(properties, payload, error);\n              if (responseCallback) {\n                responseCallback(error, { status: 'success' });\n              }\n              resolve(result);\n            },\n            customHeaders\n          );\n        });\n      }\n    } catch (err) {\n      let endPoint = properties.url;\n\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.IMPRESSION_FAILED, {\n          file: FileNameEnum.EventDispatcherUtil,\n          endPoint,\n          err\n        })\n      );\n    }\n\n    return Promise.resolve(false);\n  },\n\n  handlePostResponse: function(properties, payload, error) {\n    let endPoint = properties.url;\n\n    if (error) {\n      logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.IMPRESSION_FAILED, {\n          file,\n          endPoint: endPoint,\n          err: error\n        })\n      );\n      return false;\n    } else {\n      let event = `${properties.en} event`;\n      if (properties.en === EventEnum.VWO_SYNC_VISITOR_PROP) {\n        delete payload.d.visitor.props.vwo_fs_environment;\n        event = `visitor property:${JSON.stringify(payload.d.visitor.props)}`;\n      }\n\n      logger.log(\n        LogLevelEnum.INFO,\n        LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.IMPRESSION_SUCCESS_FOR_EVENT_ARCH, {\n          file,\n          endPoint,\n          accountId: properties.a,\n          event: event\n        })\n      );\n\n      return true;\n    }\n  }\n};\n\nmodule.exports = EventDispatcher;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst logging = require('../services/logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\nconst logger = logging.getLogger();\nconst file = FileNameEnum.HttpXMLUtil;\nconst { getCurrentTime } = require('./FunctionUtil');\n\nconst noop = () => {};\n\nconst printLog = properties => {\n  const baseParams = {\n    file,\n    endPoint: properties.url,\n    accountId: properties && properties.account_id\n  };\n  let params = {};\n  if (baseParams.endPoint.includes('push')) {\n    let customVariables = JSON.parse(properties.tags).u;\n    params = Object.assign({}, baseParams, { customVariables: customVariables });\n    params.mainKeys = `customDimension:${JSON.stringify(params.customVariables)}`;\n  } else {\n    params = Object.assign({}, baseParams, {\n      campaignId: properties && properties.experiment_id,\n      variationId: properties && properties.combination\n    });\n    params.mainKeys = `campaignId:${params.campaignId} and variationId:${params.variationId}`;\n  }\n  logger.log(LogLevelEnum.INFO, LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.IMPRESSION_SUCCESS, params));\n};\n\nconst HttpXMLUtil = {\n  sendCall: function(properties, queryParams, options = {}, customHeaders = {}) {\n    let endPoint = `${properties.url}${queryParams}`;\n\n    let { successCallback, errorCallback } = options;\n\n    errorCallback = errorCallback || successCallback;\n\n    let isCallbackCalled = false;\n    if (typeof XMLHttpRequest === 'undefined') {\n      const maxRetries = 5; // Number of retry attempts\n      const initialDelay = 1000; // Initial retry delay in ms (1 second)\n      let attempt = 0;\n\n      const makeRequest = () => {\n        let delay = initialDelay * Math.pow(2, attempt); // Exponential backoff (1s, 2s, 4s, 8s, 16s)\n\n        fetch(endPoint, { method: 'GET', headers: customHeaders })\n          .then(() => {\n            if (isCallbackCalled) {\n              return;\n            }\n            isCallbackCalled = true;\n            successCallback(null, { status: 'success' });\n          })\n          .catch(_err => {\n            if (isCallbackCalled) {\n              return;\n            }\n\n            console.error(\n              `VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed. Attempt ${attempt + 1}/${maxRetries}`\n            );\n\n            if (attempt < maxRetries) {\n              console.warn(`VWO-SDK - [WARNING]: ${getCurrentTime()} Retrying request in ${delay/1000} seconds (Attempt ${attempt + 1}/${maxRetries})`);\n\n              setTimeout(() => {\n                attempt++;\n                makeRequest();\n              }, delay);\n            } else {\n              isCallbackCalled = true;\n              errorCallback(null, { status: 'success' });\n              printLog(properties);\n            }\n          });\n      };\n\n      makeRequest(); // Initial request\n      return;\n    }\n    this.handleGetCall(\n      properties,\n      queryParams,\n      successCallback,\n      errorCallback,\n      endPoint,\n      isCallbackCalled,\n      customHeaders\n    );\n  },\n\n  handleGetCall: function(\n    properties,\n    queryParams,\n    successCallback,\n    errorCallback,\n    endPoint,\n    isCallbackCalled,\n    customHeaders = {}\n  ) {\n    successCallback = successCallback || noop;\n    errorCallback = errorCallback || noop;\n\n    const maxRetries = 5;\n    const initialDelay = 1000;\n    let attempt = 0;\n\n    const makeXHRRequest = () => {\n      const xhr = new XMLHttpRequest();\n      const delay = initialDelay * Math.pow(2, attempt); // Exponential backoff\n\n      xhr.open('GET', endPoint, true);\n\n      // Set custom headers using setRequestHeader\n      for (var headerName in customHeaders) {\n        if (customHeaders.hasOwnProperty(headerName)) {\n          xhr.setRequestHeader(headerName, customHeaders[headerName]);\n        }\n      }\n\n      xhr.onload = function() {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          const response = xhr.responseText;\n          successCallback(response);\n          printLog(properties);\n        } else if (attempt < maxRetries) {\n          console.warn(\n            `VWO-SDK - [WARNING]: ${getCurrentTime()} Request failed with status ${xhr.status} (${\n              xhr.statusText\n            }). Retrying request in ${delay / 1000} seconds (attempt ${attempt + 1} of ${maxRetries})`\n          );\n          setTimeout(() => {\n            attempt++;\n            makeXHRRequest();\n          }, delay);\n        } else {\n          console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed after ${maxRetries} attempts`);\n          errorCallback(xhr.statusText);\n          printLog(properties);\n        }\n      };\n\n      xhr.onerror = function() {\n        if (attempt < maxRetries) {\n          console.warn(\n            `VWO-SDK - [WARNING]: ${getCurrentTime()} Request failed with status ${xhr.status} (${\n              xhr.statusText\n            }). Retrying in ${delay / 1000} seconds (attempt ${attempt + 1} of ${maxRetries})`\n          );\n          setTimeout(() => {\n            attempt++;\n            makeXHRRequest();\n          }, delay);\n        } else {\n          console.error(`VWO-SDK - [ERROR]: ${getCurrentTime()} Request failed after ${maxRetries} attempts`);\n          errorCallback(xhr.statusText);\n          printLog(properties);\n        }\n      };\n\n      xhr.send();\n    };\n\n    makeXHRRequest(); // Initial request\n  }\n};\nmodule.exports = HttpXMLUtil;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst HeadersEnum = {\n  USER_AGENT: 'X-Device-User-Agent',\n  IP: 'VWO-X-Forwarded-For'\n};\n\nmodule.exports = HeadersEnum;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst CampaignUtil = require('../utils/CampaignUtil');\nconst FunctionUtil = require('../utils/FunctionUtil');\nconst SettingsFileUtil = require('../utils/SettingsFileUtil');\n\nconst logging = require('./logging');\nconst FileNameEnum = require('../enums/FileNameEnum');\nconst validateSettingsFile = require('../schemas/SettingsFileSchema');\nconst { isObject } = require('../utils/DataTypeUtil');\nconst { LogLevelEnum, LogMessageEnum, LogMessageUtil } = logging;\n\nconst file = FileNameEnum.SettingsFileManager;\n\nclass SettingsFileManager {\n  // PRIVATE METHODS\n\n  constructor(config) {\n    if (config) {\n      if (\n        (config.settingsFile && isObject(config.settingsFile.campaigns)) ||\n        (config.settingsFile && !config.settingsFile.campaigns)\n      ) {\n        config.settingsFile.campaigns = [];\n      }\n\n      this._configObj = config;\n      this._clonedSettingsFile = config.settingsFile ? FunctionUtil.cloneObject(config.settingsFile) : null;\n    } else {\n      this._configObj = null;\n      this._clonedSettingsFile = null;\n    }\n  }\n\n  _setVariationBucketing(campaign) {\n    CampaignUtil.setVariationAllocation(campaign);\n  }\n\n  // PUBLIC METHODS\n\n  isSettingsFileValid() {\n    if (!this._configObj || !this._clonedSettingsFile) {\n      return false;\n    }\n    let isValidSettingsFile = validateSettingsFile(this._clonedSettingsFile);\n\n    if (!isValidSettingsFile) {\n      this._configObj.logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.SETTINGS_FILE_CORRUPTED, {\n          file\n        })\n      );\n\n      return false;\n    }\n\n    return true;\n  }\n\n  checkAndPoll() {\n    if (!this._configObj.pollingInterval || !this._configObj.sdkKey) {\n      return;\n    }\n\n    let lastSettingsFile = JSON.stringify(this._clonedSettingsFile);\n    setInterval(() => {\n      SettingsFileUtil.get(this._clonedSettingsFile.accountId, this._configObj.sdkKey)\n        .then(latestSettingsFile => {\n          this._configObj.logger.log(\n            LogLevelEnum.INFO,\n            LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.POLLING_SUCCESS, {\n              file,\n              accountId: this._clonedSettingsFile.accountId\n            })\n          );\n          const stringifiedLatestSettingsFile = JSON.stringify(latestSettingsFile);\n\n          if (stringifiedLatestSettingsFile !== lastSettingsFile) {\n            lastSettingsFile = stringifiedLatestSettingsFile;\n\n            this.updateSettingsFile(latestSettingsFile);\n\n            this._configObj.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.POLLING_SETTINGS_FILE_UPDATED, {\n                file,\n                accountId: this._clonedSettingsFile.accountId\n              })\n            );\n          } else {\n            this._configObj.logger.log(\n              LogLevelEnum.INFO,\n              LogMessageUtil.build(LogMessageEnum.INFO_MESSAGES.POLLING_SETTINGS_FILE_NOT_UPDATED, {\n                file,\n                accountId: this._clonedSettingsFile.accountId\n              })\n            );\n          }\n        })\n        .catch(_e => {\n          this._configObj.logger.log(\n            LogLevelEnum.ERROR,\n            LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.POLLING_FAILED, {\n              file,\n              accountId: this._clonedSettingsFile.accountId\n            })\n          );\n        });\n    }, this._configObj.pollingInterval);\n\n    this._configObj.logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.POLLING_SETTINGS_FILE_REGISTERED, {\n        file,\n        pollingInterval: this._configObj.pollingInterval\n      })\n    );\n  }\n  processSettingsFile() {\n    let settingsFile = this._clonedSettingsFile;\n\n    for (let i = 0; i < settingsFile.campaigns.length; i++) {\n      let campaign = settingsFile.campaigns[i];\n\n      this._setVariationBucketing(campaign);\n    }\n\n    this._configObj.logger.log(\n      LogLevelEnum.DEBUG,\n      LogMessageUtil.build(LogMessageEnum.DEBUG_MESSAGES.SETTINGS_FILE_PROCESSED, {\n        file,\n        accountId: this._clonedSettingsFile.accountId\n      })\n    );\n\n    return settingsFile;\n  }\n\n  /**\n   * Fetch latest settings-file and update so that vwoClientInstance could use latest settings\n   * Helpful especially when using webhooks\n   *\n   * @param {Number} accountId\n   * @param {String} sdkKey\n   *\n   * @return {Promise}\n   */\n  getAndUpdateSettingsFile(accountId = this._clonedSettingsFile.accountId, sdkKey = this._clonedSettingsFile.sdkKey) {\n    return new Promise((resolve, _reject) => {\n      SettingsFileUtil.get(accountId, sdkKey, null, { isViaWebhook: true })\n        .then(settings => {\n          this.updateSettingsFile(settings);\n          resolve(settings);\n        })\n        .catch(_err => {});\n    });\n  }\n\n  /**\n   * Update the settings-file on the instance so that latest settings could be used from next hit onwards\n   * @param {Object} settings\n   */\n  updateSettingsFile(settings) {\n    this._clonedSettingsFile = FunctionUtil.cloneObject(settings);\n    this.processSettingsFile();\n  }\n\n  getConfig() {\n    return this._configObj;\n  }\n\n  getSettingsFile(api) {\n    if (!this._clonedSettingsFile) {\n      this._configObj.logger.log(\n        LogLevelEnum.ERROR,\n        LogMessageUtil.build(LogMessageEnum.ERROR_MESSAGES.API_HAS_CORRUPTED_SETTINGS_FILE, {\n          file,\n          api\n        })\n      );\n    }\n    return this._clonedSettingsFile;\n  }\n}\nmodule.exports = SettingsFileManager;\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlet { validate, number, string, boolean, array, object, optional, union, type, record } = require('superstruct');\n\nconst campaignGoalSchema = type({\n  id: union([number(), string()]),\n  identifier: string(),\n  type: string(),\n  revenueProp: optional(string()),\n  mca: optional(union([number(), string()]))\n});\n\nconst variableObjectSchema = type({\n  id: union([number(), string()]),\n  type: string(),\n  key: string(),\n  value: union([number(), string(), boolean()])\n});\n\nconst campaignVariationSchema = type({\n  id: union([number(), string()]),\n  name: string(),\n  weight: union([number(), string()]),\n  changes: optional(object()),\n  segments: optional(object()),\n  variables: optional(union([object(), array(variableObjectSchema)])),\n  isFeatureEnabled: optional(boolean()),\n  startVariationAllocation: optional(number()),\n  endVariationAllocation: optional(number())\n});\n\nconst campaignObjectSchema = type({\n  id: union([number(), string()]),\n  type: string(),\n  key: string(),\n  status: string(),\n  name: optional(string()),\n  isBucketingSeedEnabled: optional(boolean()),\n  percentTraffic: number(),\n  goals: union([object(), array(campaignGoalSchema)]),\n  variations: union([object(), array(campaignVariationSchema)]),\n  variables: optional(union([object(), array(variableObjectSchema)])),\n  segments: object(),\n  isForcedVariationEnabled: optional(boolean()),\n  isUserListEnabled: optional(boolean()),\n  isMAB: optional(boolean())\n});\n\nconst groupSchema = type({\n  et: optional(string()),\n  p: optional(array(number())),\n  wt: optional(record(string(), number())),\n  groupName: string(),\n  campaigns: array(number())\n});\n\nconst settingsFileSchema = type({\n  sdkKey: optional(string()),\n  version: union([number(), string()]),\n  accountId: union([number(), string()]),\n  campaigns: array(campaignObjectSchema),\n  campaignGroups: optional(record(string(), number())),\n  isEventArchEnabled: optional(boolean()),\n  collectionPrefix: optional(string()),\n  groups: optional(union([object(), record(string(), groupSchema)]))\n});\n\nconst validateSettingsFile = function(settings) {\n  const [error] = validate(settings, settingsFileSchema);\n  return !error;\n};\n\nmodule.exports = validateSettingsFile;\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\n/**\n * Convert a validation result to an iterable of failures.\n */\nfunction* toFailures(result, context) {\n  if (result === true) ; else if (result === false) {\n    yield context.fail();\n  } else {\n    yield* result;\n  }\n}\n/**\n * Shifts (removes and returns) the first value from the `input` iterator.\n * Like `Array.prototype.shift()` but for an `Iterator`.\n */\n\nfunction iteratorShift(input) {\n  const {\n    done,\n    value\n  } = input.next();\n  return done ? undefined : value;\n}\n\n/**\n * `Struct` objects encapsulate the schema for a specific data type (with\n * optional coercion). You can then use the `assert`, `is` or `validate` helpers\n * to validate unknown data against a struct.\n */\n\nclass Struct {\n  constructor(props) {\n    const {\n      type,\n      schema,\n      coercer = value => value,\n      validator = () => [],\n      refiner = () => []\n    } = props;\n    this.type = type;\n    this.schema = schema;\n    this.coercer = coercer;\n    this.validator = validator;\n    this.refiner = refiner;\n  }\n\n}\n/**\n * `StructError` objects are thrown (or returned) by Superstruct when its\n * validation fails. The error represents the first error encountered during\n * validation. But they also have an `error.failures` property that holds\n * information for all of the failures encountered.\n */\n\nclass StructError extends TypeError {\n  constructor(failure, moreFailures) {\n    const {\n      path,\n      value,\n      type,\n      branch\n    } = failure,\n          rest = _objectWithoutProperties(failure, [\"path\", \"value\", \"type\", \"branch\"]);\n\n    const message = `Expected a value of type \\`${type}\\`${path.length ? ` for \\`${path.join('.')}\\`` : ''} but received \\`${JSON.stringify(value)}\\`.`;\n    let failuresResult;\n\n    function failures() {\n      if (!failuresResult) {\n        failuresResult = [failure, ...moreFailures];\n      }\n\n      return failuresResult;\n    }\n\n    super(message);\n    this.value = value;\n    Object.assign(this, rest);\n    this.type = type;\n    this.path = path;\n    this.branch = branch;\n    this.failures = failures;\n    this.stack = new Error().stack;\n    this.__proto__ = StructError.prototype;\n  }\n\n}\n/**\n * Assert that a value passes a `Struct`, throwing if it doesn't.\n */\n\nfunction assert(value, struct) {\n  const result = validate(value, struct);\n\n  if (result[0]) {\n    throw result[0];\n  }\n}\n/**\n * Coerce a value with the coercion logic of `Struct` and validate it.\n */\n\nfunction coerce(value, struct) {\n  const ret = struct.coercer(value);\n  assert(ret, struct);\n  return ret;\n}\n/**\n * Check if a value passes a `Struct`.\n */\n\nfunction is(value, struct) {\n  const result = validate(value, struct);\n  return !result[0];\n}\n/**\n * Validate a value against a `Struct`, returning an error if invalid.\n */\n\nfunction validate(value, struct, coercing = false) {\n  if (coercing) {\n    value = struct.coercer(value);\n  }\n\n  const failures = check(value, struct);\n  const failure = iteratorShift(failures);\n\n  if (failure) {\n    const error = new StructError(failure, failures);\n    return [error, undefined];\n  } else {\n    return [undefined, value];\n  }\n}\n/**\n * Check a value against a `Struct`, returning an iterable of failures.\n */\n\nfunction* check(value, struct, path = [], branch = []) {\n  const {\n    type\n  } = struct;\n  const ctx = {\n    value,\n    type,\n    branch,\n    path,\n\n    fail(props = {}) {\n      return _objectSpread2({\n        value,\n        type,\n        path,\n        branch: [...branch, value]\n      }, props);\n    },\n\n    check(v, s, parent, key) {\n      const p = parent !== undefined ? [...path, key] : path;\n      const b = parent !== undefined ? [...branch, parent] : branch;\n      return check(v, s, p, b);\n    }\n\n  };\n  const failures = toFailures(struct.validator(value, ctx), ctx);\n  const failure = iteratorShift(failures);\n\n  if (failure) {\n    yield failure;\n    yield* failures;\n  } else {\n    yield* toFailures(struct.refiner(value, ctx), ctx);\n  }\n}\n\n/**\n * Augment a `Struct` to add an additional coercion step to its input.\n */\n\nfunction coercion(struct, coercer) {\n  const fn = struct.coercer;\n  return new Struct(_objectSpread2(_objectSpread2({}, struct), {}, {\n    coercer: value => {\n      return fn(coercer(value));\n    }\n  }));\n}\n/**\n * Augment a struct to coerce a default value for missing values.\n *\n * Note: You must use `coerce(value, Struct)` on the value before validating it\n * to have the value defaulted!\n */\n\nfunction defaulted(S, fallback, strict) {\n  return coercion(S, x => {\n    const f = typeof fallback === 'function' ? fallback() : fallback;\n\n    if (x === undefined) {\n      return f;\n    }\n\n    if (strict !== true && isPlainObject(x) && isPlainObject(f)) {\n      const ret = _objectSpread2({}, x);\n\n      let changed = false;\n\n      for (const key in f) {\n        if (ret[key] === undefined) {\n          ret[key] = f[key];\n          changed = true;\n        }\n      }\n\n      if (changed) {\n        return ret;\n      }\n    }\n\n    return x;\n  });\n}\n/**\n * Coerce a value to mask its properties to only that defined in the struct.\n */\n\nfunction masked(S) {\n  return coercion(S, x => {\n    if (!isPlainObject(x)) {\n      return x;\n    }\n\n    const ret = {};\n\n    for (const key in S.schema) {\n      ret[key] = x[key];\n    }\n\n    return ret;\n  });\n}\n/**\n * Check if a value is a plain object.\n */\n\nfunction isPlainObject(value) {\n  if (Object.prototype.toString.call(value) !== '[object Object]') {\n    return false;\n  }\n\n  const prototype = Object.getPrototypeOf(value);\n  return prototype === null || prototype === Object.prototype;\n}\n\n/**\n * Augment a string or array struct to constrain its length to zero.\n */\n\nfunction empty(S) {\n  return refinement(S, `${S.type} & Empty`, value => {\n    return value.length === 0;\n  });\n}\n/**\n * Augment a string or array struct to constrain its length to being between a\n * minimum and maximum size.\n */\n\nfunction length(S, min, max) {\n  return refinement(S, `${S.type} & Length<${min},${max}>`, value => {\n    return min < value.length && value.length < max;\n  });\n}\n/**\n * Refine a string struct to match a specific regexp pattern.\n */\n\nfunction pattern(S, regexp) {\n  return refinement(S, `${S.type} & Pattern<${regexp.source}>`, value => {\n    return regexp.test(value);\n  });\n}\n/**\n * Augment a `Struct` to add an additional refinement to the validation.\n */\n\nfunction refinement(struct, type, refiner) {\n  const fn = struct.refiner;\n  return new Struct(_objectSpread2(_objectSpread2({}, struct), {}, {\n    type,\n\n    *refiner(value, fail) {\n      yield* toFailures(fn(value, fail), fail);\n      yield* toFailures(refiner(value, fail), fail);\n    }\n\n  }));\n}\n\n/**\n * Validate any value.\n */\n\nfunction any() {\n  return struct('any', () => true);\n}\nfunction array(Element) {\n  return new Struct({\n    type: `Array<${Element ? Element.type : 'unknown'}>`,\n    schema: Element,\n    coercer: value => {\n      return Element && Array.isArray(value) ? value.map(v => coerce(v, Element)) : value;\n    },\n\n    *validator(value, ctx) {\n      if (!Array.isArray(value)) {\n        yield ctx.fail();\n        return;\n      }\n\n      if (Element) {\n        for (const [i, v] of value.entries()) {\n          yield* ctx.check(v, Element, value, i);\n        }\n      }\n    }\n\n  });\n}\n/**\n * Validate that boolean values.\n */\n\nfunction boolean() {\n  return struct('boolean', value => {\n    return typeof value === 'boolean';\n  });\n}\n/**\n * Validate that `Date` values.\n *\n * Note: this also ensures that the value is *not* an invalid `Date` object,\n * which can occur when parsing a date fails but still returns a `Date`.\n */\n\nfunction date() {\n  return struct('Date', value => {\n    return value instanceof Date && !isNaN(value.getTime());\n  });\n}\n/**\n * Validate that a value dynamically, determing which struct to use at runtime.\n */\n\nfunction dynamic(fn) {\n  return struct('Dynamic<...>', (value, ctx) => {\n    return ctx.check(value, fn(value, ctx));\n  });\n}\nfunction enums(values) {\n  return struct(`Enum<${values.map(toLiteralString)}>`, value => {\n    return values.includes(value);\n  });\n}\n/**\n * Validate that a value is a function.\n */\n\nfunction func() {\n  return struct('Function', value => {\n    return typeof value === 'function';\n  });\n}\n/**\n * Validate that a value is an instance of a class.\n */\n\nfunction instance(Class) {\n  return struct(`InstanceOf<${Class.name}>`, value => {\n    return value instanceof Class;\n  });\n}\nfunction intersection(Structs) {\n  return struct(Structs.map(s => s.type).join(' & '), function* (value, ctx) {\n    for (const S of Structs) {\n      yield* ctx.check(value, S);\n    }\n  });\n}\n/**\n * Validate a value lazily, by constructing the struct right before the first\n * validation. This is useful for cases where you want to have self-referential\n * structs for nested data structures.\n */\n\nfunction lazy(fn) {\n  let S;\n  return struct('Lazy<...>', (value, ctx) => {\n    if (!S) {\n      S = fn();\n    }\n\n    return ctx.check(value, S);\n  });\n}\nfunction literal(constant) {\n  return struct(`Literal<${toLiteralString(constant)}>`, value => {\n    return value === constant;\n  });\n}\n/**\n * Validate that a value is a map with specific key and value entries.\n */\n\nfunction map(Key, Value) {\n  return struct(`Map<${Key.type},${Value.type}>`, function* (value, ctx) {\n    if (!(value instanceof Map)) {\n      yield ctx.fail();\n      return;\n    }\n\n    for (const [k, v] of value.entries()) {\n      yield* ctx.check(k, Key, value, k);\n      yield* ctx.check(v, Value, value, k);\n    }\n  });\n}\n/**\n * Validate that a value always fails.\n */\n\nfunction never() {\n  return struct('never', () => false);\n}\n/**\n * Augment a struct to make it accept `null` values.\n */\n\nfunction nullable(S) {\n  return new Struct({\n    type: `${S.type} | null`,\n    schema: S.schema,\n    validator: (value, ctx) => {\n      return value === null || ctx.check(value, S);\n    }\n  });\n}\n/**\n * Validate that a value is a number.\n */\n\nfunction number() {\n  return struct(`number`, value => {\n    return typeof value === 'number' && !isNaN(value);\n  });\n}\nfunction object(Structs) {\n  const knowns = Structs ? Object.keys(Structs) : [];\n  const Never = never();\n  return new Struct({\n    type: Structs ? `Object<{${knowns.join(',')}}>` : 'Object',\n    schema: Structs ? Structs : null,\n    coercer: Structs ? createObjectCoercer(Structs) : x => x,\n\n    *validator(value, ctx) {\n      if (typeof value !== 'object' || value == null) {\n        yield ctx.fail();\n        return;\n      }\n\n      if (Structs) {\n        const unknowns = new Set(Object.keys(value));\n\n        for (const key of knowns) {\n          unknowns.delete(key);\n          const Value = Structs[key];\n          const v = value[key];\n          yield* ctx.check(v, Value, value, key);\n        }\n\n        for (const key of unknowns) {\n          const v = value[key];\n          yield* ctx.check(v, Never, value, key);\n        }\n      }\n    }\n\n  });\n}\n/**\n * Augment a struct to make it optionally accept `undefined` values.\n */\n\nfunction optional(S) {\n  return new Struct({\n    type: `${S.type}?`,\n    schema: S.schema,\n    validator: (value, ctx) => {\n      return value === undefined || ctx.check(value, S);\n    }\n  });\n}\n/**\n * Validate that a partial object with specific entry values.\n */\n\nfunction partial(Structs) {\n  if (Structs instanceof Struct) {\n    Structs = Structs.schema;\n  }\n\n  const knowns = Object.keys(Structs);\n  const Never = never();\n  return new Struct({\n    type: `Partial<{${knowns.join(',')}}>`,\n    schema: Structs,\n    coercer: createObjectCoercer(Structs),\n\n    *validator(value, ctx) {\n      if (typeof value !== 'object' || value == null) {\n        yield ctx.fail();\n        return;\n      }\n\n      const unknowns = new Set(Object.keys(value));\n\n      for (const key of knowns) {\n        unknowns.delete(key);\n\n        if (!(key in value)) {\n          continue;\n        }\n\n        const Value = Structs[key];\n        const v = value[key];\n        yield* ctx.check(v, Value, value, key);\n      }\n\n      for (const key of unknowns) {\n        const v = value[key];\n        yield* ctx.check(v, Never, value, key);\n      }\n    }\n\n  });\n}\n/**\n * Validate that a value is a record with specific key and\n * value entries.\n */\n\nfunction record(Key, Value) {\n  return struct(`Record<${Key.type},${Value.type}>`, function* (value, ctx) {\n    if (typeof value !== 'object' || value == null) {\n      yield ctx.fail();\n      return;\n    }\n\n    for (const k in value) {\n      const v = value[k];\n      yield* ctx.check(k, Key, value, k);\n      yield* ctx.check(v, Value, value, k);\n    }\n  });\n}\n/**\n * Validate that a set of values matches a specific type.\n */\n\nfunction set(Element) {\n  return struct(`Set<${Element.type}>`, (value, ctx) => {\n    if (!(value instanceof Set)) {\n      return false;\n    }\n\n    for (const val of value) {\n      const [failure] = ctx.check(val, Element);\n\n      if (failure) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n}\n/**\n * Validate that a value is a string.\n */\n\nfunction string() {\n  return struct('string', value => {\n    return typeof value === 'string';\n  });\n}\n/**\n * Define a `Struct` instance with a type and validation function.\n */\n\nfunction struct(name, validator) {\n  return new Struct({\n    type: name,\n    validator,\n    schema: null\n  });\n}\nfunction tuple(Elements) {\n  const Never = never();\n  return struct(`[${Elements.map(s => s.type).join(',')}]`, function* (value, ctx) {\n    if (!Array.isArray(value)) {\n      yield ctx.fail();\n      return;\n    }\n\n    for (const [index, Element] of Elements.entries()) {\n      const v = value[index];\n      yield* ctx.check(v, Element, value, index);\n    }\n\n    if (value.length > Elements.length) {\n      const index = Elements.length;\n      const v = value[index];\n      yield* ctx.check(v, Never, value, index);\n    }\n  });\n}\n/**\n * Validate that a value matches a specific strutural interface, like the\n * structural typing that TypeScript uses.\n */\n\nfunction type(Structs) {\n  const keys = Object.keys(Structs);\n  return struct(`Type<{${keys.join(',')}}>`, function* (value, ctx) {\n    if (typeof value !== 'object' || value == null) {\n      yield ctx.fail();\n      return;\n    }\n\n    for (const key of keys) {\n      const Value = Structs[key];\n      const v = value[key];\n      yield* ctx.check(v, Value, value, key);\n    }\n  });\n}\nfunction union(Structs) {\n  return struct(`${Structs.map(s => s.type).join(' | ')}`, function* (value, ctx) {\n    for (const S of Structs) {\n      const [...failures] = ctx.check(value, S);\n\n      if (failures.length === 0) {\n        return;\n      }\n    }\n\n    yield ctx.fail();\n  });\n}\n/**\n * Convert a value to a literal string.\n */\n\nfunction toLiteralString(value) {\n  return typeof value === 'string' ? `\"${value.replace(/\"/g, '\"')}\"` : `${value}`;\n}\n/**\n * Coerce the values of an object-like struct.\n */\n\n\nfunction createObjectCoercer(Structs) {\n  const knowns = Object.keys(Structs);\n  return value => {\n    if (typeof value !== 'object' || value == null) {\n      return value;\n    }\n\n    const ret = {};\n    const unknowns = new Set(Object.keys(value));\n\n    for (const key of knowns) {\n      unknowns.delete(key);\n      const Value = Structs[key];\n      const v = value[key];\n      ret[key] = coerce(v, Value);\n    }\n\n    for (const key of unknowns) {\n      ret[key] = value[key];\n    }\n\n    return ret;\n  };\n}\n\nexport { Struct, StructError, any, array, assert, boolean, coerce, coercion, date, defaulted, dynamic, empty, enums, func, instance, intersection, is, lazy, length, literal, map, masked, never, nullable, number, object, optional, partial, pattern, record, refinement, set, string, struct, tuple, type, union, validate };\n//# sourceMappingURL=index.es.js.map\n","/**\n * Copyright 2019-2022 Wingify Software Pvt. Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst { LogManager } = require('./logging');\n\nclass UsageStats {\n  constructor() {\n    this.data = {};\n  }\n\n  /**\n   * Collect the usage stats from the params passed at the time of instantiating VWO and send them to VWO Server\n   * @param {Object} config    config passed at the time of instantiation.\n   */\n  collectUsageStats(config) {\n    this.data['eb'] = Number(!!config.batchEvents);\n    this.data['ig'] = Number(!!config.integrations);\n    this.data['ss'] = Number(!!config.userStorageService);\n    this.data['cl'] = Number(!(config.logger instanceof LogManager));\n    this.data['ll'] = Number(config.logging && config.logging.level);\n    this.data['tr'] = Number(config.shouldTrackReturningUser);\n    this.data['gt'] = Number(!!config.goalTypeToTrack);\n    this.data['pi'] = Number(!!config.pollingInterval);\n\n    Object.keys(this.data).forEach(function(key) {\n      if (!this.data[key]) {\n        delete this.data[key];\n      }\n    }, this);\n  }\n\n  /**\n   * Get the collected usage stats.\n   * @returns     collected usage stats data\n   */\n  getUsageStats() {\n    if (Object.keys(this.data).length > 0) {\n      this.data['_l'] = 1;\n    }\n    return this.data;\n  }\n}\n\nmodule.exports = UsageStats;\n"],"sourceRoot":""}